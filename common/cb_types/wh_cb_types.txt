imperial_reconquest = {
    name = CB_NAME_IMPERIAL
    war_name = WAR_NAME_IMPERIAL
    sprite = 17
    truce_days = 3650
    is_permanent = yes
    check_de_jure_tier = DUKE # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes

	can_use_gui = {
		conditional_tooltip = {
		trigger ={ FROM = { any_war = {attacker = {NOT = { religion_group = ROOT }}}}}
			custom_tooltip = {
				text = fighting_against_chaos_tooltip
				FROM = {
					NOT = {
						any_war = {
							attacker = {
								NOT = { religion_group = ROOT }

							}
							defender = {
								religion_group = ROOT
							}
						}
					}
				}
			}
		}
	}

    can_use = {
        ROOT = {
			NOT = { trait = vampire_necrarch_visible }
			FROM = { NOT = { trait = vampire_necrarch_visible } }
            has_landed_title = e_the_empire
            independent = yes
            religion_group = old_world_group
            NOT = { same_realm = FROM }
        }
    }

    can_use_title = {
		NAND = {
			location = { region = world_albion }
			ROOT = {
				has_global_flag = mists_of_albion
				capital_scope = { NOT = { region = world_albion } }
			}
		}
		NOT = { de_jure_liege_or_above = e_the_under_empire }
        OR = {
            # TODO here should be de_jure_kingdoms of empire
            # here list ends
            de_jure_liege_or_above = k_drakwald
            de_jure_liege_or_above = k_solland
            de_jure_liege_or_above = k_west_mark
            de_jure_liege_or_above = k_lichtenberg
            de_jure_liege_or_above = k_reikland
            de_jure_liege_or_above = k_westerland
            de_jure_liege_or_above = k_nordland
            de_jure_liege_or_above = k_ostland
            de_jure_liege_or_above = k_wissenland
            de_jure_liege_or_above = k_talabecland
            de_jure_liege_or_above = k_averland
            de_jure_liege_or_above = k_ostermark
            de_jure_liege_or_above = k_stirland
            de_jure_liege_or_above = k_mootland
            de_jure_liege_or_above = k_middenland
            de_jure_liege_or_above = k_hochland
            de_jure_liege_or_above = k_sylvania
        }
    }

    is_valid = {
		# The defender is not in any black crusades, otherwise the joining effect for defenders will join the wrong war
        ROOT = {
            independent = yes
            religion_group = old_world_group
            NOT = { same_realm = FROM }
        }
    }

    on_success = {
        any_attacker = {
            limit = { character = ROOT }
            participation_scaled_prestige = 100
        }
        any_attacker = {
            limit = { NOT = { character = ROOT } }
            hidden_tooltip = {
                participation_scaled_prestige = 100
            }
        }

        FROM = { prestige = -100 }
    }

    on_success_title = {
        custom_tooltip = {
            text = tribal_invasion_succ_tip
            hidden_tooltip = {
                ROOT = {
                    vassalize_or_take_under_title = {
                        title = PREV
                        enemy = FROM
                    }
                }
            }
        }
        if = {
            limit = {
                holder_scope = { character = FROM }
            }
            usurp_title_only = ROOT
        }
    }

    on_fail = {
        ROOT = { prestige = -150 }
    }

    on_reverse_demand = {
        ROOT = {
            transfer_scaled_wealth = {
                to = FROM
                value = 4.0
            }
            ROOT = { prestige = -200 }
        }
        any_defender = {
            limit = { character = FROM }
            participation_scaled_piety = 100
            participation_scaled_prestige = 200
        }
        any_defender = {
            limit = { NOT = { character = FROM } }
            hidden_tooltip = {
                participation_scaled_piety = 100
                participation_scaled_prestige = 200
            }
        }
    }

    attacker_ai_victory_worth = {
        factor = -1 # always accept
    }

    attacker_ai_defeat_worth = {
        factor = 100
    }

    defender_ai_victory_worth = {
        factor = -1 # always accept
    }

    defender_ai_defeat_worth = {
        factor = 100
    }
	ai_will_do = {
		factor = 1
		modifier = {
			factor = 0
			FROM = { has_landed_title = k_witch_hunters_order }
			ROOT = { religion = sigmarite }
		}
	}
}

vlad_subjugation = {
    name = CB_NAME_PAGAN_SUBJUGATION
    war_name = WAR_NAME_PAGAN_SUBJUGATION
    sprite = 8
    truce_days = 3650
    hostile_against_others = yes
    is_permanent = yes
	is_holy_war = yes
    can_ask_to_join_war = yes
    check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	#battle_warscore_mult = 0.1
	max_attacker_battle_score = 50
	defender_unoccupied_warscore = yes
	full_hostility = yes


    can_use = {
        ROOT = {
			OR={
				has_artifact = carstein_ring
				primary_title={has_title_flag=vampire_wars_instigator}
			}
            NOT = { same_realm = FROM }
			NOT = { trait = vampire_necrarch_visible }
            NOT = { is_liege_or_above = FROM }
			primary_title = { higher_tier_than = KING }
            #has_horde_culture = no # This is chaos cb
        }
        FROM = {
            # vlad can subjugate people of the old world religions only
            religion_group = old_world_group
            NOT = {
                any_war = {
					defender = { character = FROM }
					using_cb = pagan_subjugation
                }
            }
        }
    }

    can_use_title = {
		any_de_jure_vassal_title = {
			tier=COUNT
			location={
				any_neighbor_province = {
					has_owner = yes
					owner = {
						OR = {
							character = ROOT
							is_liege_or_above = ROOT
						}
					}
				}
			}
		} #Dynamic Subjugation
		OR={
			has_global_flag = clean_mordheim
			AND={
				ROOT = {
					capital_scope = { NOT = { region = world_old_world_empire_mordheim } }
				}
				FROM = {
					capital_scope = { NOT = { region = world_old_world_empire_mordheim } }
				}
			}
		}
		OR={
			AND={
				empire={
					NOT={title=e_the_empire}
				}
				ROOT = {
					has_artifact = carstein_ring
					has_global_flag = vampire_wars_started
					NOT={primary_title={has_title_flag=vampire_wars_instigator}}
				}
			}
			AND={
				empire={
					title=e_the_empire
					has_global_flag = vampire_wars_started
					NOT={has_global_flag = vampire_wars_concluded}
				}
				ROOT = {primary_title={has_title_flag=vampire_wars_instigator}}
			}
			has_global_flag = vampire_wars_concluded
		}
		NAND = {
			location = { region = world_albion }
			ROOT = {
				has_global_flag = mists_of_albion
				capital_scope = { NOT = { region = world_albion } }
			}
		}
		NOT = { de_jure_liege_or_above = e_the_under_empire }
        ROOT = {
            has_artifact = carstein_ring
        }
    }

	is_valid = {
		# The defender is not in any black crusades, otherwise the joining effect for defenders will join the wrong war
		FROM = {
			NOT = {
				any_war = {
					using_cb = new_crusade
				}
			}
		}
		ROOT = {
			primary_title = { higher_tier_than = KING }
		}
	}

    is_valid_title = {
        FROM = {
            any_realm_title = {
                de_jure_liege_or_above = PREVPREV
            }
        }
    }
    on_add = {
		FROM = { letter_event = { id = vladsub.1 } }
	}
    on_add_title = {
    }
    on_success_title = {
		save_event_target_as = target_title
		ROOT={save_event_target_as = invader}
		FROM={save_event_target_as = target_of_invasion}
		hidden_tooltip={
			any_de_jure_vassal_title={
				limit={
					owner={same_realm=event_target:target_of_invasion}
					tier=COUNT
				}
				change_variable={ which=global_imperial_refugees value=1 }
			}
		}
		event_target:target_of_invasion={show_scope_change = no
			any_realm_province={show_scope_change = no
				limit={
					kingdom={ title=PREVPREVPREV }
					owner={same_realm=event_target:target_of_invasion}
					controller = {
						OR={character = ROOT
						top_liege={character = ROOT}
						}
					}
					duchy={
						any_de_jure_vassal_title={
							holder_scope = { same_realm=event_target:target_of_invasion }
							location={
								any_neighbor_province = {
									has_owner = yes
									owner = {
										OR = {
											character = ROOT
											is_liege_or_above = ROOT
										}
									}
								}
							}
						}
					}
					duchy={
						NOT={
							any_de_jure_vassal_title={
								holder_scope = { same_realm=event_target:target_of_invasion }
								controller = {
									NOR={character = ROOT
									top_liege={character = ROOT}
									}
								}
							}
						}
					}
				}
				county = {
					custom_tooltip={text = vlad_subjugation_duchy_target_TT}
					usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
				}
			}
		}
		if={
			limit={
				FROM={
					any_realm_title={title=PREVPREV}
				}
				holder_scope={same_realm=FROM}
				PREV={holder_scope={lower_tier_than = EMPEROR}}
			}
			event_target:target_title={
				holder_scope={
					opinion = {
						modifier = opinion_subjugated
						who = ROOT
					}
				}
			}
			holder_scope={
				set_defacto_liege = ROOT
				hidden_tooltip = {
					opinion = {
						modifier = opinion_subjugated
						who = ROOT
					}
					any_vassal = {
						opinion = {
							modifier = opinion_subjugated
							who = ROOT
						}
					}
				}
			}
			any_attacker = {
				limit = { character = ROOT }
				participation_scaled_prestige = 750
			}
			ROOT = {
				piety = 750
			}
		}
		else_if={
			limit={
				holder_scope={NOT={same_realm=FROM}}
			}
			any_de_jure_vassal_title={
				limit={
					owner={same_realm=FROM}
					tier=DUKE
				}
				if={
					limit={
						holder_scope={
							NOT={
								any_demesne_title={
									tier=COUNT
									NOT={kingdom={title=event_target:target_title}}
								}
							}
						}
					}
					usurp_title = ROOT
				}
				else={
					holder_scope={
						set_defacto_liege = ROOT
						hidden_tooltip = {
							opinion = {
								modifier = opinion_subjugated
								who = ROOT
							}
						}
					}
				}
			}
			any_de_jure_vassal_title={
				limit={
					owner={same_realm=FROM}
					tier=COUNT
				}
				if={
					limit={
						holder_scope={
							any_demesne_title={
								tier=COUNT
								NOT={kingdom={title=event_target:target_title}}
							}
						}
					}
					usurp_title = ROOT
				}
				else={
					holder_scope={
						set_defacto_liege = ROOT
						hidden_tooltip = {
							opinion = {
								modifier = opinion_subjugated
								who = ROOT
							}
						}
					}
				}
			}
			any_attacker = {
				limit = { character = ROOT }
				participation_scaled_prestige = 500
			}
			ROOT = {
				piety = 500
			}
		}
		else={
			any_attacker = {
				limit = { character = ROOT }
				participation_scaled_prestige = 1000
			}
			ROOT = {
				piety = 1000
			}
			FROM={
				primary_title = {
					if = {
						limit = {
							higher_tier_than = KING
						}
						destroy_landed_title = THIS
					}
				}
				set_defacto_liege = ROOT
			}
		}
        any_attacker = {
            limit = { NOT = { character = ROOT } }
            hidden_tooltip = { participation_scaled_prestige = 100 }
        }
        any_defender = {
            limit = {
				NOT = { character = FROM }
				OR={
					religion_group=FROM
					culture_group=FROM
				}
			}
            hidden_tooltip = {
				set_character_flag=fought_in_vampire_wars
				character_event={ id=carstein.16 days=15 }
			}
        }
		FROM={
			if={limit={independent=yes}
				character_event={ id=carstein.15 days=3 }
			}
			else={
				random_independent_ruler={
					limit={
						holy_order=no
						mercenary=no
						controls_religion=no
						OR={
							AND={
								religion_group=FROM
								NOT={religion_group=necromantic_group}
							}
							AND={
								any_neighbor_province={kingdom={title=event_target:target_of_invasion}}
								religion_group=ROOT
								NOT={religion_group=necromantic_group}
							}
						}
					}
					character_event={ id=carstein.15 days=3 }
				}
			}
		}
    }

	on_success_posttitle = {
		if = { limit = { ROOT = { realm_size = 150 } }
			k_cult_of_sigmar = {
				set_title_flag = vampire_invasion
				holder_scope = { character_event = { id = DR_imperial.8 days = 30 } }
			}
		}
	}
    on_fail = {
        any_defender = {
            limit = { character = FROM }
            participation_scaled_prestige = 500
            participation_scaled_piety = 250
        }
        any_defender = {
            limit = { NOT = { character = FROM } }
            hidden_tooltip = { participation_scaled_prestige = 250 }
            hidden_tooltip = { participation_scaled_piety = 500 }
        }
        ROOT = {
            piety = -100
			prestige=-500
        }
    }

    on_reverse_demand = {
        ROOT = {
            piety = -200
			prestige=-1000
            transfer_scaled_wealth = {
                to = FROM
                value = 2.0
            }
        }
        FROM = {
            piety = 100
        }
        any_defender = {
            limit = { character = FROM }
            participation_scaled_prestige = 1000
            participation_scaled_piety = 500
        }
        any_defender = {
            limit = { NOT = { character = FROM } }
            hidden_tooltip = { participation_scaled_prestige = 500 }
            hidden_tooltip = { participation_scaled_piety = 750 }
        }
		any_defender = {
			if={
				limit={
					OR={
						culture_group=imperial_group
						AND={
							capital_scope={empire={title=e_the_empire}}
							religion_group=old_world_group
						}
					}
				}
				set_character_flag = imperial_hero
				change_variable={ which="imperial_hero_counter" value=1 }
			}
		}
		most_participating_defender = {
			if={
				limit={
					OR={
						culture_group=imperial_group
						AND={
							capital_scope={empire={title=e_the_empire}}
							religion_group=old_world_group
						}
					}
				}
				set_character_flag = imperial_hero
				change_variable={which="imperial_hero_counter" value=2 }
			}
		}
    }
    attacker_ai_victory_worth = {
        factor = 200
    }

    attacker_ai_defeat_worth = {
        factor = 100
    }

    defender_ai_victory_worth = {
        factor = -1 # always accept
    }

    defender_ai_defeat_worth = {
        factor = 100
    }
}

##Imperial Reconquest for Emperors - THIS IS FOR THE CIVIL WAR ERA, IT WILL BE INVALIDATED ONCE THE TITULAR TITLES DISAPPEAR AS THE EMPIRE IS REFORMED##
imperial_reconquest2 = {
    name = CB_NAME_IMPERIAL
    war_name = WAR_NAME_IMPERIAL
    sprite = 17
    truce_days = 1825
    is_permanent = yes
    check_de_jure_tier = DUKE # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes

	can_use_gui = {
		conditional_tooltip = {
		trigger ={ FROM = { any_war = {attacker = {NOT = { religion_group = ROOT }}}}}
			custom_tooltip = {
				text = fighting_against_chaos_tooltip
				FROM = {
					NOT = {
						any_war = {
							attacker = {
								NOT = { religion_group = ROOT }

							}
							defender = {
								religion_group = ROOT
							}
						}
					}
				}
			}
		}
	 ROOT = {
		piety = 100
		prestige = 500
		}
	}
    can_use = {
		OR={ ROOT={has_character_modifier=expelled_k_witch_hunters_order}
		FROM={NOT={ has_landed_title = k_witch_hunters_order } }
		ROOT={NOT={religion_group=old_world_group}}
		FROM={NOT={religion_group=old_world_group}}
		}
		FROM={
			NOR={
				trait = creature_goblin
                trait = creature_hobgoblin
				trait = creature_beastman
				trait = creature_orc
			}
		}
        ROOT = {
			NOT = { trait = vampire_necrarch_visible }
			FROM = { NOT = { trait = vampire_necrarch_visible } }
            OR = {
                has_landed_title = e_westerland
                has_landed_title = e_reikland
                has_landed_title = e_middenland
                has_landed_title = e_talabecland
				has_landed_title = e_ostermark
				has_landed_title = e_nordland
				has_landed_title = e_hochland
				has_landed_title = e_averland
				has_landed_title = e_ostland
				has_landed_title = e_wissenland
				has_landed_title = e_stirland
				has_landed_title = e_solland
				has_landed_title = e_drakwald
				has_landed_title = e_west_mark
				has_landed_title = e_lichtenberg
				has_landed_title = e_wolfenland
				has_landed_title = e_rosenland
				has_landed_title = e_eagleland
				has_landed_title = e_imperial_sylvania
                AND = {
                    has_landed_title = e_sylvania
                    NOT = { has_artifact = carstein_ring}
                }
            }
			independent = yes
			NOT = { same_realm = FROM }
        }
		OR={
			has_global_flag = clean_mordheim
			AND={
				ROOT = {
					capital_scope = { NOT = { region = world_old_world_empire_mordheim } }
				}
				FROM = {
					capital_scope = { NOT = { region = world_old_world_empire_mordheim } }
				}
			}
		}
    }

    can_use_title = {
		any_de_jure_vassal_title = {
			tier=COUNT
			location={
				any_neighbor_province = {
					has_owner = yes
					owner = {
						OR = {
							character = ROOT
							is_liege_or_above = ROOT
						}
					}
				}
			}
		}
		NAND = {
			location = { region = world_albion }
			ROOT = {
				has_global_flag = mists_of_albion
				capital_scope = { NOT = { region = world_albion } }
			}
		}
		NOT = { de_jure_liege_or_above = e_the_under_empire }
        OR = {
            de_jure_liege_or_above = k_westerland
            de_jure_liege_or_above = k_middenland
            de_jure_liege_or_above = k_nordland
            de_jure_liege_or_above = k_hochland
            de_jure_liege_or_above = k_ostland
            de_jure_liege_or_above = k_talabecland
            de_jure_liege_or_above = k_stirland
            de_jure_liege_or_above = k_reikland
            de_jure_liege_or_above = k_wissenland
            de_jure_liege_or_above = k_averland
            de_jure_liege_or_above = k_ostermark
        }
    }

    is_valid = {
		# The defender is not in any black crusades, otherwise the joining effect for defenders will join the wrong war
		FROM = {
			NOT = {
				any_war = {
					using_cb = new_crusade
				}
			}
		}
        ROOT = {
            independent = yes
            NOT = { same_realm = FROM }
        }
    }
	on_add = {
		if = {
			limit = {

			ROOT = { religion = FROM }
			}
			ROOT = {
				piety = -100
				prestige = -250
			}
		}
		if = {
			limit = {NOT = { ROOT = { religion = FROM }}}
		ROOT = {
			piety = -50
			prestige = -250

			}
		}
	}

    on_success = {
        any_attacker = {
            limit = { character = ROOT }
            participation_scaled_prestige = 100
        }
        any_attacker = {
            limit = { NOT = { character = ROOT } }
            hidden_tooltip = {
                participation_scaled_prestige = 100
            }
        }
        FROM = { prestige = -100 }
    }

    on_success_title = {
        custom_tooltip = {
            text = tribal_invasion_succ_tip
            hidden_tooltip = {
                ROOT = {
                    vassalize_or_take_under_title = {
                        title = PREV
                        enemy = FROM
                    }
                }
            }
        }
        if = {
            limit = {
                holder_scope = { character = FROM }
            }
            usurp_title_only = ROOT
        }
    }

    on_fail = {
        ROOT = { prestige = -150 }
    }

    on_reverse_demand = {
        ROOT = {
            transfer_scaled_wealth = {
                to = FROM
                value = 4.0
            }
            ROOT = { prestige = -200 }
        }
        any_defender = {
            limit = { character = FROM }
            participation_scaled_piety = 100
            participation_scaled_prestige = 200
        }
        any_defender = {
            limit = { NOT = { character = FROM } }
            hidden_tooltip = {
                participation_scaled_piety = 100
                participation_scaled_prestige = 200
            }
        }
    }

    attacker_ai_victory_worth = {
        factor = -1 # always accept
    }

    attacker_ai_defeat_worth = {
        factor = 100
    }

    defender_ai_victory_worth = {
        factor = -1 # always accept
    }

    defender_ai_defeat_worth = {
        factor = 100
    }
}


cultist_bid_for_independence = { #WIP
	name = CB_NAME_INDEPENDENCE
	war_name = WAR_NAME_FACTION_INDEPENDENCE
	sprite = 12
	truce_days = 3650
	major_revolt = yes

	attacker_can_call_allies = no
	can_ask_to_join_war = no

	is_independence = yes

	can_use = {
		ROOT = {
			vassal_of = FROM
		}
	}

	is_valid = {
		# The defender is not in any black crusades, otherwise the joining effect for defenders will join the wrong war
		FROM = {
			NOT = {
				any_war = {
					using_cb = new_crusade
				}
			}
		}
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = {
					FROM = {
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
		FROM = {
			any_demesne_title = {
				NOT = { lower_tier_than = ROOT }
				temporary = no
			}
			independent = yes
			in_revolt = no
			liege_before_war = {
				in_revolt = no
				liege_before_war = {
					in_revolt = no
				}
			}
		}
	}

	on_success = {
		FROM = { any_vassal = { limit = { has_character_flag = independent_joining_flag }
						set_defacto_liege = THIS
						clr_character_flag = independent_joining_flag
				}
			}
		if = {
			limit = {
				FROM = {
					independent = no
				}
			}
			FROM = {
				if = {
					limit = {
						in_revolt = yes
					}
					liege_before_war = {
						#ROOT = {
						#	set_defacto_liege = PREV
						#}
						any_attacker = {
							set_defacto_liege = PREV
						}
					}
				}
				if = {
					limit = {
						in_revolt = no
					}
					liege = {
						#ROOT = {
						#	set_defacto_liege = PREV
						#}
						any_attacker = {
							set_defacto_liege = PREV
						}
					}
				}
			}
		}

		if = {
			limit = {
				FROM = {
					independent = yes
				}
			}
			#ROOT = {
			#	set_defacto_liege = ROOT
			#}
			any_attacker = {
				set_defacto_liege = ROOT
			}
		}

		hidden_tooltip = {
			ROOT = {
				prestige = 100
				any_demesne_title = {
					add_pressed_claim = FROM
				}
			}
		}

		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}

		FROM = {
			any_demesne_title = { #All titles
				limit = {
					OR = {
						tier = king
						tier = emperor
					}
#					is_titular = no
					NOT = {
						OR = {
							has_law = crown_authority_0
							has_law = imperial_crown_authority_0
						}
					}
				}
				if = {
					limit = { has_law = crown_authority_1 }
					add_law = crown_authority_0
				}
				if = {
					limit = { has_law = crown_authority_2 }
					add_law = crown_authority_1
				}
				if = {
					limit = { has_law = crown_authority_3 }
					add_law = crown_authority_2
				}
				if = {
					limit = { has_law = crown_authority_4 }
					add_law = crown_authority_3
				}
				if = {
					limit = { has_law = imperial_crown_authority_1 }
					add_law = imperial_crown_authority_0
				}
				if = {
					limit = { has_law = imperial_crown_authority_2 }
					add_law = imperial_crown_authority_1
				}
				if = {
					limit = { has_law = imperial_crown_authority_3 }
					add_law = imperial_crown_authority_2
				}
				if = {
					limit = { has_law = imperial_crown_authority_4 }
					add_law = imperial_crown_authority_3
				}
			}
		}
	}

	on_fail = {
		if = {
			limit = {
				FROM = {
					independent = no
				}
			}
			FROM = {
				if = {
					limit = {
						in_revolt = yes
					}
					liege_before_war = {
						ROOT = {
							set_defacto_liege = PREV
						}
					}
				}
				if = {
					limit = {
						in_revolt = no
					}
					liege = {
						ROOT = {
							set_defacto_liege = PREV
						}
						any_vassal = { limit = { has_character_flag = independent_joining_flag }
							set_defacto_liege = PREV
							clr_character_flag = independent_joining_flag
						}
					}
				}
			}
		}

		if = {
			limit = {
				FROM = {
					independent = yes
				}
			}
			ROOT = {
				set_defacto_liege = ROOT
			}
						any_vassal = { limit = { has_character_flag = independent_joining_flag }
							set_defacto_liege = PREV
							clr_character_flag = independent_joining_flag
						}
		}

		hidden_tooltip = {
			ROOT = {
				prestige = 100
				any_demesne_title = {
					add_pressed_claim = FROM
				}
			}
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -100
			prisoner = FROM
			if = { #abdicate to heir if not a chaos cultist
				limit = {
					ROOT = {
						current_heir = {
							NOT = {
								religion = chaos
								religion = tzeentch
								religion = nurgle
								religion = slaanesh
								religion = khorne
							}
						}
					}
				}
				abdicate = yes
				break = yes
			}
			if = { #abdicate to sibling w/claim
				limit = {
					ROOT = {
						any_sibling = {
							NOT = {
								religion = chaos
								religion = tzeentch
								religion = nurgle
								religion = slaanesh
								religion = khorne
							}
							ROOT = {
								primary_title = {
									PREVPREV = {
										has_claim = PREV
									}
								}
							}
							# has_claim = {
								# primary_title  = {
									# ROOT
								# }
							# }
						}
					}
				}
				ROOT = {
					random_sibling = {
						limit = {
							NOT = {
								religion = chaos
								religion = tzeentch
								religion = nurgle
								religion = slaanesh
								religion = khorne
							}
							ROOT = {
								primary_title = {
									PREVPREV = {
										has_claim = PREV
									}
								}
							}
							# has_claim = {
								# primary_title  = {
									# ROOT
								# }
							# }
						}
						ROOT = {
							abdicate_to = PREV
						}
					}
				}
				break = yes
			}
			if = { #abdicate to dynasty member w/claim
				limit = {
					ROOT = {
						any_dynasty_member = {
							NOT = {
								religion = chaos
								religion = tzeentch
								religion = nurgle
								religion = slaanesh
								religion = khorne
							}
							PREV = {
								primary_title = {
									PREVPREV = {
										has_claim = PREV
									}
								}
								# has_claim = {
									# primary_title  = {
										# ROOT
									# }
								# }
							}
						}
					}
				}
				ROOT = {
					random_dynasty_member = {
						limit = {
							NOT = {
								religion = chaos
								religion = tzeentch
								religion = nurgle
								religion = slaanesh
								religion = khorne
							}
							PREV = {
								primary_title = {
									PREVPREV = {
										has_claim = PREV
									}
								}
							}
							# has_claim = {
								# primary_title  = {
									# ROOT
								# }
							# }
						}
						ROOT = {
							abdicate_to = PREV
						}
					}
				}
				break = yes
			}
			if = { #abdicate to sibling w/out claim
				limit = {
					ROOT = {
						any_sibling = {
							NOT = {
								religion = chaos
								religion = tzeentch
								religion = nurgle
								religion = slaanesh
								religion = khorne
							}
						}
					}
				}
				ROOT = {
					random_sibling = {
						limit = {
							NOT = {
								religion = chaos
								religion = tzeentch
								religion = nurgle
								religion = slaanesh
								religion = khorne
							}
						}
						ROOT = {
							abdicate_to = PREV
						}
					}
				}
				break = yes
			}
			if = { #abdicate to dynasty member w/out claim
				limit = {
					ROOT = {
						any_dynasty_member = {
							NOT = {
								religion = chaos
								religion = tzeentch
								religion = nurgle
								religion = slaanesh
								religion = khorne
							}
						}
					}
				}
				ROOT = {
					random_dynasty_member = {
						limit = {
							NOT = {
								religion = chaos
								religion = tzeentch
								religion = nurgle
								religion = slaanesh
								religion = khorne
							}
						}
						ROOT = {
							abdicate_to = PREV
						}
					}
				}
				break = yes
			}
			#abidicate to liege if no one left
			abdicate_to = FROM
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = -100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = -100 }
		}
		FROM = {
			prestige = 50
		}
	}

	on_attacker_leader_death = {
		hidden_tooltip = {
			any_defender = {
				letter_event = {
					id = 251
				}
			}
		}

		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 #always accept
	}

	attacker_ai_defeat_worth = {
		factor = 150
	}

	defender_ai_victory_worth = {
		factor = -1 #always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}


chaos_dwarf_slaver_raid = {
	name = CB_NAME_CHAOS_DWARF_SLAVER_RAID
	war_name = WAR_NAME_CHAOS_DWARF_SLAVER_RAID
	sprite = 7
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = DUKE # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	battle_warscore_mult = 1.25

	allow_distant = yes # AI parameter

	can_use_gui = {
		ROOT = { prestige = 50 }
	}

	on_add = {
		ROOT = { prestige = -50 }
	}

	can_use = {
		ROOT = {
			culture_group = dwarf_chaos_group
		}
		FROM = {
			NOT = {
				culture_group = dwarf_chaos_group
			}
		}
	}

	can_use_title = {
		NAND = {
			location = { region = world_albion }
			ROOT = {
				has_global_flag = mists_of_albion
				capital_scope = { NOT = { region = world_albion } }
			}
		}
		NOT = { de_jure_liege_or_above = e_the_under_empire }
		NOT = { de_jure_liege_or_above = e_nehekhara } #the title must have at least one county which is NOT nehekharan (if all are, it is dead land, and cannot be occupied).

		# The attacker needs at least one county in the target kingdom, or a border, or be only two sea zones away from one of your counties
		any_direct_de_jure_vassal_title = {
			OR = {
				holder_scope = {
					OR = {
						character = ROOT
						is_liege_or_above = ROOT
					}
				}
				location = {
					any_neighbor_province = {
						OR = {
							AND = {
								has_owner = yes
								owner = {
									OR = {
										character = ROOT
										is_liege_or_above = ROOT
									}
								}
							}
							AND = {
								is_land = no
								any_neighbor_province = {
									OR = {
										AND = {
											has_owner = yes
											owner = {
												OR = {
													character = ROOT
													is_liege_or_above = ROOT
												}
											}
										}
										AND = {
											is_land = no
											any_neighbor_province = {
												owner = {
													OR = {
														character = ROOT
														is_liege_or_above = ROOT
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}

	is_valid = {
		# The defender is not in any black crusades, otherwise the joining effect for defenders will join the wrong war
		FROM = {
			NOT = {
				any_war = {
					using_cb = new_crusade
				}
			}
		}
		ROOT = {
			NOT = { same_realm = FROM }
		}
		FROM = {
			NOT = { religion = hashut }
			NOT = { culture_group = dwarf_chaos_group }
		}
	}

	on_add_title = {
	}

	on_invalidation = {
		ROOT = {
			IF = {
				limit = { has_character_flag = chaos_dwarf_raided_a_province }
				clr_character_flag = chaos_dwarf_raided_a_province
			}
		}
	}

	on_success = {
		ROOT = {
			prestige = 100
			participation_scaled_prestige = 100
			IF = {
				limit = { has_character_flag = chaos_dwarf_raided_a_province }
				clr_character_flag = chaos_dwarf_raided_a_province
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100
						participation_scaled_piety = 100 }
		}
		FROM = {
			prestige = -300
		}
	}
	on_fail = {
		FROM = {
			prestige = 100
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_piety = 100
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = {
			participation_scaled_piety = 100
			participation_scaled_prestige = 50 }
		}
		ROOT = {
			prestige = -300
			IF = {
				limit = { has_character_flag = chaos_dwarf_raided_a_province }
				clr_character_flag = chaos_dwarf_raided_a_province
			}
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -300
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
			IF = {
				limit = { has_character_flag = chaos_dwarf_raided_a_province }
				clr_character_flag = chaos_dwarf_raided_a_province
			}
		}
		FROM = {
			prestige = 150
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
			participation_scaled_piety = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100
			participation_scaled_piety = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # Always accept
	}
	attacker_ai_defeat_worth = {
		factor = 100
	}
	defender_ai_victory_worth = {
		factor = -1 # Always accept
	}
	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1

		modifier = {
			factor = 3
			ROOT = { trait = greedy }
		}

		modifier = {
			factor = 5
			ROOT = {
				capital_holding = {
					NOT = {
						OR = {
							has_building = ca_chaos_dwarf_factory_1
							has_building = ca_chaos_dwarf_slave_levy_1
							has_building = ct_chaos_dwarf_factory_1
							has_building = ct_chaos_dwarf_slave_levy_1
							has_building = fp_chaos_dwarf_factory_1
							has_building = fp_chaos_dwarf_slave_levy_1
							has_building = tp_chaos_dwarf_factory_1
							has_building = tp_chaos_dwarf_slave_levy_1
						}
					}
				}
			}
		}
	}
}

witch_hunter_forceinvestigation_cb = {
	name = CB_NAME_HUNTERINVESTIGATION
	war_name = WAR_NAME_HUNTERINVESTIGATION
	sprite = 7
	truce_days = 3650
	is_permanent = yes
	can_ask_to_join_war = no

	can_use = {
		ROOT = {
			trait = witch_hunter
			has_landed_title = k_witch_hunters_order
			NOR = {
				pays_tribute_to = FROM
				any_liege = {
					OR = {
						pays_tribute_to = FROM
						FROM = {
							pays_tribute_to = PREV
						}
					}
				}
			}
		}
		FROM = {independent = yes
				has_character_modifier = expelled_k_witch_hunters_order }
	}

	is_valid = {
		# The defender is not in any black crusades, otherwise the joining effect for defenders will join the wrong war
		FROM = {
			NOT = {
				any_war = {
					using_cb = new_crusade
				}
			}
		}
		FROM = { has_character_modifier = expelled_k_witch_hunters_order }
	}

	on_success = {
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 250
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 250
			}
		}
		any_defender = {
			imprison = ROOT
		}
		FROM = { remove_character_modifier = expelled_k_witch_hunters_order }

	}

	on_fail = {
		ROOT = {
			prestige = -125
		}
		FROM = {
			prestige = 50
		}
	}

	on_reverse_demand = {
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 250
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = {
				participation_scaled_prestige = 250
			}
		}
		ROOT = {
			prestige = -250
			imprison = FROM
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
	ai_will_do = {
		factor = 1
		modifier = {
			factor = 3
			ROOT = { trait = zealous }
		}
	}
}

#The Prepared Invasion CB of Strigoi and Strigany
strigoi_invasion = {
	name = CB_NAME_STRIGOI_INVASION
	war_name = WAR_NAME_STRIGOI_INVASION
	sprite = 8
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	is_holy_war = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	apply_short_occ_mod = no # Do not apply the 'recently_conquered' modifier to Holdings

	can_use = {
		FROM = { NOT = { culture_group = strigany_group } }
		ROOT = {
			has_character_flag = preparing_strygos_invasion
			NOT = { is_liege_or_above = FROM }
		}
	}


	on_add = {
		ROOT = {
		remove_character_modifier = preparing_strygos_invasion
		add_character_modifier = { modifier = attempted_strygos_invasion
						duration = 3651 } }
	}

	can_use_title = {
		NAND = {
			location = { region = world_albion }
			ROOT = {
				has_global_flag = mists_of_albion
				capital_scope = { NOT = { region = world_albion } }
			}
		}
		NOT = { de_jure_liege_or_above = e_the_under_empire }
		capital_scope = { region = world_badlands_strygos }
	}

	is_valid = {
		# The defender is not in any black crusades, otherwise the joining effect for defenders will join the wrong war
		FROM = {
			NOT = {
				any_war = {
					using_cb = new_crusade
				}
			}
		}
	}

	is_valid_title = {
		FROM = {
			any_realm_title = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}

	on_success = {
		ROOT = {
			prestige = 500
			piety = 250
			clr_character_flag = preparing_strygos_invasion
			}

		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 300
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 300 }
		}
		FROM = {
			prestige = -500
		}
	}

	on_success_title = {
		custom_tooltip = {
			text = tribal_invasion_succ_tip
			hidden_tooltip = {
				FROM = {
					random_realm_province = {
						limit = {
							de_jure_liege_or_above = PREVPREV
							OR = {
								NOT = { culture = ROOT }
								NOT = { religion = ROOT }
							}
						}
						culture = ROOT
						religion = ROOT
					}
				}
				ROOT = {
					occupy_minors_of_occupied_settlements = FROM
					gain_all_occupied_titles = { who = FROM type = invasion }
					vassalize_or_take_under_title_destroy_duchies = {
						title = PREV
						enemy = FROM
						type = invasion
					}

					# Settle the special invasion forces
					disband_event_forces = prepared_invasion
					any_demesne_title = {
						limit = { tier = BARON }
						remove_holding_modifier = recently_conquered
						refill_holding_levy = yes
					}
				}

				if = {
					limit = {
						FROM = { is_liege_or_above = ROOT }
					}
					FROM = { imprison = ROOT }
				}
			}
		}
	}

	on_fail = {
		FROM = {
			prestige = 200
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		ROOT = {
			prestige = -300
			piety = -100
			clr_character_flag = preparing_strygos_invasion
			hidden_tooltip = {
				disband_event_forces = prepared_invasion
			}
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -500
			piety = -250
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
			clr_character_flag = preparing_strygos_invasion
			hidden_tooltip = {
				disband_event_forces = prepared_invasion
			}
			religion_authority = {
				modifier = lost_viking_invasion
			}
		}
		FROM = {
			prestige = 300
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 250
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 250 }
		}
	}

	attacker_ai_victory_worth = {
		factor = 200
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

strygan_reconquest = {
    name = CB_NAME_STRYGAN_REC
    war_name = WAR_NAME_STRYGAN_REC
    sprite = 17
    truce_days = 3650
    is_permanent = yes
    check_de_jure_tier = DUKE # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes

    can_use = {
        ROOT = {
            OR = { has_landed_title = e_strygos
		has_landed_title = e_strygos_2 }
            independent = yes
            religion_group = necromantic_group
            NOT = { same_realm = FROM }
        }
    }

    can_use_title = {
		NAND = {
			location = { region = world_albion }
			ROOT = {
				has_global_flag = mists_of_albion
				capital_scope = { NOT = { region = world_albion } }
			}
		}
		NOT = { de_jure_liege_or_above = e_the_under_empire }
        capital_scope = { region = world_badlands_strygos }
    }

    is_valid = {
		# The defender is not in any black crusades, otherwise the joining effect for defenders will join the wrong war
		FROM = {
			NOT = {
				any_war = {
					using_cb = new_crusade
				}
			}
		}
        ROOT = {
            independent = yes
            NOT = { same_realm = FROM }
        }
    }

    on_success = {
        any_attacker = {
            limit = { character = ROOT }
            participation_scaled_prestige = 100
        }
        any_attacker = {
            limit = { NOT = { character = ROOT } }
            hidden_tooltip = {
                participation_scaled_prestige = 100
            }
        }

        FROM = { prestige = -100 }
    }

    on_success_title = {
        custom_tooltip = {
            text = tribal_invasion_succ_tip
            hidden_tooltip = {
                ROOT = {
                    vassalize_or_take_under_title = {
                        title = PREV
                        enemy = FROM
                    }
                }
            }
        }
        if = {
            limit = {
                holder_scope = { character = FROM }
            }
            usurp_title_only = ROOT
        }
    }

    on_fail = {
        ROOT = { prestige = -150 }
    }

    on_reverse_demand = {
        ROOT = {
            transfer_scaled_wealth = {
                to = FROM
                value = 4.0
            }
            ROOT = { prestige = -200 }
        }
        any_defender = {
            limit = { character = FROM }
            participation_scaled_piety = 100
            participation_scaled_prestige = 200
        }
        any_defender = {
            limit = { NOT = { character = FROM } }
            hidden_tooltip = {
                participation_scaled_piety = 100
                participation_scaled_prestige = 200
            }
        }
    }

    attacker_ai_victory_worth = {
        factor = -1 # always accept
    }

    attacker_ai_defeat_worth = {
        factor = 100
    }

    defender_ai_victory_worth = {
        factor = -1 # always accept
    }

    defender_ai_defeat_worth = {
        factor = 100
    }
	ai_will_do = {
		factor = 1
		modifier = {
			factor = 0
			FROM = { has_landed_title = k_witch_hunters_order }
			ROOT = { religion = sigmarite }
		}
	}
}

necrarch_thrall_raid = {
	name = CB_NAME_NECRARCH_TRHALLS_RAID
	war_name = WAR_NAME_NECRARCH_TRHALLS_RAID
	sprite = 7
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = DUKE # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	battle_warscore_mult = 0.75

	allow_distant = yes # AI parameter


	can_use = {
		ROOT = {
			religion = nagashi
			OR = { trait = creature_nehekharan
				trait = creature_human
				trait = vampire_necrarch_visible
				trait = vampire_lahmian_visible
				trait = vampire_carstein_visible
				trait = vampire_jade_visible }
		}
		FROM = {
			NOR = {
                trait = creature_nehekharan
				is_vampire_visible_trigger = yes
            }
		}
	}

	can_use_title = {
		NAND = {
			location = { region = world_albion }
			ROOT = {
				has_global_flag = mists_of_albion
				capital_scope = { NOT = { region = world_albion } }
			}
		}
		NOT = { de_jure_liege_or_above = e_the_under_empire }
		NOT = { de_jure_liege_or_above = e_nehekhara } #the title must have at least one county which is NOT nehekharan (if all are, it is dead land, and cannot be occupied).

		# The attacker needs at least one county in the target kingdom, or a border, or be only two sea zones away from one of your counties
		any_direct_de_jure_vassal_title = {
			OR = {
				holder_scope = {
					OR = {
						character = ROOT
						is_liege_or_above = ROOT
					}
				}
				location = {
					any_neighbor_province = {
						OR = {
							AND = {
								has_owner = yes
								owner = {
									OR = {
										character = ROOT
										is_liege_or_above = ROOT
									}
								}
							}
							AND = {
								is_land = no
								any_neighbor_province = {
									OR = {
										AND = {
											has_owner = yes
											owner = {
												OR = {
													character = ROOT
													is_liege_or_above = ROOT
												}
											}
										}
										AND = {
											is_land = no
											any_neighbor_province = {
												owner = {
													OR = {
														character = ROOT
														is_liege_or_above = ROOT
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}

	is_valid = {
		# The defender is not in any black crusades, otherwise the joining effect for defenders will join the wrong war
		FROM = {
			NOT = {
				any_war = {
					using_cb = new_crusade
				}
			}
		}
		ROOT = {
			NOT = { same_realm = FROM }
		}
	}

	on_add_title = {
	}

	on_success = {
		ROOT = {
			piety = 150
			participation_scaled_piety = 150
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100
						participation_scaled_piety = 100 }
		}
		FROM = {
			prestige = -300
		}
	}
	on_fail = {
		FROM = {
			prestige = 100
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_piety = 100
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = {
			participation_scaled_piety = 100
			participation_scaled_prestige = 50 }
		}
		ROOT = {
			prestige = -300
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -300
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
		}
		FROM = {
			prestige = 150
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
			participation_scaled_piety = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100
			participation_scaled_piety = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # Always accept
	}
	attacker_ai_defeat_worth = {
		factor = 80
	}
	defender_ai_victory_worth = {
		factor = -1 # Always accept
	}
	defender_ai_defeat_worth = {
		factor = 80
	}

	ai_will_do = {
		factor = 1

		modifier = {
			factor = 3
			ROOT = { trait = greedy }
		}
		modifier = {
			factor = 3
			ROOT = { trait = mystic }
		}
		modifier = {
			factor = 3
			ROOT = { trait = impaler }
		}
	}
}

jade_eradication_conquest = {
	name = CB_NAME_ERADICATION_CONQUEST
	war_name = WAR_NAME_ERADICATION_CONQUEST
	sprite = 6
	truce_days = 5000
	hostile_against_others = yes
	is_permanent = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = DUKE # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	battle_warscore_mult = 0.1

	allow_distant = yes # AI parameter


	can_use = {
		ROOT = { trait = vampire_jade_visible }
		FROM = { NOT = { trait = vampire_jade_visible }
			is_within_diplo_range = ROOT }
	}

	can_use_title = {
		NAND = {
			location = { region = world_albion }
			ROOT = {
				has_global_flag = mists_of_albion
				capital_scope = { NOT = { region = world_albion } }
			}
		}
		NOT = { de_jure_liege_or_above = e_the_under_empire }
		NOT = { de_jure_liege_or_above = e_nehekhara } #the title must have at least one county which is NOT nehekharan (if all are, it is dead land, and cannot be occupied).

	}

	is_valid = {
		# The defender is not in any black crusades, otherwise the joining effect for defenders will join the wrong war
		FROM = {
			NOT = {
				any_war = {
					using_cb = new_crusade
				}
			}
		}
		ROOT = { NOT = { same_realm = FROM } }
	}

	on_add_title = {
	}

	on_success = {
		ROOT = {
			piety = 150
			participation_scaled_piety = 150
			capital_scope = { capital_holding = { add_building = ca_jade_stock_1 } }
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100
						participation_scaled_piety = 100 }
		}
		FROM = { prestige = -300 }
	}
	on_success_title = {
		any_de_jure_vassal_title = { limit = { tier = COUNT
							OR = { holder_scope = { character = FROM }
								holder_scope = { top_liege = { character = FROM } }
								}
							location = { NOT = { religion = vampiric }
									NOT = { culture = nehekharan } }
							 }
						location = { add_province_modifier = { name = jade_mayhem
											duration = 900 } } }
		custom_tooltip = {
			text = religious_cb_succ_tip
			hidden_tooltip = {
				ROOT = {
					vassalize_or_take_under_title = {
						title = PREV
						enemy = FROM
						same_religion = yes # Only vassalize rulers of my religion
						is_religious = yes
						type = holy_war
						}
					}
				}
			}
	}

	on_fail = {
		FROM = {
			prestige = 100
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_piety = 100
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = {
			participation_scaled_piety = 100
			participation_scaled_prestige = 50 }
		}
		ROOT = {
			prestige = -300
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -300
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
		}
		FROM = {
			prestige = 150
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
			participation_scaled_piety = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100
			participation_scaled_piety = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # Always accept
	}
	attacker_ai_defeat_worth = {
		factor = 80
	}
	defender_ai_victory_worth = {
		factor = -1 # Always accept
	}
	defender_ai_defeat_worth = {
		factor = 80
	}

	ai_will_do = {
		factor = 1
		modifier = {
			factor = 3
			ROOT = { trait = ambitious }
			}
	}
}

cathayan_eradication_conquest = {
	name = CB_NAME_ERADICATION_CATHAYAN
	war_name = WAR_NAME_ERADICATION_CATHAYAN
	sprite = 6
	truce_days = 5000
	hostile_against_others = yes
	is_permanent = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = DUKE # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	battle_warscore_mult = 0.25

	allow_distant = yes # AI parameter


	can_use = {
		ROOT = { religion = draconite
			culture = cathayan
			is_living_human_trigger = yes }
		FROM = { NOT = { religion = draconite }
			trait = vampire_jade_visible
			is_within_diplo_range = ROOT }
	}

	can_use_title = {
		NAND = {
			location = { region = world_albion }
			ROOT = {
				has_global_flag = mists_of_albion
				capital_scope = { NOT = { region = world_albion } }
			}
		}
		NOT = { de_jure_liege_or_above = e_the_under_empire }
		NOT = { de_jure_liege_or_above = e_nehekhara } #the title must have at least one county which is NOT nehekharan (if all are, it is dead land, and cannot be occupied).

	}

	is_valid = {
		# The defender is not in any black crusades, otherwise the joining effect for defenders will join the wrong war
		FROM = {
			NOT = {
				any_war = {
					using_cb = new_crusade
				}
			}
		}
		ROOT = { NOT = { same_realm = FROM } }
	}

	on_add_title = {
	}

	on_success = {
		ROOT = {
			piety = 150
			participation_scaled_piety = 150
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100
						participation_scaled_piety = 100 }
		}
		FROM = { prestige = -300
			imprison = ROOT }
	}
	on_success_title = {
		custom_tooltip = {
			text = religious_cb_succ_tip
			hidden_tooltip = {
				ROOT = {
					vassalize_or_take_under_title = {
						title = PREV
						enemy = FROM
						same_religion = yes # Only vassalize rulers of my religion
						is_religious = yes
						type = holy_war
						}
					}
				}
			}
	}

	on_fail = {
		FROM = {
			prestige = 100
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_piety = 100
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = {
			participation_scaled_piety = 100
			participation_scaled_prestige = 50 }
		}
		ROOT = {
			prestige = -300
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -300
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
		}
		FROM = {
			prestige = 150
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
			participation_scaled_piety = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100
			participation_scaled_piety = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # Always accept
	}
	attacker_ai_defeat_worth = {
		factor = 80
	}
	defender_ai_victory_worth = {
		factor = -1 # Always accept
	}
	defender_ai_defeat_worth = {
		factor = 80
	}

	ai_will_do = {
		factor = 1
		modifier = {
			factor = 3
			ROOT = { trait = ambitious }
			}
	}
}

cathayan_subjugation = {
    name = CB_NAME_CATHAYAN_SUBJUGATION
    war_name = WAR_NAME_CATHAYAN_SUBJUGATION
    sprite = 8
    truce_days = 7200
    hostile_against_others = yes
    is_permanent = yes
    can_ask_to_join_war = yes
    check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	battle_warscore_mult = 0.75

    can_use = {
        ROOT = {
		religion = draconite
		OR = { culture = cathayan
			culture = living_jade }
		OR = { has_dynasty_flag = relinked_shashala_flag
			has_dynasty_flag = relinked_naparaya_flag
			AND = { has_dynasty_flag = link_with_cathay
				prestige = 500
				piety = 1000 } }
            NOT = { same_realm = FROM }
			NOT = { trait = vampire_necrarch_visible }
            NOT = { is_liege_or_above = FROM }
			primary_title = { higher_tier_than = KING }
        }
        FROM = {
            NOT = { religion = draconite }
            NOT = { culture_group = orc_group }
            NOT = { culture_group = goblin_group }
            NOT = {
                any_war = { defender = { character = FROM }
			using_cb = pagan_subjugation }
            	}
         }
    }

	is_valid = {
		# The defender is not in any black crusades, otherwise the joining effect for defenders will join the wrong war
		FROM = {
			NOT = {
				any_war = {
					using_cb = new_crusade
				}
			}
		}
		ROOT = {
			primary_title = { higher_tier_than = KING }
		}
	}

    is_valid_title = {
        FROM = {
            any_realm_title = {
                de_jure_liege_or_above = PREVPREV
            }
        }
    }

    on_success = {
        ROOT = {
            piety = 100
        }
        any_attacker = {
            limit = { character = ROOT }
            participation_scaled_prestige = 100
        }
        any_attacker = {
            limit = { NOT = { character = ROOT } }
            hidden_tooltip = { participation_scaled_prestige = 100 }
        }
        FROM = {
            piety = -100
            prestige = -100
			any_vassal = {
				if = {
					limit = {
						primary_title = { higher_tier_than = DUKE }
					}
					set_defacto_liege = ROOT
					hidden_tooltip = {
						opinion = {
							modifier = opinion_subjugated_other_rel
							who = ROOT
							months = 60
						}
					}
				}
			}
			primary_title = {
				if = {
					limit = {
						higher_tier_than = KING
					}
					destroy_landed_title = THIS
				}
			}
			set_defacto_liege = ROOT
			hidden_tooltip = {
				opinion = {
					modifier = opinion_subjugated_other_rel
					who = ROOT
					months = 60
				}
			}
		}
    }

    on_fail = {
        FROM = {
            piety = 50
        }
        any_defender = {
            limit = { character = FROM }
            participation_scaled_prestige = 50
        }
        any_defender = {
            limit = { NOT = { character = FROM } }
            hidden_tooltip = { participation_scaled_prestige = 50 }
        }
        ROOT = {
            piety = -100
        }
    }

    on_reverse_demand = {
        ROOT = {
            piety = -200
            transfer_scaled_wealth = {
                to = FROM
                value = 2.0
            }
        }
        FROM = {
            piety = 100
        }
        any_defender = {
            limit = { character = FROM }
            participation_scaled_prestige = 100
        }
        any_defender = {
            limit = { NOT = { character = FROM } }
            hidden_tooltip = { participation_scaled_prestige = 100 }
        }
		any_defender = {
			set_character_flag = imperial_hero
		}
    }

    attacker_ai_victory_worth = {
        factor = 200
    }

    attacker_ai_defeat_worth = {
        factor = 100
    }

    defender_ai_victory_worth = {
        factor = -1 # always accept
    }

    defender_ai_defeat_worth = {
        factor = 100
    }
}
#Colonization
#Used by The League Members (only works against coastal provinces)
coastal_colonization = {
	name = CB_NAME_COASTAL_COLONIZATION
	war_name = WAR_NAME_COASTAL_COLONIZATION
	sprite = 16
	truce_days = 2500
	hostile_against_others = yes
	is_permanent = yes
	check_de_jure_tier = count # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	attacker_can_call_allies = no
	can_call_vassals = no
	can_ask_to_join_war = no
	apply_short_occ_mod = no #suffers new Colony instead

	allow_distant = yes

	can_use = {
        always = no
		OR={
			AND={
				FROM={capital_scope={region = world_new_world_lustria }
					NOR={
					religion_group=ROOT
					culture_group=ROOT
					}
				}
				ROOT={capital_scope={region = world_old_world }}
			}
			AND={
				FROM={capital_scope={region = world_new_world_lustria }
					NOR={
					religion_group=ROOT
					culture_group=ROOT
					}
				}
				ROOT={capital_scope={region = world_greater_araby }}
			}
			AND={
				FROM={capital_scope={region = world_greater_araby }
					NOR={
					religion_group=ROOT
					culture_group=ROOT
					}
				}
				ROOT={capital_scope={region = world_old_world }}
			}
			AND={
				FROM={capital_scope={region = world_old_world }
					NOR={
					religion_group=ROOT
					culture_group=ROOT
					}
				}
				ROOT={
					NOT={religion_group=old_world_group}
					culture_group=arabyan_group
					capital_scope={region = world_greater_araby }
				}
			}
			AND={
				NOT={has_global_flag=mists_of_albion}
				ROOT={NOT={capital_scope={region = world_albion }}}
				FROM={capital_scope={region = world_albion }}
				NOT={
					any_independent_ruler={
						capital_scope={capital_scope={region = world_albion }}
						NOR={
							religion_group=ROOT
							culture_group=ROOT
						}
					}
				}
			}
		}
	}

	can_use_title = {
		location = { port = yes }
	}

	is_valid = {
		# The defender is not in any black crusades, otherwise the joining effect for defenders will join the wrong war
		FROM = {
			NOT = {
				any_war = {
					using_cb = new_crusade
				}
			}
		}
	}

	is_valid_title = {
		e_ulthuan = { holder_scope = { trait = interventionist_elf } }	#If the King is against meddling, the Princes cannot go
		ROOT = {
			religion_group = cadai_group
			trait = interventionist_elf
			OR = { has_landed_title = e_ulthuan
				top_liege = { has_landed_title = e_ulthuan } }	#The colonization can only start from Ulthuan
			NOT = { same_realm = FROM }
		}
		FROM = {
			OR = {
				NOT = { trait = creature_elf } #any non-elf ruler is a good target
				religion_group = cytharai_group
			}
		}

		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}
	on_success = {
		#ROOT = { character_event = { id = asur.26 days = 1 } } #create character, assign by flag
		}
	on_success_title = {
		set_title_flag = elven_colony_flag
		usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }

		any_de_jure_vassal_title = { # take all baronies too
			limit = {
				has_holder = yes
				holder_scope = {
					OR = {
						character = FROM
						is_liege_or_above = FROM
						AND = {
							is_liege_or_above = ROOT
							NOT = { culture = ROOT }
							NOT = { religion = ROOT }
							}
						}
					 }
				}

			usurp_title = ROOT
			}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
			participation_scaled_piety = 50
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 100
				participation_scaled_piety = 50
			}
		}

		ROOT = {
			religion_authority = {
				modifier = won_county_conquest
			}
		}
	}

	on_fail_title = {
		ROOT = {
			prestige = -100
			religion_authority = {
				modifier = lost_county_conquest
			}
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			religion_authority = {
				modifier = lost_county_conquest
			}
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
			participation_scaled_piety = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = {
				participation_scaled_prestige = 100
				participation_scaled_piety = 50
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
	ai_will_do = {
		factor = 1
		modifier = {
			factor = 0.25
			holder_scope = {
				trait = phoenix_king	# To prevent excessive imperialism, leave something to the poor Princes!
			}
		}
		modifier = {
			factor = 0
			holder_scope = {
				trait = everqueen # Spiritual guide
			}
		}
	}
}
