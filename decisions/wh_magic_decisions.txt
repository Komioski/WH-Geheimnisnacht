title_decisions = {
	corrupt_pop = {
		only_playable = yes
		filter = owned

		from_potential = {
			is_landed = yes
			demesne_size = 1
			OR = {
				ai = no
				real_tier = KING #To avoid Unecessary math
			}
			OR = {
				true_religion_group = cytharai_group
				true_religion_group = necromantic_group
				true_religion_group = chaos_gods_group
			}
		}

		potential = {
			holder_scope = {
				character = FROM
			}
			tier = COUNT
			location =  {
				OR = {
					has_province_modifier = active_place_of_power_man
					has_province_modifier = active_place_of_power_elf
					has_province_modifier = active_place_of_power_wood
					has_province_modifier = inactive_place_of_power_man
					has_province_modifier = inactive_place_of_power_elf
					has_province_modifier = inactive_place_of_power_wood
				}
			}
		}

		allow = {
			trigger_if = {
				limit = {
					location =  {
						OR = {
							has_province_modifier = active_place_of_power_man
							has_province_modifier = active_place_of_power_elf
							has_province_modifier = active_place_of_power_wood

						}
					}
				}
				FROM = { piety = 250 }
			}
			trigger_if = {
				limit = {
					location =  {
						OR = {
							has_province_modifier = inactive_place_of_power_man
							has_province_modifier = inactive_place_of_power_elf
							has_province_modifier = inactive_place_of_power_wood

						}
					}
				}
				FROM = { piety = 100 }
			}
			location = {
				NOT = { has_province_modifier = drained_place_of_power }
			}
		}

		effect = {
			if = {
				limit = {
					location =  {
						OR = {
							has_province_modifier = active_place_of_power_man
							has_province_modifier = active_place_of_power_elf
							has_province_modifier = active_place_of_power_wood
						}
					}
				}
				FROM = { piety = -250 }
				holder_scope = {
					save_event_target_as = target_ruler
				}
			}
			else = {
				FROM = { piety = -100 }
				holder_scope = {
					save_event_target_as = target_ruler
				}
			}
			location = {
				trigger_switch = {
					on_trigger = has_province_modifier
					active_place_of_power_man = {
						add_province_modifier = {
							name = corrupt_place_of_power_man
							duration = -1
						}
						remove_province_modifier = active_place_of_power_man
					}
					active_place_of_power_elf = {
						add_province_modifier = {
							name = corrupt_place_of_power_elf
							duration = -1
						}
						remove_province_modifier = active_place_of_power_elf
					}
					active_place_of_power_wood = {
						add_province_modifier = {
							name = corrupt_place_of_power_wood
							duration = -1
						}
						remove_province_modifier = active_place_of_power_wood
					}
					inactive_place_of_power_man = {
						add_province_modifier = {
							name = corrupt_place_of_power_man
							duration = -1
						}
						remove_province_modifier = inactive_place_of_power_man
					}
					inactive_place_of_power_elf = {
						add_province_modifier = {
							name= corrupt_place_of_power_elf
							duration = -1
						}
						remove_province_modifier = inactive_place_of_power_elf
					}
					inactive_place_of_power_wood = {
						add_province_modifier = {
							name= corrupt_place_of_power_wood
							duration = -1
						}
						remove_province_modifier = inactive_place_of_power_wood
					}
				}
			}
			#FROM = { character_event = { id = PoP.? } }
		}
	}
	restore_pop = {
		only_playable = yes
		filter = owned

		from_potential = {
			is_landed = yes
			demesne_size = 1
			OR = {
				ai = no
				real_tier = King #To avoid Unecessary math
			}
			OR = {
				true_religion_group = old_world_group
				true_religion_group = cadai_group
			}
		}

		potential = {
			holder_scope = {
				character = FROM
			}
			tier = COUNT
			location = {
				OR = {
					has_province_modifier = corrupt_place_of_power_man
					has_province_modifier = corrupt_place_of_power_elf
					has_province_modifier = corrupt_place_of_power_wood
					has_province_modifier = inactive_place_of_power_man
					has_province_modifier = inactive_place_of_power_elf
					has_province_modifier = inactive_place_of_power_wood
				}
			}
		}

		allow = {
			trigger_if = {
				limit = {
					FROM = {
						true_religion_group = old_world_group
						NOR = {
							true_religion = kislev_gods
							true_religion = northern_gods
							true_religion = northern_gods_reformed
						}
					}
				}
				FROM = {
					has_magic_law_1_or_above_trigger = yes
					scaled_wealth = 0.5
				}
			}
			trigger_if = {
				limit = {
					FROM = {
						true_religion = kislev_gods
						true_religion = northern_gods
						true_religion = northern_gods_reformed
					}
				}
				FROM = {
					scaled_wealth = 0.5
				}
			}
			trigger_if = {
				limit = {
					location =  {
						OR = {
							has_province_modifier = corrupt_place_of_power_man
							has_province_modifier = corrupt_place_of_power_elf
							has_province_modifier = corrupt_place_of_power_wood
						}
					}
				}
				FROM = { piety = 250 }
			}
			trigger_if = {
				limit = {
					location =  {
						OR = {
							has_province_modifier = inactive_place_of_power_man
							has_province_modifier = inactive_place_of_power_elf
							has_province_modifier = inactive_place_of_power_wood
						}
					}
				}
				FROM = { piety = 100 }
			}
			location = {
				NOT = { has_province_modifier = drained_place_of_power }
			}
		}

		effect = {
			trigger_if = {
				limit = {
					FROM = { true_religion_group = old_world_group }
				}
				FROM = {
					has_magic_law_1_or_above_trigger = yes
					scaled_wealth = {
						value = 0.8
						min = 50
						max = 250
					}
				}
			}
			save_event_target_as = target_title
			if = {
				limit = {
					location = {
						OR = {
							has_province_modifier = corrupt_place_of_power_man
							has_province_modifier = corrupt_place_of_power_elf
							has_province_modifier = corrupt_place_of_power_wood
						}
					}
				}
				FROM = { piety = -250 }
				holder_scope = {
					save_event_target_as = target_ruler
				}
			}
			else = {
				FROM = { piety = -100 }
				holder_scope = {
					save_event_target_as = target_ruler
				}
			}
			location = {
				trigger_switch = {
					on_trigger = has_province_modifier
					corrupt_place_of_power_man = {
						add_province_modifier = {
							name = active_place_of_power_man
							duration = -1
						}
						remove_province_modifier = corrupt_place_of_power_man
					}
					corrupt_place_of_power_elf = {
						add_province_modifier = {
							name = active_place_of_power_elf
							duration = -1
						}
						remove_province_modifier = corrupt_place_of_power_elf
					}
					corrupt_place_of_power_wood = {
						add_province_modifier = {
							name = active_place_of_power_wood
							duration = -1
						}
						remove_province_modifier = corrupt_place_of_power_wood
					}
					inactive_place_of_power_man = {
						add_province_modifier = {
							name = active_place_of_power_man
							duration = -1
						}
						remove_province_modifier = inactive_place_of_power_man
					}
					inactive_place_of_power_elf = {
						add_province_modifier = {
							name = active_place_of_power_elf
							duration = -1
						}
						remove_province_modifier = inactive_place_of_power_elf
					}
					inactive_place_of_power_wood = {
						add_province_modifier = {
							name = active_place_of_power_wood
							duration = -1
						}
						remove_province_modifier = inactive_place_of_power_wood
					}
				}
			}
			#FROM = { character_event = { id = PoP.? } }
		}
	}
	meditate_pop_order = {
		only_playable = yes
		filter = dynasty_owned
		ai = no

		from_potential = {
			is_landed = yes
			demesne_size = 1
			tier = COUNT
			OR = {
				true_religion_group = old_world_group
				true_religion_group = cadai_group
				true_religion_group = ormazd_gods_group
			}
			is_trained_mage_trigger = yes
		}

		potential = {
			always = no #enable if you want komi, Needs flavor event
			tier = COUNT
			location =  {
				OR = {
					has_province_modifier = active_place_of_power_man
					has_province_modifier = active_place_of_power_elf
					has_province_modifier = active_place_of_power_wood
				}
			}
			holder_scope = {
				character = ROOT
			}
		}

		allow = {
			piety = 25
			location = {
				NOT = { has_province_modifier = drained_place_of_power }
			}
		}

		effect = {
			save_event_target_as = target_title
			FROM = { piety = -25 }
			holder_scope = {
				save_event_target_as = target_ruler
			}
			location = {
				add_province_modifier = {
					name = drained_place_of_power
					years = 1
				}
			}
			#FROM = { character_event = { id = PoP.? } }
		}
	}
	meditate_pop_corrupt = {
		only_playable = yes
		filter = dynasty_owned
		ai = no

		from_potential = {
			is_landed = yes
			demesne_size = 1
			tier = COUNT
			OR = {
				true_religion_group = cytharai_group
				true_religion_group = necromantic_group
				true_religion_group = chaos_gods_group
				true_religion_group = ormazd_gods_group
			}
			is_trained_mage_trigger = yes
		}

		potential = {
			always = no #enable if you want komi, Needs flavor event
			tier = COUNT
			location =  {
				OR = {
					has_province_modifier = corrupt_place_of_power_man
					has_province_modifier = corrupt_place_of_power_elf
					has_province_modifier = corrupt_place_of_power_wood
				}
			}
			holder_scope = {
				character=root
			}
		}

		allow = {
			piety = 25
			NOT = { has_province_modifier = drained_place_of_power }
		}

		effect = {
			save_event_target_as = target_title
			FROM = { piety = -25 }
			holder_scope = {
				save_event_target_as = target_ruler
			}
			location = {
				add_province_modifier = {
					name = drained_place_of_power
					years = 1
				}
			}
			#FROM = { character_event = { id = PoP.? } }
		}
	}
}
decisions = {
	drink_elixir_of_eternal_youth = {
		is_high_prio = yes
		ai_check_interval = 12

		potential = {
			has_artifact = elixir_of_eternal_youth
			is_immortal_trigger = no
			NOT = { trait = immortal }
		}

		allow = {
			is_adult = yes
			prisoner = no
		}

		effect = {
			ROOT = {
				unsafe_destroy_artifact = elixir_of_eternal_youth
				add_trait = immortal
			}
		}

		ai_will_do = {
			factor = 1
		}
	}
	drink_potion = {
		is_high_prio = yes
		ai_check_interval = 12

		potential = {
			OR = {
				has_artifact = potion_of_healing
				has_artifact = potion_of_beauty
				has_artifact = potion_of_speed
				has_artifact = potion_of_strength
			}
		}
		allow = {
			is_adult = yes
			prisoner = no
		}
		effect = {
			ROOT = { character_event = { id = mageproc.4 } }
		}
		ai_will_do = {
			factor = 0.5
		}
	}
	drink_elixir ={
		is_high_prio = yes
		ai_check_interval = 12

		potential = {
			OR = {
				has_artifact = elixir_of_the_marshall
				has_artifact = elixir_of_the_diplomat
				has_artifact = elixir_of_the_steward
				has_artifact = elixir_of_the_spy
			}
		}
		allow = {
			is_adult = yes
			prisoner = no
		}
		effect = {
			ROOT = { character_event = { id = mageproc.2 } }
		}
		ai_will_do = {
			factor = 0.5
		}
	}
	consume_warpstone = {
		is_high_prio = yes
		ai_check_interval = 6
		only_playable = yes

		potential = {
			custom_tooltip = {
				text = "Must possess Warpstone"
				OR = {
					has_artifact = warpstone_shard
					has_artifact = warpstone_dust
					has_artifact = warpstone_cluster
				}
			}
		}

		allow = {
			custom_tooltip = {
				text = "Must possess Warpstone"
				age = 16
				prisoner = no
				OR = {
					has_artifact = warpstone_shard
					has_artifact = warpstone_dust
					has_artifact = warpstone_cluster
				}
			}
		}

		effect = {
			ROOT = { character_event = { id = mageproc.3 } }
		}

		ai_will_do = {
			factor = 0.1
			modifier = {
				factor = 0
				culture_group = lizardman_group
			}
			modifier = {
				factor = 0
				trait = content
			}
			modifier = {
				factor = 3
				trait = greedy
			}
			modifier = {
				factor = 0
				trait = temperate
			}
			modifier = {
				factor = 10
				trait = addict
			}
			modifier = {
				factor = 5
				trait = lore_necromancy
			}
		}
	}
	consume_mushroom = {
		is_high_prio = yes
		ai_check_interval = 6
		only_playable = yes

		potential = {
			religion_group = greenskin_gods_group
			custom_tooltip = {
				text = "Must possess Mushroom"
				OR = {
					has_artifact = scarlet_elf_cap_mushroom
					has_artifact = madcap_mushroom
				}
			}
		}

		allow = {
			age = 16
			prisoner = no
			custom_tooltip = {
				text = "Must possess Mushroom"
				OR = {
					has_artifact = scarlet_elf_cap_mushroom
					has_artifact = madcap_mushroom
				}
			}
		}

		effect = {
			ROOT = { character_event = { id = mageproc.43 } }
		}

		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 1
				culture_group = orc_group
			}
			modifier = {
				factor = 2
				culture_group = goblin_group
			}
			modifier = {
				factor = 0
				trait = content
			}
			modifier = {
				factor = 3
				trait = greedy
			}
			modifier = {
				factor = 0
				trait = temperate
			}
			modifier = {
				factor = 10
				trait = addict
			}
		}
	}
	spirit_reinforcements = {
		ai_check_interval = 12
		is_high_prio = yes
		only_playable=yes #To stop Courtiers from worrying about this
		potential = {
			age = 16
			NOT = { has_character_modifier = magic_cooldown }
			trait = creature_forestspirit
			OR = {
				any_current_enemy = {
					at_location = ROOT
					in_command = yes
				}
				any_current_enemy = {
					any_vassal = {
						at_location = ROOT
						in_command = yes
					}
				}
				any_current_enemy = {
					any_vassal = {
						any_vassal = {
							at_location = ROOT
							in_command = yes
						}
					}
				}
				any_current_enemy = {
					any_vassal = {
						any_vassal = {
							any_vassal = {
								at_location = ROOT
								in_command = yes
							}
						}
					}
				}
				any_current_enemy = {
					any_vassal = {
						any_vassal = {
							any_vassal = {
								any_vassal = {
									at_location = ROOT
									in_command = yes
								}
							}
						}
					}
				}
			}
		}

		allow = {
			age = 16
			NOT = { has_character_modifier = magic_cooldown }
			trait = creature_forestspirit

			OR = {
				any_current_enemy = {
					at_location = ROOT
					in_command = yes
				}
				any_current_enemy = {
					any_vassal = {
						at_location = ROOT
						in_command = yes
					}
				}
				any_current_enemy = {
					any_vassal = {
						any_vassal = {
							at_location = ROOT
							in_command = yes
						}
					}
				}
				any_current_enemy = {
					any_vassal = {
						any_vassal = {
							any_vassal = {
								at_location = ROOT
								in_command = yes
							}
						}
					}
				}
				any_current_enemy = {
					any_vassal = {
						any_vassal = {
							any_vassal = {
								any_vassal = {
									at_location = ROOT
									in_command = yes
								}
							}
						}
					}
				}
			}
		}

		effect = {
			ROOT = {
				add_character_modifier = {
					name = magic_cooldown
					duration = 100
					hidden = yes
				}
				character_event = { id = asrai.40 days = 60 }
				location = {
					ROOT = {
						spawn_unit = {
							province = PREV
							troops = {
								magical_spells = { 250 250 }
							}
							earmark = spirit_troops
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 1000
		}
	}
	walk_between_worlds = {
		ai_check_interval = 12
		is_high_prio = yes
		potential = {
			age = 16
			is_incapacitated_trigger = no
			NOT = { has_character_modifier = magic_cooldown }
			trait = asrai_spellsinger
			trait = creature_elf
			in_command = yes
			OR = {
				has_character_modifier = magic_power_1
				has_character_modifier = magic_power_2
				has_character_modifier = magic_power_3
				has_character_modifier = magic_power_4
			}
		}
		allow = {
			in_command = yes
		}

		effect = {
			if = {
				limit = {
					religion = asrai_cadai
					NOT = { trait = creature_forestspirit }
				}
				piety = -100
			}
			add_character_modifier = {
				name = magic_cooldown
				duration = 300
				hidden = yes
			}
			hidden_tooltip = {
				random_list = {
					50 = {
						character_event = { id = aiclean.10 }
					}
					50 = {
						add_trait = woodwalking
						character_event = { id = aiclean.11 days = 100 random = 30 }
						modifier = {
							factor = 1.25
							has_character_modifier = magic_power_2
						}
						modifier = {
							factor = 1.5
							has_character_modifier = magic_power_3
						}
						modifier = {
							factor = 2
							has_character_modifier = magic_power_4
						}
						modifier = {
							factor = 1.25
							trait = genius
						}
						modifier = {
							factor = 0.75
							trait = dim
						}
						modifier = {
							factor = 0.5
							trait = slow
						}
						modifier = {
							factor = 0.25
							trait = idiot
						}
						modifier = {
							factor = 0.5
							trait = imbecile
						}
						modifier = {
							factor = 0.75
							trait = wroth
						}
						modifier = {
							factor = 0.75
							trait = slothful
						}
						modifier = {
							factor = 0.75
							trait = infirm
						}
					}
				}
			} #closeshiddentooltip
		}

		revoke_allowed = { always = yes }

		ai_will_do = { factor = 1
			modifier = {
				factor = 0.1
				trait = brave
			}
			modifier = {
				factor = 0.5
				religion = asrai_cadai
				NOT = { piety = 250 }
			}
		 }
	}
	 # Slaaneshi/Atharti/CoP remove imperfection
	 # removes scar, disfigured, fat, undernourished, any mutation
	hide_deformity_spells = {
		ai_check_interval = 4
		potential = {
			is_incapacitated_trigger = no
			age = 16
			NOT = { has_character_modifier = hds_magic_cooldown }
			OR = {
				trait = lore_dark_magic
				trait = lore_tzeentch
				trait = lore_slaanesh
			}
			OR = {
				trait = scarred
				trait = disfigured
				trait = is_fat
				trait = is_malnourished
			}
			OR = {
				has_character_modifier = magic_power_1
				has_character_modifier = magic_power_2
				has_character_modifier = magic_power_3
				has_character_modifier = magic_power_4
			}
		}
		allow = {
			OR = {
				trait = lore_dark_magic
				trait = lore_tzeentch
				trait = lore_slaanesh
			}
		}

		effect = {
			if = {
				limit = {
					religion = asrai_cadai
					NOT = { trait = creature_forestspirit }
				}
				piety = -200
			}
			add_character_modifier = {
				name = hds_magic_cooldown
				duration = 600
				hidden = yes
			}
			hidden_tooltip = {
				random_list = {
					25 = {
						character_event = { id = aiclean.10 }
					}
					75 = {
						character_event = { id = spleasure.90 }
						modifier = {
							factor = 1.25
							has_character_modifier = magic_power_2
						}
						modifier = {
							factor = 1.5
							has_character_modifier = magic_power_3
						}
						modifier = {
							factor = 2
							has_character_modifier = magic_power_4
						}
						modifier = {
							factor = 1.25
							trait = genius
						}
						modifier = {
							factor = 0.75
							trait = dim
						}
						modifier = {
							factor = 0.5
							trait = slow
						}
						modifier = {
							factor = 0.25
							trait = idiot
						}
						modifier = {
							factor = 0.5
							trait = imbecile
						}
						modifier = {
							factor = 0.75
							trait = wroth
						}
						modifier = {
							factor = 0.75
							trait = slothful
						}
						modifier = {
							factor = 0.75
							trait = infirm
							}
						modifier = {
							factor = 0.5
							trait = hedge_wizard
						}
					}
				}
			} #closeshiddentooltip
		}

		revoke_allowed = { always = yes }

		ai_will_do = { factor = 0 }
	}
	learn_magic_yourself = { #for private characters studying by themselves
		ai_check_interval = 12
		is_high_prio = yes
		potential = {
			learning = 12
			OR={
				has_focus = focus_scholarship
				trait = mystic #Will always try on their own
			}
			#has_focus = focus_theology #For Holy Lores of magic?
			OR = {
				higher_tier_than = BARON
				AND = {
					is_lowborn = no
					is_landed = no
					OR = {
						any_liege = {
							is_trained_mage_trigger = yes
						}
						any_dynasty_member_even_if_dead = {
							is_trained_mage_trigger = yes
						}
						any_owned_bloodline = {
							has_bloodline_flag = magic_legacy
							bloodline_is_active_for = PREV
						}
					}
				}
			}
			is_incapacitated_trigger = no
			age = 12
			NOT = { is_trained_mage_trigger = yes }
			is_incapable = no
			is_incapacitated_trigger = no
			NOR = {
				trait = witch_hunter
				religion = khorne
				trait = vampire_blood_hidden
				trait = vampire_blood_visible
				has_character_flag = taken_hedge_wizard_decision
				top_liege = { trait = malekith }
				trait = hedge_wizard
				culture_group = dwarf_group
			}
			is_vampire_trigger = no
		}

		allow = {
			OR={
				learning = 16 #Requires Proper Booksmart
				trait = magic_potential_3 #Effortless
				trait = magic_potential_4 #Effortless
				trait = erudite
				trait = faqih
				trait = scholar
				trait = mystic
			}
			OR = {
				AND = {
					trait = creature_human
					OR = {
						independent = yes
						has_magic_law_2_trigger = yes
						NOT = { has_magic_law_any_trigger = yes }
						AND = {
							#Ice Witches, Araby men etc
							has_magic_law_any_trigger = yes
							NOT = { check_if_mage_should_be_burned_trigger = yes }
						}
					}
				}
				trait = creature_amazon
				trait = creature_elf
				trait = fimir_dirach
				trait = fimir_maergh
			}
			NOT = { has_magic_law_3_trigger = yes }
		}

		effect = {
			add_trait = hedge_wizard
			hidden_tooltip = {
				set_character_flag = taken_hedge_wizard_decision
				if = {
					limit = { NOT = { age = 16 } }
					set_character_flag = learning_as_kid
				}
				character_event = { id = MageAp.12 } #Start studying
				if = {
					limit = {
						religion_group = cadai_group
						e_ulthuan = { holder_scope  = { religion_group = cadai_group } }
					}
					e_ulthuan = { holder_scope  = { opinion = { modifier = opinion_unauthorized_tutoring who = ROOT } } }
				}
				if = {
					limit = {
						religion_group = cytharai_group
						is_female = yes
						e_naggaroth = { holder_scope  = { trait = malekith } }
					}
					e_naggaroth = { holder_scope  = { opinion = { modifier = opinion_unauthorized_tutoring who = ROOT } } }
				}
				if = {
					limit = {
						trait = creature_elf
						is_female = no
						e_naggaroth = { holder_scope  = { trait = malekith } }
					}
					e_naggaroth = { holder_scope  = { opinion = { modifier = opinion_sorcerous_rival who = ROOT } } }
				}
			}
		}

		revoke_allowed = { always = yes }

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05
				NOR = {
					any_liege = {
						is_trained_mage_trigger = yes
					}
					any_dynasty_member_even_if_dead = {
						is_trained_mage_trigger = yes
					}
					any_owned_bloodline = {
						has_bloodline_flag = magic_legacy
						bloodline_is_active_for = PREV
					}
					learning=20 #Dont feel this being an hinderance
					trait=mystic #Will attempt on their own
				}
			}

			modifier = {
				factor = 0.7
				OR = {
					any_liege = {
						is_trained_mage_trigger = yes
					}
					any_dynasty_member_even_if_dead = {
						is_trained_mage_trigger = yes
					}
					any_owned_bloodline = {
						has_bloodline_flag = magic_legacy
						bloodline_is_active_for = PREV
					}
				}
			}
			modifier = {
				factor = 0
				trait = creature_human
				has_magic_law_any_trigger = yes
				NOR = {
					independent = yes
					trait = mystic #Mystics Tend to try on their own
					has_magic_law_2_trigger = yes
				}
			}
			modifier = {
				factor = 5
				learning = 20
			}
			modifier = {
				factor = 1.5
				magic_potential_trigger = yes
			}
			modifier = {
				factor = 4
				trait = magic_potential_3
			}
			modifier = {
				factor = 10
				OR={
					trait = magic_potential_4
					trait = mystic
				}
			}
			modifier = {
				factor = 0
				NOR={
					trait = mystic
					true_religion_group=chaos_gods_group
				}
				NOT = { supports_legal_magic_trigger = yes }
			}
			modifier = {
				factor = 0
				NOR={
					trait = mystic
					true_religion_group=chaos_gods_group
					has_magic_law_2_trigger = yes
				}
				OR={
					trait = content
					trait = zealous
				}
			}

		}
	}
	learn_necromancy_yourself = { #for private characters studying by themselves
		ai_check_interval = 12
		is_high_prio = yes
		potential = {
			OR = {
				higher_tier_than = BARON
				AND = {
					is_lowborn = no
					is_landed = no
					OR = {
						any_liege = {
							is_trained_mage_trigger = yes
						}
						any_dynasty_member_even_if_dead = {
							is_trained_mage_trigger = yes
						}
					}
				}
			}
			prisoner = no
			age = 16
			is_incapable = no
			is_incapacitated_trigger = no
			NOT = { is_trained_mage_trigger = yes }
			NOR = {
				trait = witch_hunter
				religion = khorne
				has_character_flag = taken_hedge_wizard_decision
				has_character_flag = taken_necromancer_decision
				top_liege = { trait = malekith }
				trait = king_settra
				trait = hedge_wizard
				trait = mage_apprentice
				trait = vampire_blood_visible
				trait = vampire_blood_hidden
				trait = vampire_jade_visible
				trait = vampire_jade_hidden
			}
			OR = {
				trait = creature_human
				trait = khemri_tomb_king
			}
			OR = {
				is_vampire_trigger = yes
				trait = widowed
				trait = impaler
				trait = mystic
				religion = vampiric
				religion = nagashi
				religion = shadowmen
				has_character_modifier = the_necronomicon
				has_character_flag = undead_insight
			}
		}

		allow = {
			learning = 15
			wealth = 50
			OR = {
				independent = yes
				NOT = { has_magic_law_any_trigger = yes }
			}
		}

		effect = {
			wealth = -50
			add_trait = hedge_wizard
			hidden_tooltip = {
				set_character_flag = taken_necromancer_decision
				if = {
					limit = { NOT = { age = 16 } }
					set_character_flag = learning_as_kid
				}
				character_event = { id = MageAp.15 } #Start studying
				if = {
					limit = {
						religion_group = cadai_group
						e_ulthuan = { holder_scope  = { religion_group = cadai_group } }
					}
					e_ulthuan = { holder_scope  = { opinion = { modifier = opinion_unauthorized_tutoring who = ROOT } } }
				}
				if = {
					limit = {
						religion_group = cytharai_group
						is_female = yes
						e_naggaroth = {
						holder_scope  = { trait = malekith } }
					}
					e_naggaroth = { holder_scope  = { opinion = { modifier = opinion_unauthorized_tutoring who = ROOT } } }
				}
				if = {
					limit = {
						trait = creature_elf
						is_female = no
						e_naggaroth = { holder_scope  = { trait = malekith } }
					}
					e_naggaroth = { holder_scope  = { opinion = { modifier = opinion_sorcerous_rival who = ROOT } } }
				}
			}
		}

		revoke_allowed = { always = yes }

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.001
			}
			modifier = {
				factor = 0.01
				NOT = { wealth = 150 }
			}
			modifier = {
				factor = 10
				has_character_flag = undead_insight
			}
			modifier = {
				factor = 10
				OR = {
					religion = vampiric
					religion = nagashi
					religion = shadowmen
				}
			}
			modifier = {
				factor = 10
				is_vampire_trigger = yes
			}
			modifier = {
				factor = 5
				learning = 20
			}
			modifier = {
				factor = 3
				magic_potential_trigger = yes
			}
			modifier = {
				factor = 4
				trait = magic_potential_3
			}
			modifier = {
				factor = 10
				trait = magic_potential_4
			}
			modifier = {
				factor = 0
				NOT = { has_character_flag = undead_insight }
				NOT = { trait = ambitious }
				NOT = { trait = scholar }
				NOT = { trait = mystic }
				NOT = { trait = envious }
				NOT = { trait = cruel }
				NOT = { trait = depressed }
				NOT = { has_character_modifier = fake_mage }
			}
		}
	}
	hunt_demon_down = {
		ai_check_interval = 36 #Whats the rush
		potential = {
			prisoner = no
			is_ruler = yes
			higher_tier_than = BARON
			NOT = { religion_group = chaos_gods_group }
			NOT = {
				any_friend = {
					OR = { trait = khorne_demon
						trait = nurgle_demon
						trait = slaanesh_demon
						trait = tzeentch_demon
						trait = undivided_demon
					}
				}
			}
			age = 12
			NOT = { trait = incapable }
			#has_any_opinion_modifier = opinion_demon_havoc
			any_courtier = {
				OR = {
					trait = undivided_demon
					trait = khorne_demon
					trait = nurgle_demon
					trait = slaanesh_demon
					trait = tzeentch_demon
				}
				is_ruler = no
			}
		}

		allow = {
			wealth = 150
		}

		effect = { wealth = -150
			hidden_tooltip = { random_courtier = { limit = { OR = {
					trait = khorne_demon
					trait = nurgle_demon
					trait = slaanesh_demon
					trait = tzeentch_demon
					trait = undivided_demon
			} }
			character_event = { id = sdemons.4 days = 4 } } }
		}

		revoke_allowed = { always = yes }

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 1.5
				trait = brave
			}
			modifier = {
				factor = 1.25
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = craven
			}
			modifier = {
				factor = 0.75
				trait = shy
			}
			modifier = {
				factor = 0.05
				is_cultist_trigger = yes
			}
		}
	}
	grant_title_teacher_mage = {
		ai_check_interval = 42
		potential = {
			ai = yes
			can_grant_title_teacher_mage_trigger = yes
			NOT = {
				any_courtier = {
					has_minor_title = title_teacher_mage
				}
			}
		}

		allow = {
		}

		effect = {
			random_courtier = {
				limit = {
					can_hold_title_teacher_mage_trigger = yes
				}
				give_minor_title = title_teacher_mage
			}

		}

		ai_will_do = {
			factor = 1
		}
	}
}
targetted_decisions = {
#Ogre Eat
	ogre_eat_prisoner = {
		ai_check_interval = 6
		filter = court
		ai_target_filter = court
		only_rulers = yes
		from_potential = {
			primary_title = { higher_tier_than = BARON }
			NOT = { trait = incapable }
			is_adult = yes
			OR = {
				trait = creature_ogre
				trait = orc_huge
			}
		}
		potential = {
			prisoner = yes
			primary_title = { higher_tier_than = BARON }
			NOT = { trait = incapable }
			host = { character = FROM }
		}
		allow = {
			prisoner = yes
		}
		effect = {
			FROM = {
				channeling_effect = yes
			}
			hidden_tooltip = { FROM = { character_event = { id = ogre.1 } } }
			prisoner = no
			if = {
				limit = { is_invincible_trigger = yes }
				antideath_effect = yes
				break = yes
			}
			death = {
				death_reason = death_execution_eaten
				killer = FROM
			}
			hidden_tooltip = {
				FROM = {
					any_vassal = {
						limit = { religion = cadai }
						opinion = {
							modifier = opinion_barbaric
							who = FROM
						}
					} #closes anyvassal
				} #closes from
				any_dynasty_member = {
					limit = { religion_group = cytharai_group }
					opinion = {
						modifier = opinion_eaten_family_druchii
						who = FROM
					}
				} #closes anydynastyme
				any_dynasty_member = {
					limit = { NOT = { religion_group = cytharai_group } }
					opinion = {
						modifier = opinion_eaten_family
						who = FROM
					}
				}
			}
			FROM = {
				remove_opinion = { who = ROOT modifier = opinion_traitor }
				remove_opinion = { who = ROOT modifier = opinion_rebel_traitor }
				remove_opinion = { who = ROOT modifier = opinion_dishonorable }
			}
			FROM = {
				if = {
					limit = { NOT = { trait = cruel } }
					random = {
						chance = 10
						add_trait = cruel
						hidden_tooltip = {
							character_event = { id = 38259 } #Notify Cruel
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.25
			}
			modifier = {
				factor = 0.4
				reverse_opinion = { who = FROM value = 20 }
			}
			modifier = {
				factor = 0.25
				reverse_opinion = { who = FROM value = 40 }
			}
			modifier = {
				factor = 5
				NOT = { reverse_opinion = { who = FROM value = -25 } }
			}
			modifier = {
				factor = 0.5
				FROM = { war = yes }
			}
			modifier = {
				factor = 1.5
				trait = gluttonous
			}
			modifier = {
				factor = 0.75
				prestige = 200
			}
			modifier = {
				factor = 0.05
				prestige = 1000
			}
			modifier = {
				factor = 0.2
				FROM = { trait = kind }
			}
			modifier = {
				factor = 2
				ROOT = { trait = cruel }
			}
		}
	}
	prisonersteal_carstein_ring = {
		ai_check_interval = 12
 		is_high_prio = yes
		filter = court
		ai_target_filter = court
		only_rulers = yes
		from_potential = {
				has_global_flag = carstein_ring_revealed
				is_ruler = yes
		}
		potential = {
			prisoner = yes
			has_artifact = carstein_ring
		}
		allow = {
			prisoner = yes
		}
		effect = {
			hidden_tooltip = { character_event = { id = svampires.13 } }
			FROM  = { set_character_flag = prisoner_claim_ring }
		}
		ai_will_do = {
			factor = 1
		}
	}
	healing_spell = {
		ai_check_interval = 6
		filter = court
		ai_target_filter = court
		from_potential = {
			trait = lore_high_magic
			NOT = { trait = incapable }
			NOT = { trait = infirm }
			is_incapacitated_trigger = no
			NOT = { has_character_modifier = magic_cooldown }
				OR = { has_character_modifier = magic_power_1
					has_character_modifier = magic_power_2
					has_character_modifier = magic_power_3
					has_character_modifier = magic_power_4 }
		}
		potential = {
				#host = FROM
				OR = { trait = wounded
					trait = maimed
					trait = incapable
					trait = troubled_pregnancy
					trait = hard_pregnancy
					trait = disfigured }
			is_undead_trigger = no
		}

		allow = {

		}

		effect = {
			if = { limit = { FROM = { religion = asrai_cadai
						NOT = { trait = creature_forestspirit } } }
				piety = -100 }
		hidden_tooltip = {
			FROM = { add_character_modifier = { name = magic_cooldown
						duration = 300
						hidden = yes } }
			if = { limit = { trait = wounded }
				random_list = { 60 = { remove_trait = wounded }
						40 = { character_event = { id = aiclean.10 }
							modifier = { factor = 0.75
									FROM = { has_character_modifier = magic_power_2 }
									}
							modifier = { factor = 0.5
									FROM = { has_character_modifier = magic_power_3 }
									}
							modifier = { factor = 0.25
									FROM = { has_character_modifier = magic_power_4 }
									}
							modifier = { factor = 0.75
									FROM = { trait = genius }
									}
							modifier = { factor = 1.5
									FROM = { trait = dim }
									}
							modifier = { factor = 2
									FROM = { trait = slow }
									}
							modifier = { factor = 3
									FROM = { trait = idiot }
									}
							modifier = { factor = 4
									FROM = { trait = imbecile }
									}
							modifier = { factor = 1.25
									FROM = { trait = wroth }
									}
							modifier = { factor = 1.25
									FROM = { trait = slothful }
									}
								modifier = {
									factor = 1.5
									FROM = { trait = hedge_wizard }
									}
							 }
						 }
				} #closesif
			if = { limit = { trait = maimed }
				random_list = { 50 = { remove_trait = maimed }
						50 = {  character_event = { id = aiclean.10 }
							modifier = { factor = 0.75
									FROM = { has_character_modifier = magic_power_2 }
									}
							modifier = { factor = 0.5
									FROM = { has_character_modifier = magic_power_3 }
									}
							modifier = { factor = 0.25
									FROM = { has_character_modifier = magic_power_4 }
									}
							modifier = { factor = 0.75
									FROM = { trait = genius }
									}
							modifier = { factor = 1.5
									FROM = { trait = dim }
									}
							modifier = { factor = 2
									FROM = { trait = slow }
									}
							modifier = { factor = 3
									FROM = { trait = idiot }
									}
							modifier = { factor = 4
									FROM = { trait = imbecile }
									}
							modifier = { factor = 1.25
									FROM = { trait = wroth }
									}
							modifier = { factor = 1.25
									FROM = { trait = slothful }
									}
								modifier = {
									factor = 1.5
									FROM = { trait = hedge_wizard }
									}
							 }
						 }
				} #closesif
			if = { limit = { trait = incapable }
				random_list = { 40 = { remove_trait = incapable }
						60 = { character_event = { id = aiclean.10 }
							modifier = { factor = 0.75
									FROM = { has_character_modifier = magic_power_2 }
									}
							modifier = { factor = 0.5
									FROM = { has_character_modifier = magic_power_3 }
									}
							modifier = { factor = 0.25
									FROM = { has_character_modifier = magic_power_4 }
									}
							modifier = { factor = 0.75
									FROM = { trait = genius }
									}
							modifier = { factor = 1.5
									FROM = { trait = dim }
									}
							modifier = { factor = 2
									FROM = { trait = slow }
									}
							modifier = { factor = 3
									FROM = { trait = idiot }
									}
							modifier = { factor = 4
									FROM = { trait = imbecile }
									}
							modifier = { factor = 1.25
									FROM = { trait = wroth }
									}
							modifier = { factor = 1.25
									FROM = { trait = slothful }
									}
								modifier = {
									factor = 1.5
									FROM = { trait = hedge_wizard }
									}
							 }
						 }
				} #closesif
			if = { limit = { trait = troubled_pregnancy }
				random_list = { 40 = { remove_trait = troubled_pregnancy }
						60 = {  character_event = { id = aiclean.10 }
							modifier = { factor = 0.75
									FROM = { has_character_modifier = magic_power_2 }
									}
							modifier = { factor = 0.5
									FROM = { has_character_modifier = magic_power_3 }
									}
							modifier = { factor = 0.25
									FROM = { has_character_modifier = magic_power_4 }
									}
							modifier = { factor = 0.75
									FROM = { trait = genius }
									}
							modifier = { factor = 1.5
									FROM = { trait = dim }
									}
							modifier = { factor = 2
									FROM = { trait = slow }
									}
							modifier = { factor = 3
									FROM = { trait = idiot }
									}
							modifier = { factor = 4
									FROM = { trait = imbecile }
									}
							modifier = { factor = 1.25
									FROM = { trait = wroth }
									}
							modifier = { factor = 1.25
									FROM = { trait = slothful }
									}
								modifier = {
									factor = 1.5
									FROM = { trait = hedge_wizard }
									}
							 }
						 }
				} #closesif
			if = { limit = { trait = hard_pregnancy }
				random_list = { 50 = { remove_trait = hard_pregnancy }
						50 = {  character_event = { id = aiclean.10 }
							modifier = { factor = 0.75
									FROM = { has_character_modifier = magic_power_2 }
									}
							modifier = { factor = 0.5
									FROM = { has_character_modifier = magic_power_3 }
									}
							modifier = { factor = 0.25
									FROM = { has_character_modifier = magic_power_4 }
									}
							modifier = { factor = 0.75
									FROM = { trait = genius }
									}
							modifier = { factor = 1.5
									FROM = { trait = dim }
									}
							modifier = { factor = 2
									FROM = { trait = slow }
									}
							modifier = { factor = 3
									FROM = { trait = idiot }
									}
							modifier = { factor = 4
									FROM = { trait = imbecile }
									}
							modifier = { factor = 1.25
									FROM = { trait = wroth }
									}
							modifier = { factor = 1.25
									FROM = { trait = slothful }
									}
								modifier = {
									factor = 1.5
									FROM = { trait = hedge_wizard }
									}
							 }
						 }
				} #closesif
			if = { limit = { trait = disfigured }
				random_list = { 50 = { remove_trait = disfigured }
						50 = {  character_event = { id = aiclean.10 }
							modifier = { factor = 0.75
									FROM = { has_character_modifier = magic_power_2 }
									}
							modifier = { factor = 0.5
									FROM = { has_character_modifier = magic_power_3 }
									}
							modifier = { factor = 0.25
									FROM = { has_character_modifier = magic_power_4 }
									}
							modifier = { factor = 0.75
									FROM = { trait = genius }
									}
							modifier = { factor = 1.5
									FROM = { trait = dim }
									}
							modifier = { factor = 2
									FROM = { trait = slow }
									}
							modifier = { factor = 3
									FROM = { trait = idiot }
									}
							modifier = { factor = 4
									FROM = { trait = imbecile }
									}
							modifier = { factor = 1.25
									FROM = { trait = wroth }
									}
							modifier = { factor = 1.25
									FROM = { trait = slothful }
									}
								modifier = {
									factor = 1.5
									FROM = { trait = hedge_wizard }
									}
							 }
						 }
				} #closesif


			} #closeshiddentooltip
		}

		revoke_allowed = { always = yes }

		ai_will_do = { factor = 1

			modifier = {
				factor = 0
				NOT = { FROM = { trait = kind } }
				NOT = { FROM = { dynasty = ROOT } }
			}
			modifier = {
				factor = 0.1
				FROM = { trait = envious }
			}
			modifier = {
				factor = 0.25
				religion = asrai_cadai
				NOT = { piety = 250 }
			}
		 }
	}
	exorcism_spell = {
		ai_check_interval = 12
		filter = court
		ai_target_filter = court
		from_potential = {

			OR = { trait = lore_high_magic
				trait = lore_light }
			NOT = { trait = incapable }
			NOT = { trait = infirm }
			NOT = { trait = troubled_pregnancy }
			NOT = { has_character_modifier = magic_cooldown }
				OR = { has_character_modifier = magic_power_1
					has_character_modifier = magic_power_2
					has_character_modifier = magic_power_3
					has_character_modifier = magic_power_4 }
		}
		potential = {
			 trait = possessed
			NOT = { culture_group = daemonic_group }
			is_undead_trigger = no
		}

		allow = {
			piety = 50

		}

		effect = {
			piety = -50
			if = { limit = { FROM = { religion = asrai_cadai
						NOT = { trait = creature_forestspirit } } }
				piety = -100 }
		hidden_tooltip = {
			FROM = { add_character_modifier = { name = magic_cooldown
						duration = 300
						hidden = yes } }

					random_list = { 40 = { character_event = { id = schaos.79 } #success

								modifier = { factor = 0.75
										ROOT = { trait = magic_potential_3 }
										}
								modifier = { factor = 0.5
										ROOT = { trait = magic_potential_4 }
										}
								modifier = { factor = 0.25
										FROM = { has_character_modifier = magic_power_1 }
										}
								modifier = { factor = 0.75
										FROM = { has_character_modifier = magic_power_2 }
										}
								modifier = { factor = 1.25
										FROM = { has_character_modifier = magic_power_3 }
										}
								modifier = { factor = 1.75
										FROM = { has_character_modifier = magic_power_4 }
										}
								modifier = { factor = 1.5
										FROM = { trait = magic_potential_3 }
										}
								modifier = { factor = 1.95
										FROM = { trait = magic_potential_4 }
										}
								modifier = { factor = 1.75
										FROM = { trait = genius }
										}
								modifier = { factor = 1.5
										FROM = { trait = brilliant }
										}
								modifier = { factor = 1.45
										FROM = { trait = smart }
										}
								modifier = { factor = 1.35
										FROM = { trait = quick }
										}
								modifier = { factor = 1.25
										FROM = { trait = bright }
										}
								modifier = { factor = 0.95
										FROM = { trait = dim }
										}
								modifier = { factor = 0.75
										FROM = { trait = dumb }
										}
								modifier = { factor = 0.5
										FROM = { trait = slow }
										}
								modifier = { factor = 0.45
										FROM = { trait = idiot }
										}
								modifier = { factor = 0.25
										FROM = { trait = imbecile }
										}
								modifier = {
									factor = 0.5
									FROM = { trait = hedge_wizard }
									}
								}
							40 = { character_event = { id = schaos.80 } #failure
								}
							20 = { character_event = { id = schaos.81 } #deadly failure
								}
							}
			} #closeshiddentooltip
		}

		revoke_allowed = { always = yes }

		ai_will_do = { factor = 1

			modifier = {
				factor = 0.5
				NOT = { FROM = { trait = kind } }
				NOT = { FROM = { dynasty = ROOT } }
			}
			modifier = {
				factor = 0.1
				FROM = { trait = envious }
			}
			modifier = {
				factor = 0.25
				religion = asrai_cadai
				NOT = { piety = 250 }
			}
			modifier = {
				factor = 10
				FROM = { religion = sigmarite }
			}
			modifier = {
				factor = 2
				FROM = { liege = { character = ROOT } }
			}
			modifier = {
				factor = 2
				FROM = { trait = creature_elf }
			}
		 }
	}
	#the version for objects is a normal decision activated by having the proper traits
	vassal_possess_ritual = {
		ai_check_interval = 6
		only_playable = yes
		filter = court
		ai_target_filter = court

		from_potential = {
				primary_title = { higher_tier_than = BARON }
				is_incapacitated_trigger = no
				NOT = { has_character_modifier = magic_cooldown_summoning }
			OR = { trait = lore_tzeentch
				trait = lore_nurgle
				trait = lore_slaanesh
				trait = lore_dark_magic
				trait = chaos_dwarf_sorcerer
				trait = lore_shadows
				trait = bray_shaman }
			OR = { has_character_modifier = magic_power_3
				has_character_modifier = magic_power_4 }
			 }
		potential = {
			prisoner = yes
			is_pregnant = no
			host = { character = FROM }
				NOT = { trait = avatar_kurnous }
				NOT = { trait = avatar_isha }
				NOT = { trait = everqueen }
			OR = { trait = creature_elf
				trait = creature_chaos_dwarf
				trait = creature_dwarf
				trait = creature_human
				trait = creature_amazon
				trait = creature_beastman }
			is_vampire_trigger = no
			}
		allow = { prisoner = yes
			FROM = { piety = 150
			OR = { has_character_modifier = magic_power_3
				has_character_modifier = magic_power_4 } } }
		effect = {
			hidden_tooltip = {
			FROM = {
			hidden_tooltip = { random = { chance = 20
							character_event = { id = mutation.1 days = 100 random = 100 } } }
				add_character_modifier = { name = magic_cooldown_summoning
							duration = 300
							hidden = yes }
				character_event = { id = schaos.17 } } } #receive event and decide what to do

				FROM = {
					remove_opinion = { who = ROOT modifier = opinion_traitor }
					remove_opinion = { who = ROOT modifier = opinion_rebel_traitor }
					remove_opinion = { who = ROOT modifier = opinion_dishonorable }
					}
				piety = -150
				FROM = { if = { limit = { NOT = { trait = cruel } }
						random = {
							chance = 70
							add_trait = cruel
							hidden_tooltip = { character_event = { id = 38259 } #Notify Cruel
									}
							}
						} #closes if
					} #closesfrom
			} #closes effect

		revoke_allowed = { always = no }
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.15
				}
			modifier = {
				factor = 0.4
				reverse_opinion = { who = FROM value = 20 }
				}
			modifier = {
				factor = 0.25
				reverse_opinion = { who = FROM value = 40 }
				}
			modifier = {
				factor = 2
				NOT = { reverse_opinion = { who = FROM value = -75 } }
				}
			modifier = {
				factor = 0
				FROM = { war = yes }
			}
			modifier = {
				factor = 1.5
				FROM = { religion = tzeentch }
			}
			modifier = {
				factor = 0
				FROM = { any_courtier = { OR = {
					trait = tzeentch_demon
					trait = nurgle_demon
					trait = slaanesh_demon
					trait = khorne_demon
					trait = undivided_demon
					} } }
			}
			modifier = {
				factor = 0.75
				prestige = 200
			}
			modifier = {
				factor = 0.05
				prestige = 1000
			}
			modifier = {
				factor = 0
				FROM = { trait = kind }
			}
			modifier = {
				factor = 2
				ROOT = { trait = cruel }
			}
			modifier = {
				factor = 0
				FROM = { trait = creature_elf }
			}
			modifier = {
				factor = 2
				FROM = { OR = { trait = tzeentch_demon
						trait = nurgle_demon
						trait = slaanesh_demon } }
			}
		}
	}
	mage_ward_apprentice = {
		ai = no #magic teaching is handled with events
		filter = realm
		from_potential = {
			NOT = { trait = incapable }
			NOT = { trait = vampire_blood_visible }
			NOT = { trait = vampire_blood_hidden }
			NOT = { religion = asrai_cadai } #they have their own decision
			OR = {
				trait = creature_human
				trait = creature_amazon
				trait = creature_elf
			}
			OR = {
				#trait = lore_ice
				trait = lore_fire
				trait = lore_beasts
				trait = lore_metal
				trait = lore_light
				trait = lore_life
				trait = lore_heavens
				trait = lore_death
				trait = lore_shadows
				trait = lore_dark_magic		#elves can teach to humans, but they will not learn the elven lores
				trait = lore_high_magic
				trait = lore_tzeentch
				trait = lore_nurgle
				trait = lore_slaanesh
				trait = lore_chaos
			}
		}
		potential = {
			NOT = { has_character_flag = failed_mage }
			any_courtier = { FROM = { character = PREV } }
			prisoner = no
			age = 6
			OR = { 
				is_female = yes
				FROM = { 
					NOT = { religion = kislev_gods } 
						} 
					}
			OR = { 
				trait = creature_elf
				trait = creature_amazon
				trait = creature_human 
				}
			NOT = { trait = mage_apprentice }
			NOT = { trait = incapable }
			NOT = { trait = hedge_wizard }
			NOT = { trait = vampire_blood_visible }
			NOT = { trait = vampire_blood_hidden }
			NOT = { has_character_modifier = apprenticeship_refused }
			NOT = { is_trained_mage_trigger = yes }
			OR = {
				AND = {
					trait = creature_human
					OR = {
						independent = yes
						has_magic_law_2_trigger = yes
						NOT = { has_magic_law_any_trigger = yes }
						NOT = { age = 25 }
						AND = {
							#Ice Witches, Araby men etc
							has_magic_law_any_trigger = yes
							NOT = { check_if_mage_should_be_burned_trigger = yes }
						}
					}
				}
				trait = creature_amazon
				trait = creature_elf
			}
		}

		allow = {
			FROM = {
				learning = 14
				OR = {
					NOT = { has_magic_law_3_trigger = yes }
					AND = {
						college_mage_can_take_apprentice = yes
						has_magic_law_3_trigger = yes
					}
				}
			}
			NAND = {
				trait = creature_elf
				is_female = no
				is_vassal_or_below_of = 90000
			}
		}

		effect = {
			hidden_tooltip = {
				add_friend = FROM
				add_trait = mage_apprentice
				save_event_target_as=mage_ward
				set_character_flag = mage_master@FROM
				FROM = {
					save_event_target_as=mage_tutor
					character_event = { id = MageAp.6 days = 5 } #Start teaching
				}
				if = {
					limit = {
						FROM = { religion_group = cadai_group }
						e_ulthuan = { holder_scope  = { religion_group = cadai_group } }
					}
					e_ulthuan = { holder_scope  = { opinion = { modifier = opinion_unauthorized_tutoring who = FROM } } }
				}
				if = {
					limit = {
						FROM = {
							religion_group = cytharai_group
							is_female = yes
						}
						e_naggaroth = { holder_scope  = { trait = malekith } }
					}
					e_naggaroth = { holder_scope  = { opinion = { modifier = opinion_unauthorized_tutoring who = FROM } } }
				}
				if = {
					limit = {
						trait = creature_elf
						is_female = no
						e_naggaroth = { holder_scope  = { trait = malekith } }
					}
					e_naggaroth = { holder_scope  = { opinion = { modifier = opinion_sorcerous_rival who = ROOT } } }
				}
			}
		}

		revoke_allowed = { always = yes }
	}
	necromancer_ward_apprentice = {
		ai_check_interval = 48
		filter = realm
		ai_target_filter = realm
		from_potential = {
			NOT = { trait = incapable }
			OR = {		trait = vampire_lahmian_visible
					trait = vampire_carstein_visible
					# trait = vampire_blood_visible
					trait = vampire_strigoi_visible
					trait = vampire_necrarch_visible
					# trait = vampire_jade_visible
					trait = vampire_mahtmasi_visible
					trait = vampire_lahmian_hidden
					trait = vampire_carstein_hidden
					# trait = vampire_blood_hidden
					trait = vampire_strigoi_hidden
					trait = vampire_necrarch_hidden
					# trait = vampire_jade_hidden
					trait = vampire_mahtmasi_hidden
					trait = lore_necromancy }
			OR = { trait = khemri_tomb_king
				trait = creature_human }
		}
		potential = {
			NOT = { character = FROM }
			OR = {
				host = { character = FROM }
				guardian = { character = FROM }
				any_spouse = { character = FROM }
				any_lover = { character = FROM }
				any_friend = { character = FROM }
				mother = { character = FROM }
				father = { character = FROM } }
				age = 16
				OR = { trait = khemri_tomb_king
					trait = creature_human }
				NOR = {
					trait = mage_apprentice
					trait = vampire_blood_hidden
					trait = vampire_blood_visible
					trait = incapable
					trait = hedge_wizard
					trait = king_settra
				}
				NOT = { has_character_flag = taken_hedge_wizard_decision }
				NOT = { has_character_flag = taken_necromancer_decision }
				NOR = {
					has_character_modifier = apprenticeship_refused_necr
					has_character_modifier = magic_power_1
					has_character_modifier = magic_power_2
					has_character_modifier = magic_power_3
					has_character_modifier = magic_power_4
				}
		}

		allow = {
			FROM = { learning = 14 }
		}

		effect = { set_character_flag = taken_necromancer_decision
			character_event = { id = MageAp.17 }
		}

		revoke_allowed = { always = yes }

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.85
				NOT = { dynasty = FROM }
			}
			modifier = {
				factor = 0.85
				NOT = { culture = FROM }
			}
			modifier = {
				factor = 0.05
				NOT = { religion_group = FROM }
			}
			modifier = {
				factor = 0.1
				trait = khemri_tomb_king
			}
			modifier = {
				factor = 0.1
				NOT = { learning = 12 }
			}
			modifier = {
				factor = 0.75
				NOT = { father = { character = FROM } }
				NOT = { mother = { character = FROM } }
			}
			modifier = {
				factor = 50
				OR = { father = { character = FROM }
					mother = { character = FROM } }
			}
			modifier = {
				factor = 1.95
				OR = { FROM = { employer = { ROOT = { father = { character = PREVPREV } } } }
					FROM = { employer = { ROOT = { father = { character = PREVPREV } } } }
					 }
			}
			modifier = {
				factor = 1.35
				trait = quick
			}
			modifier = {
				factor = 1.25
				trait = bright
			}
			modifier = {
				factor = 1.5
				trait = smart
			}
			modifier = {
				factor = 1.75
				trait = quick
			}
			modifier = {
				factor = 1.95
				trait = brilliant
			}
			modifier = {
				factor = 2
				trait = genius
			}
			modifier = {
				factor = 0.85
				trait = dim
			}
			modifier = {
				factor = 0.75
				trait = dumb
			}
			modifier = {
				factor = 0.65
				trait = slow
			}
			modifier = {
				factor = 0.5
				trait = idiot
			}
			modifier = {
				factor = 0.45
				trait = imbecile
			}
			modifier = {
				factor = 1.5
				trait = gregarious
			}
			modifier = {
				factor = 1.5
				trait = ambitious
			}
			modifier = {
				factor = 1.75
				trait = diligent
			}
			modifier = {
				factor = 1.25
				trait = patient
			}
			modifier = {
				factor = 0.85
				trait = slothful
			}
			modifier = {
				factor = 0.5
				age = 14
			}
			modifier = {
				factor = 0.75
				FROM = { NOT = { religion = ROOT } }
			}
			modifier = {
				factor = 0.25
				FROM = { NOT = { opinion = { who = ROOT
						 value = -100 } } }
				}
			modifier = {
				factor = 0.75
				FROM = { NOT = { opinion = { who = ROOT
						 value = -80 } } }
				}
			modifier = {
				factor = 0.75
				FROM = { NOT = { opinion = { who = ROOT
						 value = -60 } } }
				}
			modifier = {
				factor = 0.75
				FROM = { NOT = { opinion = { who = ROOT
						 value = -40 } } }
				}
			modifier = {
				factor = 0.75
				FROM = { NOT = { opinion = { who = ROOT
						 value = -20 } } }
				}
			modifier = {
				factor = 0.75
				FROM = { NOT = { opinion = { who = ROOT
						 value = 0 } } }
			}
			modifier = {
				factor = 1.5
				FROM = { opinion = { who = ROOT
						 value = 20 }
				}
			}
			modifier = {
				factor = 1.65
				FROM = { opinion = { who = ROOT
						value = 40 }
				}
			}
			modifier = {
				factor = 1.75
				FROM = { opinion = { who = ROOT
						value = 60 }
				}
			}
			modifier = {
				factor = 1.85
				FROM = { opinion = { who = ROOT
						value = 80 }
				}
			}
			modifier = {
				factor = 1.5
				FROM = { opinion = { who = ROOT
						value = 100 }
				}
			}

		}
	}
	# This system allows a non-wizard character to commission magical items from a wizard at their court.
	commission_crafting = {
		ai_check_interval = 60
		filter = sub_realm
        ai_target_filter = home_court
		only_playable = yes

        potential = {
            NOT = { trait = vampire_necrarch_visible }
            NOT = { character = FROM }
            is_liege_or_above = FROM
            OR = {
                has_character_modifier = magic_power_1
                has_character_modifier = magic_power_2
                has_character_modifier = magic_power_3
                has_character_modifier = magic_power_4
            }
        }

        allow = {
            FROM = { wealth = 375 }
            FROM = { is_incapacitated_trigger = no }
            ROOT = {
				NOT = { has_character_flag = enchanting_item }
				custom_tooltip = {
					text = IS_NOT_INCAPACITATED
					is_incapacitated_trigger = no
				}
			}
        }

        effect = {
			FROM = {
				character_event = { id = commissioned_crafting.0 }
			}
		}

        ai_will_do = {
                factor = 0.01 # 10% chance per year of commissioning per year
        }
	}
}

###SPELL INTERACTION###

#Add the decisions in a nice order which will make sense in the menu! For example, ranked by cost/reward.

#CHANNELING (GAIN MANA)
offmap_decisions = {
	# Necromancy sacrifices prisoners for mana
	# Ogres use targetted decision to eat prisoners
	# Greenskins trade fightiness for mana
	# Ice Magic
	magic_channeling = {
		only_playable = yes
		button_name = offmap_gifts
		ai_check_interval = 24

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			is_ruler = yes
			higher_tier_than = BARON
			NOT = { trait = incapable }
			magic_offmap_enabled_trigger = yes
			NOR = {
				trait = lore_necromancy
				trait = lore_maw
				trait = lore_waaagh
				trait = greenskin_shaman
				trait = lore_ice
				trait = lore_hag
			}
		}

		allow = {
			FROM = {
				show_scope_change = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				custom_tooltip = {
					text = channeling_cooldown_tt
					NOT = { has_character_modifier = channeling_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				sound_effect = china_grace_gain
				hidden_tooltip = {
					add_character_modifier = {
						name = channeling_cooldown
						months = 5
					}
					channeling_effect = yes
					random_list = {
						15 = {
							custom_tooltip = {
								text = mutations_test_tt
								mutation_toughness_test_effect = yes
							}
						}
						85 = {}
					}
				}
			}
		}

		revoke_allowed = {
			always = no
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05 # slow way down
			}
		}
	}
	necro_execute_prisoner = {
		only_playable = yes
		button_name = offmap_gifts

		third_party_filter = home_court
		ai_third_party_filter = home_court
		third_party = FROM
		ai_check_interval = 6
		show_third_party_potential = yes

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			is_ruler = yes
			higher_tier_than = BARON
			NOT = { trait = incapable }
			trait = lore_necromancy
			magic_offmap_enabled_trigger = yes
		}

		allow = {
			FROM = {
				show_scope_change = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
		}

		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				host = { character = ROOT_FROM }
				show_scope_change = no
				prisoner = yes
				is_invincible_trigger = no
				is_heir = no
			}
		}

		third_party_allow = {
			FROM = {
				any_courtier = {
					character = FROMFROM
				}
			}
		}

		effect = {
			save_event_target_as = target_governor
			FROM = {
				sound_effect = china_grace_gain
				save_event_target_as = target_tribute_sender
				show_scope_change = no
				hidden_tooltip = {
					channeling_effect = yes
					add_necro_power_effect = yes
				}
			}
			if = {
	 			limit = {
	 				dynasty = FROM
					FROM = {
	 					OR = {
	 						trait = creature_human
							trait = creature_amazon
							trait = creature_elf
							trait = creature_dwarf
							trait = creature_chaos_dwarf
						}
	 				}
	 			}
				FROM = { add_trait = kinslayer }
			}
			if = {
	 			limit = {
	 				liege = {
	 					character = FROM
	 				}
					FROM = {
						NOR = {
							has_opinion_modifier = { who = ROOT modifier = opinion_traitor }
							has_opinion_modifier = { who = ROOT modifier = opinion_rebel_traitor }
							has_opinion_modifier = { who = ROOT modifier = opinion_dishonorable }
							has_opinion_modifier = { who = ROOT modifier = opinion_confirmed_heretic }
							has_opinion_modifier = { who = ROOT modifier = opinion_burned_by_asuryan }
						}
						religion = ROOT
					}
				}
				FROM = {
					any_vassal = {
						limit = { religion = FROM }
						opinion = { modifier = opinion_tyrant who = FROM }
					}
				}
				FROM = {
					any_courtier = {
						limit = { religion = FROM is_landed = no }
						opinion = { modifier = opinion_tyrant who = FROM }
					}
				}
			}
			hidden_tooltip = {
				mother = {
					opinion = {
						who = FROM
						modifier = evil_murderer
					}
				}
				father = {
					opinion = {
						who = FROM
						modifier = evil_murderer
					}
				}
				any_child = {
					limit = {
						NOT = { character = FROM }
						NOT = { has_character_flag = evil_murderer }
					}
					opinion = {
						who = FROM
						modifier = evil_murderer
					}
				}
				any_spouse = {
					limit = {
						NOT = { character = FROM }
						opinion = { who = ROOT value = -25 }
					}
					set_character_flag = murder_opinion_set
					opinion = {
						who = FROM
						modifier = evil_murderer
					}
				}
				any_lover = {
					limit = {
						NOT = { character = FROM }
					}
					opinion = {
						who = FROM
						modifier = evil_murderer
					}
				}
				any_friend = {
					limit = {
						NOT = { character = FROM }
					}
					opinion = {
						who = FROM
						modifier = evil_murderer
					}
				}
				any_dynasty_member = {
					limit = {
						is_close_relative = ROOT
						NOT = { character = FROM }
					}
					opinion = {
						who = FROM
						modifier = evil_murderer
					}
				}
			}
			offmap_magic = {
				offmap_ruler = {
					FROMFROM = {
						save_event_target_as = person_sent_as_tribute
						if = {
							limit = { is_invincible_trigger = yes }
							antideath_effect = yes
							break = yes
						}
						if = {
				 			limit = {
				 				OR = {
									trait = undivided_demon
				 					trait = khorne_demon
									trait = nurgle_demon
									trait = slaanesh_demon
									trait = tzeentch_demon
				 				}
				 			}
							character_event = { id = sdemons.1 }
							break = yes
						}
						death = { death_reason = death_sacrificed killer = PREV }
					}
				}
			}
		}

		revoke_allowed = {
			always = no
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.2 # Less likely to do it
				war = no #Ai will do it in war, could probably adjust desperation meter if losing war
			}
			modifier = {
				factor = 1.2
				war = yes
			}
			modifier = {
				factor = 0.01
				reverse_opinion = { who = FROM value > 50 }
			}
			modifier = {
				factor = 0.01
				FROM = {
					location = {
						NOT = { owner = { character = FROM } }
						NOT = { owner = { top_liege = { character = FROM } } }
					}
				}
			}
			modifier = {
				factor = 0.5 #Enemy has your relative
				FROM = {
					any_current_enemy = {
						dynasty = ROOT
						is_close_relative = ROOT
						any_courtier = {
							is_close_relative = FROM
							dynasty = FROM
						}
					}
				}
			}
			modifier = {
				factor = 0.01
				FROM = {
					OR = {
						trait = kind
						trait = just
					}
				}
			}
			modifier = {
				factor = 1.2
				FROM = {
					OR = {
						trait = cruel
						trait = zealous
					}
				}
			}
			modifier = {
				factor = 1.5
				FROM = { trait = lunatic_3 }
			}
			modifier = {
				factor = 0.5
				FROM = { trait = patient }
			}
		}
	}
	greenskin_channeling = {
		only_playable = yes
		button_name = offmap_gifts
		ai_check_interval = 6

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			is_ruler = yes
			higher_tier_than = BARON
			NOT = { trait = incapable }
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = lore_waaagh
				trait = greenskin_shaman
			}
		}

		allow = {
			FROM = {
				show_scope_change = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				custom_tooltip = {
					text = channeling_cooldown_tt
					NOT = { has_character_modifier = channeling_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				sound_effect = china_grace_gain
				hidden_tooltip = {
					add_character_modifier = {
						name = channeling_cooldown
						months = 1
					}
					greenskin_channeling_effect = yes
				}
			}
		}

		revoke_allowed = {
			always = no
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05 # slow way down
			}
		}
	}
	ice_magic_channeling = {
		only_playable = yes
		button_name = offmap_gifts
		ai_check_interval = 24

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			is_ruler = yes
			higher_tier_than = BARON
			NOT = { trait = incapable }
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = lore_ice
				trait = lore_hag
			}
		}

		allow = {
			FROM = {
				show_scope_change = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				custom_tooltip = {
					text = channeling_cooldown_tt
					NOT = { has_character_modifier = channeling_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				sound_effect = china_grace_gain
				hidden_tooltip = {
					add_character_modifier = {
						name = channeling_cooldown
						months = 12
					}
					#Ice magic is more effective depending on climate
					if = {
						limit = {
							OR = {
								trait = lore_ice
								trait = lore_hag
							}
							location = {
								region = world_old_world_kislev
							}
						}
						if = {
							limit = {
								location = {
									is_winter = yes
								 }
							}
							random_list = {
								20 = {
									add_offmap_currency = {
										offmap = offmap_magic
										value = 2
									}
								}
								20 = {
									add_offmap_currency = {
										offmap = offmap_magic
										value = 3
									}
								}
								20 = {
									add_offmap_currency = {
										offmap = offmap_magic
										value = 4
									}
								}
								20 = {
									add_offmap_currency = {
										offmap = offmap_magic
										value = 5
									}
								}
								20 = {
									add_offmap_currency = {
										offmap = offmap_magic
										value = 6
									}
								}
							}
						}
						if = {
							limit = {
								location = { climate = severe_winter }
							}
							random_list = {
								20 = {
									add_offmap_currency = {
										offmap = offmap_magic
										value = 3
									}
								}
								20 = {
									add_offmap_currency = {
										offmap = offmap_magic
										value = 4
									}
								}
								20 = {
									add_offmap_currency = {
										offmap = offmap_magic
										value = 5
									}
								}
								20 = {
									add_offmap_currency = {
										offmap = offmap_magic
										value = 6
									}
								}
								20 = {
									add_offmap_currency = {
										offmap = offmap_magic
										value = 7
									}
								}
							}
						}
						else_if	= {
							limit = {
								location = { climate = mild_winter }
							}
							random_list = {
								20 = {
									add_offmap_currency = {
										offmap = offmap_magic
										value = 1
									}
								}
								20 = {
									add_offmap_currency = {
										offmap = offmap_magic
										value = 2
									}
								}
								20 = {
									add_offmap_currency = {
										offmap = offmap_magic
										value = 3
									}
								}
								20 = {
									add_offmap_currency = {
										offmap = offmap_magic
										value = 4
									}
								}
								20 = {
									add_offmap_currency = {
										offmap = offmap_magic
										value = 5
									}
								}
							}
						}
						else_if	= {
							limit = {
								location = {
									NOR = {
										climate = severe_winter
										climate = normal_winter
										climate = mild_winter
									}
								}
							}
							random_list = {
								2 = {
									death = { death_reason = death_sacrificed }
								}
								3 = {
									health = -3.0
								}
								15 = {
								}
								20 = {
									add_offmap_currency = {
										offmap = offmap_magic
										value = 1
									}
								}
								20 = {
									add_offmap_currency = {
										offmap = offmap_magic
										value = 2
									}
								}
								20 = {
									add_offmap_currency = {
										offmap = offmap_magic
										value = 3
									}
								}
								20 = {
									add_offmap_currency = {
										offmap = offmap_magic
										value = 4
									}
								}
							}
						}
					}
				}
			}
		}

		revoke_allowed = {
			always = no
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05 # slow way down
			}
		}
	}
}

#SPELL DECISIONS (PENDING MANA)
offmap_decisions = {
	#NECROMANCY
	invocation_of_nehek = { # Unnatural Aura, Combat rating, Martial and 20% undead horde defense/offense boost
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_necromancy
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 8 }
				OR = {
					has_character_modifier = necromantic_power_1
					has_character_modifier = necromantic_power_2
					has_character_modifier = necromantic_power_3
					has_character_modifier = necromantic_power_4
					has_character_modifier = necromantic_power_5
				}
				NOT = { trait = incapable }
				NOT = { has_character_modifier = unnatural_aura }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_necro_effect = yes
				add_offmap_currency = {
					offmap = offmap_magic
					value = -8
				}
				hidden_tooltip = {
					remove_necro_power_effect = yes
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	gaze_of_nagash = { # Plot Protection, Reveals Plots
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 24

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_necromancy
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 10 }
				OR = {
					has_character_modifier = necromantic_power_2
					has_character_modifier = necromantic_power_3
					has_character_modifier = necromantic_power_4
					has_character_modifier = necromantic_power_5
				}
				NOT = { trait = incapable }
				NOT = { has_character_flag = plots_and_dreams }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				add_offmap_currency = {
					offmap = offmap_magic
					value = -10
				}
				hidden_tooltip = {
					foresight_plot_protection_effect = yes
					remove_necro_power_effect = yes
					set_character_flag = plots_and_dreams
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.0 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.75
				FROM = {
					location = {
						NOT = { owner = { character = FROM } }
						NOT = { owner = { top_liege = { character = FROM } } }
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					OR = {
						trait = brave
						trait = zealous
					}
				}
			}
			modifier = {
				factor = 1.2
				FROM = {
					OR = {
						trait = paranoid
						trait = craven
					}
				}
			}
			modifier = {
				factor = 0.1
				war = yes
			}
			modifier = {
				factor = 2
				war = no
			}
		}
	}
	curse_of_years = { # Ages and harms target, Heals caster
		only_playable = yes
		button_name = offmap_boons

		third_party_filter = sub_realm
		ai_third_party_filter = sub_realm
		third_party = FROM
		ai_check_interval = 24
		show_third_party_potential = yes

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_necromancy
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
		}

		allow = {
			FROM = {
				show_scope_change = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				has_offmap_currency = { offmap = offmap_magic value = 12 }
				OR = {
					has_character_modifier = necromantic_power_3
					has_character_modifier = necromantic_power_4
					has_character_modifier = necromantic_power_5
				}
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		third_party_potential = {
			#show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				hidden_tooltip = {
					is_invincible_trigger = no
					is_vampire_trigger = no
					is_heir = no
					is_adult = yes
				}
			}
		}

		third_party_allow = {
			#show_only_failed_conditions = yes
			FROMFROM = {

			}
		}

		effect = {
			save_event_target_as = target_governor
			FROM = {
				sound_effect = china_grace_gain
				save_event_target_as = target_tribute_sender
				show_scope_change = no
				add_offmap_currency = {
					offmap = offmap_magic
					value = -12
				}
				hidden_tooltip = {
					healing_effect = yes
					remove_necro_power_effect = yes
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
			}
			offmap_magic = {
				offmap_ruler = {
					FROMFROM = {
						save_event_target_as = person_sent_as_tribute
						if = {
							limit = { is_invincible_trigger = yes }
							antideath_effect = yes
							break = yes
						}
						if = {
				 			limit = {
				 				OR = {
									trait = undivided_demon
				 					trait = khorne_demon
									trait = nurgle_demon
									trait = slaanesh_demon
									trait = tzeentch_demon
				 				}
				 			}
							character_event = { id = sdemons.1 }
							break = yes
						}
						life_leach_effect = yes
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2.0
				is_rival = FROMFROM
			}
			modifier = {
				factor = 2
				health < 5
			}
			modifier = {
				factor = 0.5
				health > 10
			}
			modifier = {
				factor = 0.1
				health > 15
			}
		}
	}
	undead_summoning = { # Summons undead horde
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_necromancy
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 15 }
				location = {
					#Disabled Limitation for now
					#OR = {
					#	owner = { character = ROOT }
					#	owner = { top_liege = { character = ROOT } }
					#}
					NOR = {
						has_province_modifier = province_tainted_1
						has_province_modifier = province_tainted_2
						has_province_modifier = province_tainted_3
						has_province_modifier = province_tainted_4
						has_province_modifier = province_tainted_5
						culture = nehekharan
					}
				}
				OR = {
					has_character_modifier = necromantic_power_1
					has_character_modifier = necromantic_power_2
					has_character_modifier = necromantic_power_3
					has_character_modifier = necromantic_power_4
					has_character_modifier = necromantic_power_5
				}
				NOT = { trait = incapable }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				add_offmap_currency = {
					offmap = offmap_magic
					value = -15
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = svampires.11 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.5
				FROM = {
					location = {
						NOT = { owner = { character = FROM } }
						NOT = { owner = { top_liege = { character = FROM } } }
					}
				}
			}
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	#LORE OF DEATH
	aspect_of_the_dreadknight = { # Aura, Combat rating, Morale and 25% global revolt risk reduction
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_death
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 7 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = dreadknight_aspect }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_dreadknight_effect = yes
				add_offmap_currency = {
					offmap = offmap_magic
					value = -7
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.5
				FROM = {
					location = {
						NOT = { owner = { character = FROM } }
						NOT = { owner = { top_liege = { character = FROM } } }
					}
				}
			}
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	soulblight_spell = { # Applies Province Tainted modifier and lowers prosperity
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_death
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 9 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = tainted_province_location }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = tainted_province_location
				add_offmap_currency = {
					offmap = offmap_magic
					value = -9
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.33 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				FROM = {
					location = {
						owner = { character = FROM }
						owner = { top_liege = { character = FROM } }
					}
				}
			}
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	purple_sun_of_xereus = { # Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_death
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 11 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -11
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	spirit_leech = { # Ages and harms target, Heals caster and friendly units at location
		only_playable = yes
		button_name = offmap_boons

		third_party_filter = sub_realm
		ai_third_party_filter = sub_realm
		third_party = FROM
		ai_check_interval = 24
		show_third_party_potential = yes

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_death
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
		}

		allow = {
			FROM = {
				show_scope_change = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				has_offmap_currency = { offmap = offmap_magic value = 13 }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		third_party_potential = {
			#show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				hidden_tooltip = {
					is_invincible_trigger = no
					is_vampire_trigger = no
					is_heir = no
					is_adult = yes
				}
			}
		}

		third_party_allow = {
			#show_only_failed_conditions = yes
			FROMFROM = {

			}
		}

		effect = {
			offmap_magic = {
				offmap_ruler = {
					FROMFROM = {
						save_event_target_as = magic_target
						if = {
							limit = { is_invincible_trigger = yes }
							antideath_effect = yes
							break = yes
						}
						if = {
				 			limit = {
				 				OR = {
									trait = undivided_demon
				 					trait = khorne_demon
									trait = nurgle_demon
									trait = slaanesh_demon
									trait = tzeentch_demon
				 				}
				 			}
							character_event = { id = sdemons.1 }
							break = yes
						}
						life_leach_effect = yes
					}
				}
			}
			FROM = {
				sound_effect = china_grace_gain
				show_scope_change = no
				add_offmap_currency = {
					offmap = offmap_magic
					value = -13
				}
				hidden_tooltip = {
					healing_effect = yes
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.5 }
			}
		}

		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2.0
				is_rival = FROMFROM
			}
			modifier = {
				factor = 2
				health < 5
			}
			modifier = {
				factor = 0.5
				health > 10
			}
			modifier = {
				factor = 0.1
				health > 15
			}
		}
	}
	#LORE OF LIFE
	shield_of_thorns = { # Aura, Defense Modifier and personal combat skill
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = lore_life
				trait = asrai_spellsinger
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 7 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = enhanced_defensive }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_defensive_effect = yes
				add_offmap_currency = {
					offmap = offmap_magic
					value = -7
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	regrowth_spell = { # Heal units at current location removes tainted province modifier and reduces disease
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = lore_life
				trait = asrai_spellsinger
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 9 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = heal_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = heal_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -9
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.5 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	the_dwellers_below = { # Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = lore_life
				trait = asrai_spellsinger
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 11 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -11
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	awakening_of_the_wood = { # Summon Treekin event troops
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = lore_life
				trait = asrai_spellsinger
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 15 }
				location = {
					#Disabled Limitation for now
					#OR = {
					#	owner = { character = ROOT }
					#	owner = { top_liege = { character = ROOT } }
					#}
					NOR = {
						has_province_modifier = province_tainted_1
						has_province_modifier = province_tainted_2
						has_province_modifier = province_tainted_3
						has_province_modifier = province_tainted_4
						has_province_modifier = province_tainted_5
						culture = nehekharan
					}
				}
				NOT = { trait = incapable }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				add_offmap_currency = {
					offmap = offmap_magic
					value = -15
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.28 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	#LORE OF LIGHT
	bironas_timewarp = { # Aura, Movement Speed bonus, Land Organisation
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_light
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 8 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = enhanced_speed }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_speed_effect = yes
				add_offmap_currency = {
					offmap = offmap_magic
					value = -8
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	light_of_battle = {  # Aura, Defense Modifier and personal combat skill
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_light
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 8 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = enhanced_speed }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_defensive_effect = yes
				add_offmap_currency = {
					offmap = offmap_magic
					value = -8
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	shems_burning_gaze = { # Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_light
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 10 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -10
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	banishment = { # dispels undead horde and demons
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_light
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 15 }
				NOT = { trait = incapable }
				NOT = { has_character_flag = banishment_location }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				add_offmap_currency = {
					offmap = offmap_magic
					value = -15
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 6
					hidden = yes
				}
				character_event = { id = mageproc.7 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	#LORE OF FIRE
	cascading_fire_cloak = { # Aura, Defense Modifier and personal combat skill
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_fire
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 6 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = enhanced_defensive }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_defensive_effect = yes
				add_offmap_currency = {
					offmap = offmap_magic
					value = -6
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	flame_storm = { # Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_fire
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 8 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -8
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	flaming_sword_of_ruin = { # Aura, Strength bonus, Land Organisation
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_fire
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 10 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = enhanced_strength }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_strength_effect = yes
				add_offmap_currency = {
					offmap = offmap_magic
					value = -10
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	the_burning_head = { # Extreme Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_fire
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 12 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_special_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_special_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -12
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	#LORE OF METAL
	glittering_robe = { # Aura, Defense Modifier and personal combat skill
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_metal
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 6 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = enhanced_defensive }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_defensive_effect = yes
				add_offmap_currency = {
					offmap = offmap_magic
					value = -6
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	gehennas_golden_hounds = { # Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_metal
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 8 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -8
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	transmutation_of_lead = { # Grants scaled wealth, half your yearly income, min 100 max 500, removed later
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_metal
			is_ruler = yes
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 10 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = enhanced_defensive }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				scaled_wealth = {
    				value = 0.5
    				min = 100
    				max = 500
				}
				hidden_tooltip = {
					character_event = { id = mageproc.34 days = 365 random = 690 }
				}
				add_offmap_currency = {
					offmap = offmap_magic
					value = -10
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = yes
			}
			modifier = {
				factor = 2
				war = no
			}
		}
	}
	searing_doom = { # Extreme Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_metal
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 12 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_special_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_special_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -12
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	#LORE OF HEAVENS
	fantastic_foresight = { # Plot Protection, Reveals Plots
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 24

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_heavens
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 7 }
				NOT = { trait = incapable }
				NOT = { has_character_flag = plots_and_dreams }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				add_offmap_currency = {
					offmap = offmap_magic
					value = -7
				}
				hidden_tooltip = {
					foresight_plot_protection_effect = yes
					set_character_flag = plots_and_dreams
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
				character_event = { id = mageproc.0 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.75
				FROM = {
					location = {
						NOT = { owner = { character = FROM } }
						NOT = { owner = { top_liege = { character = FROM } } }
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					OR = {
						trait = brave
						trait = zealous
					}
				}
			}
			modifier = {
				factor = 1.2
				FROM = {
					OR = {
						trait = paranoid
						trait = craven
					}
				}
			}
			modifier = {
				factor = 0.1
				war = yes
			}
			modifier = {
				factor = 2
				war = no
			}
		}
	}
	chain_lightning = { # Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_heavens
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 9 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -9
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	harmonic_convergence = { # Enhances Province Prosperity
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_heavens
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 11 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = prosperity_location_increase }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = prosperity_location_increase
				add_offmap_currency = {
					offmap = offmap_magic
					value = -11
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.35 }
			}
		}

		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 4
				FROM = {
					location = {
						owner = { character = FROM }
						owner = { top_liege = { character = FROM } }
					}
				}
			}
			modifier = {
				factor = 0.1
				war = yes
			}
			modifier = {
				factor = 2
				war = no
			}
		}
	}
	comet_of_casandora = { # Extreme Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_heavens
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 12 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_special_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_special_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -12
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	#LORE OF BEASTS
	panns_impenetrable_pelt = { # Aura, Defense Modifier and personal combat skill
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_beasts
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 6 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = enhanced_defensive }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_defensive_effect = yes
				add_offmap_currency = {
					offmap = offmap_magic
					value = -6
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	flock_of_doom = { # Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_beasts
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 8 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -8
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	beast_master = { # Summons, random animal commander for a limited amount of time
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 24

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_beasts
			is_ruler = yes
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 10 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = enhanced_defensive }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = summon_magic_creature
				add_offmap_currency = {
					offmap = offmap_magic
					value = -10
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.36 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = n0
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	wyssans_wildform = { # Transforms Target Prisoner into a pig toad or other beast
		only_playable = yes
		button_name = offmap_boons

		third_party_filter = home_court
		ai_third_party_filter = home_court
		third_party = FROM
		ai_check_interval = 24
		show_third_party_potential = yes

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			is_ruler = yes
			higher_tier_than = BARON
			NOT = { trait = incapable }
			trait = lore_beasts
			magic_offmap_enabled_trigger = yes
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 12 }
				show_scope_change = no
				prisoner = no
				NOT = { trait = incapable }
				NOT = { has_character_flag = magic_transform_prisoner }
				is_inaccessible_trigger = no
			}
		}

		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				host = { character = ROOT_FROM }
				show_scope_change = no
				prisoner = yes
				is_invincible_trigger = no
				is_heir = no
			}
		}

		third_party_allow = {
			FROM = {
				any_courtier = {
					character = FROMFROM
				}
			}
		}

		effect = {
			offmap_magic = {
				offmap_ruler = {
					FROMFROM = {
						save_event_target_as = magic_target
						if = {
							limit = { is_invincible_trigger = yes }
							antideath_effect = yes
							break = yes
						}
						if = {
				 			limit = {
				 				OR = {
									trait = undivided_demon
				 					trait = khorne_demon
									trait = nurgle_demon
									trait = slaanesh_demon
									trait = tzeentch_demon
				 				}
				 			}
							character_event = { id = sdemons.1 }
							break = yes
						}
					}
				}
			}
			FROM = {
				add_offmap_currency = {
					offmap = offmap_magic
					value = -12
				}
				sound_effect = china_grace_gain
				show_scope_change = no
				set_character_flag = magic_transform_prisoner
				character_event = { id = mageproc.13 }
			}
		}

		revoke_allowed = {
			always = no
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.2 # Less likely to do it
				war = yes #Ai will do it in war, could probably adjust desperation meter if losing war
			}
			modifier = {
				factor = 1.1
				war = no
			}
			modifier = {
				factor = 0.01
				reverse_opinion = { who = FROM value > 50 }
			}
			modifier = {
				factor = 0.01
				FROM = {
					location = {
						NOT = { owner = { character = FROM } }
						NOT = { owner = { top_liege = { character = FROM } } }
					}
				}
			}
			modifier = {
				factor = 0.5 #Enemy has your relative
				FROM = {
					any_current_enemy = {
						dynasty = ROOT
						is_close_relative = ROOT
						any_courtier = {
							is_close_relative = FROM
							dynasty = FROM
						}
					}
				}
			}
			modifier = {
				factor = 0.01
				FROM = {
					OR = {
						trait = kind
						trait = just
					}
				}
			}
			modifier = {
				factor = 1.2
				FROM = {
					OR = {
						trait = cruel
						trait = zealous
					}
				}
			}
			modifier = {
				factor = 1.5
				FROM = { trait = lunatic_3 }
			}
			modifier = {
				factor = 0.5
				FROM = { trait = patient }
			}
		}
	}
	#LORE OF THE WILD
	devolve = { # Lowers Prosperity of current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = bray_shaman
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 7 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = prosperity_location_decrease }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = prosperity_location_decrease
				add_offmap_currency = {
					offmap = offmap_magic
					value = -7
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
				character_event = { id = mageproc.9 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				FROM = {
					location = {
						owner = { character = FROM }
						owner = { top_liege = { character = FROM } }
					}
				}
			}
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	bray_scream = { # Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = bray_shaman
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 9 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -9
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	beast_made_well = { # Heal units at current location and applies a strength aura and reduces disease
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = bray_shaman
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 11 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = heal_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_strength_effect = yes
				set_character_flag = heal_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -11
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.5 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	viletide = { # Extreme Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = bray_shaman
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 13 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_special_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_special_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -13
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	#LORE OF SHADOWS
	enfeebling_foe = { # Influences target opinion of caster
		only_playable = yes
		button_name = offmap_boons

		third_party_filter = sub_realm
		ai_third_party_filter = sub_realm
		third_party = FROM
		ai_check_interval = 12
		show_third_party_potential = yes

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_shadows
			is_ruler = yes
			NOT = { trait = incapable }
		}

		allow = {
			FROM = {
				show_scope_change = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				has_offmap_currency = { offmap = offmap_magic value = 7 }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		third_party_potential = {
			#show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				hidden_tooltip = {
					is_invincible_trigger = no
					is_vampire_trigger = no
					is_heir = no
					is_adult = yes
				}
			}
		}

		third_party_allow = {
			#show_only_failed_conditions = yes
			FROMFROM = {
				hidden_tooltip = {
					is_invincible_trigger = no
					is_vampire_trigger = no
					is_heir = no
					is_adult = yes
				}
			}
		}

		effect = {
			FROMFROM = {
				save_event_target_as = magic_target
			}
			FROM = {
				sound_effect = china_grace_gain
				show_scope_change = no
				add_offmap_currency = {
					offmap = offmap_magic
					value = -7
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
				character_event = { id = mageproc.26 }
			}
			offmap_magic = {
				offmap_ruler = {
					FROMFROM = {
						if = {
							limit = { is_invincible_trigger = yes }
							antideath_effect = yes
							break = yes
						}
						if = {
				 			limit = {
				 				OR = {
									trait = undivided_demon
				 					trait = khorne_demon
									trait = nurgle_demon
									trait = slaanesh_demon
									trait = tzeentch_demon
				 				}
				 			}
							character_event = { id = sdemons.1 }
							break = yes
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2.0
				is_rival = FROMFROM
			}
		}
	}
	the_withering = { # Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_shadows
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 9 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -9
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	okkams_mindrazor = { # Aura, Strength bonus, Land Organisation
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_shadows
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 11 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = enhanced_strength }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_strength_effect = yes
				add_offmap_currency = {
					offmap = offmap_magic
					value = -11
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	pit_of_shades = { # Extreme Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_shadows
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 13 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_special_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_special_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -13
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	#LORE OF HIGH MAGIC
	soul_quench = { # Morale Damage units at the current location and drains commanders of magic and spellpower
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = lore_high_magic
				trait = asur_mage
				trait = creature_slann
				trait = skink_priest
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 5 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = drain_magic_location }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = drain_magic_location
				add_offmap_currency = {
					offmap = offmap_magic
					value = -5
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
				character_event = { id = mageproc.38 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	apotheosis_spell = { # Heal units at current location removes tainted province modifier and reduces disease
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = lore_high_magic
				trait = asur_mage
				trait = creature_slann
				trait = skink_priest
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 7 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = heal_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = heal_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -7
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.5 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	fiery_convocation = { # Extreme Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = lore_high_magic
				trait = asur_mage
				trait = creature_slann
				trait = skink_priest
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 9 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_special_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_special_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -9
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	hand_of_glory = { # Enhances Province Prosperity and adds strength and speed auras
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = lore_high_magic
				trait = asur_mage
				trait = creature_slann
				trait = skink_priest
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 11 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = prosperity_location_increase }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_strength_effect = yes
				enhanced_ability_speed_effect = yes
				set_character_flag = prosperity_location_increase
				add_offmap_currency = {
					offmap = offmap_magic
					value = -11
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.35 }
			}
		}

		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 4
				FROM = {
					location = {
						owner = { character = FROM }
						owner = { top_liege = { character = FROM } }
					}
				}
			}
			modifier = {
				factor = 0.1
				war = yes
			}
			modifier = {
				factor = 2
				war = no
			}
		}
	}
	#LORE OF DARK MAGIC
	doombolt = { # Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = lore_dark_magic
				trait = druchii_mage
				trait = druchii_sorceress
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 6 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -6
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	word_of_pain = { # Morale Damage units at the current location and drains commanders of magic and spellpower
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = lore_dark_magic
				trait = druchii_mage
				trait = druchii_sorceress
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 8 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = drain_magic_location }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = drain_magic_location
				add_offmap_currency = {
					offmap = offmap_magic
					value = -8
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.38 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	blade_wind = { # Extreme Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = lore_dark_magic
				trait = druchii_mage
				trait = druchii_sorceress
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 10 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_special_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_special_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -10
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	soul_stealer = { # Ages and harms target, Heals caster and friendly units at location
		only_playable = yes
		button_name = offmap_boons

		third_party_filter = sub_realm
		ai_third_party_filter = sub_realm
		third_party = FROM
		ai_check_interval = 24
		show_third_party_potential = yes

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = lore_dark_magic
				trait = druchii_mage
				trait = druchii_sorceress
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
		}

		allow = {
			FROM = {
				show_scope_change = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				has_offmap_currency = { offmap = offmap_magic value = 12 }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		third_party_potential = {
			#show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				hidden_tooltip = {
					is_invincible_trigger = no
					is_vampire_trigger = no
					is_heir = no
					is_adult = yes
				}
			}
		}

		third_party_allow = {
			#show_only_failed_conditions = yes
			FROMFROM = {
				hidden_tooltip = {
					is_invincible_trigger = no
					is_vampire_trigger = no
					is_heir = no
					is_adult = yes
				}
			}
		}

		effect = {
			offmap_magic = {
				offmap_ruler = {
					FROMFROM = {
						save_event_target_as = magic_target
						if = {
							limit = { is_invincible_trigger = yes }
							antideath_effect = yes
							break = yes
						}
						if = {
				 			limit = {
				 				OR = {
									trait = undivided_demon
				 					trait = khorne_demon
									trait = nurgle_demon
									trait = slaanesh_demon
									trait = tzeentch_demon
				 				}
				 			}
							character_event = { id = sdemons.1 }
							break = yes
						}
						life_leach_effect = yes
					}
				}
			}
			FROM = {
				sound_effect = china_grace_gain
				show_scope_change = no
				add_offmap_currency = {
					offmap = offmap_magic
					value = -12
				}
				hidden_tooltip = {
					healing_effect = yes
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.5 }
			}
		}

		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2.0
				is_rival = FROMFROM
			}
			modifier = {
				factor = 2
				health < 5
			}
			modifier = {
				factor = 0.5
				health > 10
			}
			modifier = {
				factor = 0.1
				health > 15
			}
		}
	}
	#LORE OF CHAOS
	boon_of_chaos = { # Aura, Strength bonus, Land Organisation
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_chaos
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 6 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = enhanced_strength }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_strength_effect = yes
				add_offmap_currency = {
					offmap = offmap_magic
					value = -6
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	burning_blood = { # Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_chaos
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 8 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -8
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	lure_of_Chaos = { # Influences target opinion of caster
		only_playable = yes
		button_name = offmap_boons

		third_party_filter = sub_realm
		ai_third_party_filter = sub_realm
		third_party = FROM
		ai_check_interval = 12
		show_third_party_potential = yes

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_chaos
			is_ruler = yes
			NOT = { trait = incapable }
		}

		allow = {
			FROM = {
				show_scope_change = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				has_offmap_currency = { offmap = offmap_magic value = 10 }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		third_party_potential = {
			#show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				hidden_tooltip = {
					is_invincible_trigger = no
					is_vampire_trigger = no
					is_heir = no
					is_adult = yes
				}
			}
		}

		third_party_allow = {
			#show_only_failed_conditions = yes
			FROMFROM = {

			}
		}

		effect = {
			offmap_magic = {
				offmap_ruler = {
					FROMFROM = {
						save_event_target_as = magic_target
						if = {
							limit = { is_invincible_trigger = yes }
							antideath_effect = yes
							break = yes
						}
						if = {
				 			limit = {
				 				OR = {
									trait = undivided_demon
				 					trait = khorne_demon
									trait = nurgle_demon
									trait = slaanesh_demon
									trait = tzeentch_demon
				 				}
				 			}
							character_event = { id = sdemons.1 }
							break = yes
						}
					}
				}
			}
			FROM = {
				sound_effect = china_grace_gain
				show_scope_change = no
				add_offmap_currency = {
					offmap = offmap_magic
					value = -10
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.26 }
			}
		}

		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2.0
				is_rival = FROMFROM
			}
		}
	}
	veil_of_corruption = { # Extreme Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_chaos
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 12 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_special_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_special_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -12
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	#LORE OF NURGLE
	plague_wind = { # Applies Province Tainted modifier and lowers prosperity
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_nurgle
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 6 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = tainted_province_location }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = tainted_province_location
				add_offmap_currency = {
					offmap = offmap_magic
					value = -6
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
				character_event = { id = mageproc.33 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				FROM = {
					location = {
						owner = { character = FROM }
						owner = { top_liege = { character = FROM } }
					}
				}
			}
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	rotbomb = { # Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_nurgle
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 8 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -8
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	nurgles_boon = { # Heal units at current location removes tainted province modifier and reduces disease
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_nurgle
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 10 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = heal_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = heal_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -10
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.5 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	sumptuous_pestilence = { # Spawns Disease at current location and adds morale and combat auras
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 24

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_nurgle
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 12 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = spawn_disease_location }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_joyous_aspect_effect = yes
				set_character_flag = spawn_disease_location
				add_offmap_currency = {
					offmap = offmap_magic
					value = -12
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.39 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.5
				FROM = {
					location = {
						owner = { character = FROM }
						owner = { top_liege = { character = FROM } }
					}
				}
			}
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	#LORE OF TZEENTCH
	flames_of_fate = { # Plot Protection, Reveals Plots
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 24

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_tzeentch
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 4 }
				NOT = { trait = incapable }
				NOT = { has_character_flag = plots_and_dreams }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				add_offmap_currency = {
					offmap = offmap_magic
					value = -4
				}
				hidden_tooltip = {
					foresight_plot_protection_effect = yes
					set_character_flag = plots_and_dreams
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
				character_event = { id = mageproc.0 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.75
				FROM = {
					location = {
						NOT = { owner = { character = FROM } }
						NOT = { owner = { top_liege = { character = FROM } } }
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					OR = {
						trait = brave
						trait = zealous
					}
				}
			}
			modifier = {
				factor = 1.2
				FROM = {
					OR = {
						trait = paranoid
						trait = craven
					}
				}
			}
			modifier = {
				factor = 0.1
				war = yes
			}
			modifier = {
				factor = 2
				war = no
			}
		}
	}
	treason_of_tzeentch = { # Morale Damage units at the current location and drains commanders of magic and spellpower
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_tzeentch
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 6 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = drain_magic_location }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = drain_magic_location
				add_offmap_currency = {
					offmap = offmap_magic
					value = -6
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
				character_event = { id = mageproc.38 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	infernal_gateway = { # Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_tzeentch
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 8 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -8
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	mindfire = { # Influences target opinion of caster
		only_playable = yes
		button_name = offmap_boons

		third_party_filter = sub_realm
		ai_third_party_filter = sub_realm
		third_party = FROM
		ai_check_interval = 12
		show_third_party_potential = yes

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_tzeentch
			is_ruler = yes
			NOT = { trait = incapable }
		}

		allow = {
			FROM = {
				show_scope_change = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				has_offmap_currency = { offmap = offmap_magic value = 8 }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		third_party_potential = {
			#show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				hidden_tooltip = {
					is_invincible_trigger = no
					is_vampire_trigger = no
					is_heir = no
					is_adult = yes
				}
			}
		}

		third_party_allow = {
			#show_only_failed_conditions = yes
			FROMFROM = {

			}
		}

		effect = {
			FROMFROM = {
				save_event_target_as = magic_target
			}
			FROM = {
				sound_effect = china_grace_gain
				show_scope_change = no
				add_offmap_currency = {
					offmap = offmap_magic
					value = -8
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.26 }
			}
			offmap_magic = {
				offmap_ruler = {
					FROMFROM = {
						if = {
							limit = { is_invincible_trigger = yes }
							antideath_effect = yes
							break = yes
						}
						if = {
				 			limit = {
				 				OR = {
									trait = undivided_demon
				 					trait = khorne_demon
									trait = nurgle_demon
									trait = slaanesh_demon
									trait = tzeentch_demon
				 				}
				 			}
							character_event = { id = sdemons.1 }
							break = yes
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2.0
				is_rival = FROMFROM
			}
		}
	}
	tzeentchs_blessing = { # Potentially Mutates and harms target, Heals caster and friendly units at location
		only_playable = yes
		button_name = offmap_boons

		third_party_filter = sub_realm
		ai_third_party_filter = sub_realm
		third_party = FROM
		ai_check_interval = 24
		show_third_party_potential = yes

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_tzeentch
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
		}

		allow = {
			FROM = {
				show_scope_change = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				has_offmap_currency = { offmap = offmap_magic value = 10 }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		third_party_potential = {
			#show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				hidden_tooltip = {
					is_invincible_trigger = no
					is_vampire_trigger = no
					is_heir = no
					is_adult = yes
				}
			}
		}

		third_party_allow = {
			#show_only_failed_conditions = yes
			FROMFROM = {

			}
		}

		effect = {
			offmap_magic = {
				offmap_ruler = {
					FROMFROM = {
						save_event_target_as = magic_target
						if = {
							limit = { is_invincible_trigger = yes }
							antideath_effect = yes
							break = yes
						}
						if = {
				 			limit = {
				 				OR = {
									trait = undivided_demon
				 					trait = khorne_demon
									trait = nurgle_demon
									trait = slaanesh_demon
									trait = tzeentch_demon
				 				}
				 			}
							character_event = { id = sdemons.1 }
							break = yes
						}
						random_list = {
							15 = {
								custom_tooltip = {
									text = mutations_test_tt
									mutation_toughness_test_effect = yes
								}
							}
							85 = {}
						}
					}
				}
			}
			FROM = {
				sound_effect = china_grace_gain
				show_scope_change = no
				add_offmap_currency = {
					offmap = offmap_magic
					value = -10
				}
				hidden_tooltip = {
					healing_effect = yes
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.5 }
			}
		}

		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2.0
				is_rival = FROMFROM
			}
			modifier = {
				factor = 2
				health < 5
			}
			modifier = {
				factor = 0.5
				health > 10
			}
			modifier = {
				factor = 0.1
				health > 15
			}
		}
	}
	daemonfire_vortex = { # Extreme Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_tzeentch
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 12 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_special_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_special_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -12
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	#LORE OF SLAANESH
	luxurious_torment = { # Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_slaanesh
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 6 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -6
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	song_of_seduction = { # Influences target opinion of caster and adds morale and combat auras
		only_playable = yes
		button_name = offmap_boons

		third_party_filter = sub_realm
		ai_third_party_filter = sub_realm
		third_party = FROM
		ai_check_interval = 12
		show_third_party_potential = yes

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_slaanesh
			is_ruler = yes
			NOT = { trait = incapable }
		}

		allow = {
			FROM = {
				show_scope_change = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				has_offmap_currency = { offmap = offmap_magic value = 8 }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		third_party_potential = {
			#show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				hidden_tooltip = {
					is_invincible_trigger = no
					is_vampire_trigger = no
					is_heir = no
					is_adult = yes
				}
			}
		}

		third_party_allow = {
			#show_only_failed_conditions = yes
			FROMFROM = {

			}
		}

		effect = {
			FROMFROM = {
				save_event_target_as = magic_target
			}
			FROM = {
				enhanced_ability_titillating_delusions_effect = yes
				sound_effect = china_grace_gain
				show_scope_change = no
				add_offmap_currency = {
					offmap = offmap_magic
					value = -8
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.26 }
			}
			offmap_magic = {
				offmap_ruler = {
					FROMFROM = {
						if = {
							limit = { is_invincible_trigger = yes }
							antideath_effect = yes
							break = yes
						}
						if = {
				 			limit = {
				 				OR = {
									trait = undivided_demon
				 					trait = khorne_demon
									trait = nurgle_demon
									trait = slaanesh_demon
									trait = tzeentch_demon
				 				}
				 			}
							character_event = { id = sdemons.1 }
							break = yes
						}
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2.0
				is_rival = FROMFROM
			}
		}
	}
	slothful_stupor_spell = { # Applies Slothful Stupor modifier and lowers prosperity
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_slaanesh
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 10 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = slothful_stupor_location }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = slothful_stupor_location
				add_offmap_currency = {
					offmap = offmap_magic
					value = -10
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.40 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				FROM = {
					location = {
						owner = { character = FROM }
						owner = { top_liege = { character = FROM } }
					}
				}
			}
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	pavane_of_slaanesh = { # Extreme Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_slaanesh
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 12 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_special_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_special_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -12
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	#LORE OF HASHUT
	ash_storm = { # Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = chaos_dwarf_sorcerer
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 8 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -8
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	breath_of_hatred = { # Aura, Strength bonus, Land Organisation
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = chaos_dwarf_sorcerer
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 10 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = enhanced_strength }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_strength_effect = yes
				add_offmap_currency = {
					offmap = offmap_magic
					value = -10
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	dark_subjugation = { # Enhances Province Prosperity
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = chaos_dwarf_sorcerer
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 12 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = prosperity_location_increase }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = prosperity_location_increase
				add_offmap_currency = {
					offmap = offmap_magic
					value = -12
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.35 }
			}
		}

		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 4
				FROM = {
					location = {
						owner = { character = FROM }
						owner = { top_liege = { character = FROM } }
					}
				}
			}
			modifier = {
				factor = 0.1
				war = yes
			}
			modifier = {
				factor = 2
				war = no
			}
		}
	}
	flames_of_azgorh = { # Extreme Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = chaos_dwarf_sorcerer
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 14 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_special_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_special_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -14
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	#LORE OF NEHEKHARA
	incantation_of_protection = { # Aura, Defense Modifier and personal combat skill
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = khemri_liche_priest
				trait = king_settra
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 8 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = enhanced_defensive }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_defensive_effect = yes
				add_offmap_currency = {
					offmap = offmap_magic
					value = -8
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	incantation_of_desert_wind = { # Applies Desert Wind modifier and lowers prosperity
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = khemri_liche_priest
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 10 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = desert_wind_location }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = desert_wind_location
				add_offmap_currency = {
					offmap = offmap_magic
					value = -10
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.41 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				FROM = {
					location = {
						owner = { character = FROM }
						owner = { top_liege = { character = FROM } }
					}
				}
			}
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	incantation_of_urgency = { # Aura, Movement Speed bonus, Land Organisation
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = khemri_liche_priest
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 12 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = enhanced_speed }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_speed_effect = yes
				add_offmap_currency = {
					offmap = offmap_magic
					value = -12
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	incantation_of_vengeance = { # Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = khemri_liche_priest
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 14 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -14
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	#LORE OF THE BIG WAAAAGH
	brain_bursta = { # Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			culture_group = orc_group
			OR = {
				trait = lore_waaagh
				trait = greenskin_shaman
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 8 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -8
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	ard_as_nails = { # Aura, Strength bonus, Land Organisation
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			culture_group = orc_group
			OR = {
				trait = lore_waaagh
				trait = greenskin_shaman
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 10 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = enhanced_strength }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_strength_effect = yes
				add_offmap_currency = {
					offmap = offmap_magic
					value = -10
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	the_evil_sun = { # Extreme Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			culture_group = orc_group
			OR = {
				trait = lore_waaagh
				trait = greenskin_shaman
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 12 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_special_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_special_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -12
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	#LORE OF THE LITTLE WAAAAGH
	great_green_spite = { # Lowers Prosperity of current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			culture_group = goblin_group
			OR = {
				trait = lore_waaagh
				trait = greenskin_shaman
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 8 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = prosperity_location_decrease }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = prosperity_location_decrease
				add_offmap_currency = {
					offmap = offmap_magic
					value = -8
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
				character_event = { id = mageproc.9 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				FROM = {
					location = {
						owner = { character = FROM }
						owner = { top_liege = { character = FROM } }
					}
				}
			}
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	gift_of_the_spider_god = { # Aura, Movement Speed bonus, Land Organisation
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			culture_group = goblin_group
			OR = {
				trait = lore_waaagh
				trait = greenskin_shaman
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 10 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = enhanced_speed }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_speed_effect = yes
				add_offmap_currency = {
					offmap = offmap_magic
					value = -10
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	curse_of_da_bad_moon = { # Morale Damage units at the current location and drains commanders of magic and spellpower
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			culture_group = goblin_group
			OR = {
				trait = lore_waaagh
				trait = greenskin_shaman
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 12 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = drain_magic_location }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = drain_magic_location
				add_offmap_currency = {
					offmap = offmap_magic
					value = -12
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.38 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	#ICE MAGIC
	chill_voice = { # Aura, Charisma and Diplomacy boost
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = ice_witch
				trait = lore_ice
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 6 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = enhanced_charisma }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_charisma_effect = yes
				add_offmap_currency = {
					offmap = offmap_magic
					value = -6
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	hawks_of_miska = { # Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = ice_witch
				trait = lore_ice
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 8 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -8
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	blizzard_spell = { # Applies Blizzard modifier
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = ice_witch
				trait = lore_ice
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 10 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = blizzard_location }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = blizzard_location
				add_offmap_currency = {
					offmap = offmap_magic
					value = -10
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.42 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				FROM = {
					location = {
						owner = { character = FROM }
						owner = { top_liege = { character = FROM } }
					}
				}
			}
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	ice_maidens_kiss = { # Extreme Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = ice_witch
				trait = lore_ice
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 12 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_special_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_special_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -12
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	#ICE HAG MAGIC
	fortune_told = { # Plot Protection, Reveals Plots
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 24

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = hag_witch
				trait = lore_hag
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 6 }
				NOT = { trait = incapable }
				NOT = { has_character_flag = plots_and_dreams }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				add_offmap_currency = {
					offmap = offmap_magic
					value = -6
				}
				hidden_tooltip = {
					foresight_plot_protection_effect = yes
					set_character_flag = plots_and_dreams
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
				character_event = { id = mageproc.0 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.75
				FROM = {
					location = {
						NOT = { owner = { character = FROM } }
						NOT = { owner = { top_liege = { character = FROM } } }
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					OR = {
						trait = brave
						trait = zealous
					}
				}
			}
			modifier = {
				factor = 1.2
				FROM = {
					OR = {
						trait = paranoid
						trait = craven
					}
				}
			}
			modifier = {
				factor = 0.1
				war = yes
			}
			modifier = {
				factor = 2
				war = no
			}
		}
	}
	resist_chaos = { # Aura, Defense Modifier and personal combat skill
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = hag_witch
				trait = lore_hag
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 8 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = enhanced_defensive }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_defensive_effect = yes
				add_offmap_currency = {
					offmap = offmap_magic
					value = -8
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	cleanse_soul = { # Heal units at current location removes tainted province modifier and reduces disease
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = hag_witch
				trait = lore_hag
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 10 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = heal_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = heal_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -10
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.5 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	witchs_curse = { # Morale Damage units at the current location and drains commanders of magic and spellpower
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = hag_witch
				trait = lore_hag
			}
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 12 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = drain_magic_location }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = drain_magic_location
				add_offmap_currency = {
					offmap = offmap_magic
					value = -12
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.38 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	#GUT MAGIC
	spinemarrow = { # Aura, Strength bonus, Land Organisation
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			culture_group = orc_group
			trait = lore_maw
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 6 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = enhanced_strength }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_strength_effect = yes
				add_offmap_currency = {
					offmap = offmap_magic
					value = -6
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 1
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	bonecrusher = { # Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_maw
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 8 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -8
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	trollguts = { # Heal units at current location removes tainted province modifier and reduces disease
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_maw
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 10 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = heal_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = heal_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -10
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
				character_event = { id = mageproc.5 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	the_maw = { # Extreme Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			trait = lore_maw
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 12 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_special_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_special_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -12
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	#GENERIC SPELLS
	mystic_shield = { # Aura, Defense Modifier and personal combat skill
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = hedge_wizard
				trait = witch
				trait = warlock
			}
			NOT = { is_trained_mage_trigger = yes }
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 10 }
				NOT = { trait = incapable }
				NOT = { has_character_modifier = enhanced_defensive }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				enhanced_ability_defensive_effect = yes
				add_offmap_currency = {
					offmap = offmap_magic
					value = -10
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 2
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	arcane_blast = { # Damage units at the current location
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = hedge_wizard
				trait = witch
				trait = warlock
			}
			NOT = { is_trained_mage_trigger = yes }
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 12 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = damage_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = damage_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -12
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 3
					hidden = yes
				}
				character_event = { id = mageproc.6 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	twilight_pathway = { # Heal units at current location removes tainted province modifier and reduces disease
		only_playable = yes
		button_name = offmap_boons

		ai_check_interval = 12

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
			OR = {
				trait = hedge_wizard
				trait = witch
				trait = warlock
			}
			NOT = { is_trained_mage_trigger = yes }
			OR = {
				is_ruler = yes
				in_command = yes
			}
			NOT = { trait = incapable }
			prisoner = no
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 14 }
				in_command = yes
				NOT = { trait = incapable }
				NOT = { has_character_flag = heal_location_troops }
				custom_tooltip = {
					text = magic_cooldown_tt
					NOT = { has_character_modifier = magic_cooldown }
				}
			}
		}

		effect = {
			FROM = {
				set_character_flag = heal_location_troops
				add_offmap_currency = {
					offmap = offmap_magic
					value = -14
				}
				add_character_modifier = {
					name = magic_cooldown
					months = 4
					hidden = yes
				}
				character_event = { id = mageproc.5 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				war = no
			}
			modifier = {
				factor = 2
				war = yes
			}
		}
	}
	#LORE OF THE DEEP
	#create trait
	#LORE OF VERMIN
	#trait = warlock_engineer
	#trait = grey_seer
	#trait = eshin_assassin
	#trait = plaguelord
	#trait = lore_vermin
}

#ENCHANTING & ALCHEMY
offmap_decisions = {
	#Enchanting
	craft_amulet = {
		only_playable = yes
		button_name = offmap_enchanting_button
		ai_check_interval = 60

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 5 }
				wealth = 100
				show_scope_change = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				custom_tooltip = {
					text = crafting_cooldown_tt
					NOT = { has_character_flag = enchanting_item }
				}
			}
		}

		effect = {
			FROM = {
				add_offmap_currency = {
					offmap = offmap_magic
					value = -5
				}
				set_character_flag = enchanting_item
				character_event = { id = crafting.0 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}
	craft_ring = {
		only_playable = yes
		button_name = offmap_enchanting_button
		ai_check_interval = 60

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 5 }
				wealth = 100
				show_scope_change = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				custom_tooltip = {
					text = crafting_cooldown_tt
					NOT = { has_character_flag = enchanting_item }
				}
			}
		}

		effect = {
			FROM = {
				add_offmap_currency = {
					offmap = offmap_magic
					value = -5
				}
				set_character_flag = enchanting_item
				character_event = { id = crafting.2 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}
	craft_weapon = {
		only_playable = yes
		button_name = offmap_enchanting_button
		ai_check_interval = 60

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 5 }
				wealth = 100
				show_scope_change = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				custom_tooltip = {
					text = crafting_cooldown_tt
					NOT = { has_character_flag = enchanting_item }
				}
			}
		}

		effect = {
			FROM = {
				add_offmap_currency = {
					offmap = offmap_magic
					value = -5
				}
				set_character_flag = enchanting_item
				character_event = { id = crafting.4 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}
	#Alchemy
	craft_potion = {
		only_playable = yes
		button_name = offmap_alchemy_button
		ai_check_interval = 60

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 5 }
				wealth = 100
				show_scope_change = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				custom_tooltip = {
					text = crafting_cooldown_tt
					NOT = { has_character_flag = enchanting_item }
				}
			}
		}

		effect = {
			FROM = {
				add_offmap_currency = {
					offmap = offmap_magic
					value = -5
				}
				set_character_flag = enchanting_item
				character_event = { id = crafting.6 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}
	craft_elixir = {
		only_playable = yes
		button_name = offmap_alchemy_button
		ai_check_interval = 60

		potential = {
			is_offmap_tag = offmap_magic
		}

		from_potential = {
			magic_offmap_enabled_trigger = yes
		}

		allow = {
			FROM = {
				has_offmap_currency = { offmap = offmap_magic value = 5 }
				wealth = 100
				show_scope_change = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				custom_tooltip = {
					text = crafting_cooldown_tt
					NOT = { has_character_flag = enchanting_item }
				}
			}
		}

		effect = {
			FROM = {
				add_offmap_currency = {
					offmap = offmap_magic
					value = -5
				}
				set_character_flag = enchanting_item
				character_event = { id = crafting.8 }
			}
		}

		ai_will_do = {
			factor = 0
		}
	}
}

###OTHER INTERACTIONS###

#Factions for Magic Legality
plot_decisions = {
	faction_antimagic_revolters_ultimatum = {
		only_playable = yes
		is_high_prio = yes
		ai_check_interval = 3

		potential = {
			is_playable = yes
			leads_faction = faction_antimagic_revolters
			OR = {
				NOT = { has_character_flag = faction_magic_revolters_ultimatum_taken}
				had_character_flag = { flag = faction_magic_revolters_ultimatum_taken days = 7 }
			}
		}
		allow = {
			war = no
			prisoner = no
			liege = {
				in_revolt = no
				NOT = { war_with = ROOT }
				NOT = { reverse_has_truce = ROOT }
			}
			NOT = {
				any_realm_title = {
					NOT = { higher_tier_than = count }
					is_occupied = yes
				}
			}

			liege = {
				OR = {
					independent = yes
					AND = {
						will_liege_enforce_peace = no
						has_liege_enforced_peace = no
					}
				}
			}
		}
		effect = {
			liege = {
				letter_event = { id = wh_magic_law.13 days = 3 tooltip = "EVTTOOLTIP8005" }
			}
			hidden_tooltip = {
				set_character_flag = faction_magic_revolters_ultimatum_taken
			}
		}
		revoke_allowed = {
			always = no
		}

		ai_will_do = {
			factor = 1

			modifier = {
				factor = 0
				NOT = {
					faction_power =
					{
						faction = faction_antimagic_revolters
						power = 0.75
					}
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					faction_power =
					{
						faction = faction_antimagic_revolters
						power = 1.0
					}
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					faction_power =
					{
						faction = faction_antimagic_revolters
						power = 1.5
					}
				}
			}

			modifier = {
				factor = 0
				liege = {
					any_war = {
						OR = {
							AND = {
								defender = { character = PREV }
								NOT = { using_cb = depose_liege }
								NOT = { using_cb = overthrow_ruler }
								NOT = { using_cb = overthrow_ruler_no_calls }
							}
							AND = {
								attacker = { character = PREV }
								OR = {
									using_cb = invasion
									using_cb = religious
									using_cb = tribal_invasion
									using_cb = muslim_invasion
									using_cb = viking_invasion
									using_cb = claim_all
									using_cb = claim
									using_cb = other_claim
								}
							}
						}
					}
				}
			}
		}
	}
	faction_promagic_revolters_ultimatum = {
		only_playable = yes
		is_high_prio = yes
		ai_check_interval = 3

		potential = {
			is_playable = yes
			leads_faction = faction_promagic_revolters
			OR = {
				NOT = { has_character_flag = faction_magic_revolters_ultimatum_taken}
				had_character_flag = { flag = faction_magic_revolters_ultimatum_taken days = 7 }
			}
		}
		allow = {
			war = no
			prisoner = no
			liege = {
				in_revolt = no
				NOT = { war_with = ROOT }
				NOT = { reverse_has_truce = ROOT }
			}
			NOT = {
				any_realm_title = {
					NOT = { higher_tier_than = count }
					is_occupied = yes
				}
			}

			liege = {
				OR = {
					independent = yes
					AND = {
						will_liege_enforce_peace = no
						has_liege_enforced_peace = no
					}
				}
			}
		}
		effect = {
			liege = {
				letter_event = { id = wh_magic_law.13 days = 3 tooltip = "EVTTOOLTIP8005" }
			}
			hidden_tooltip = {
				set_character_flag = faction_magic_revolters_ultimatum_taken
			}
		}
		revoke_allowed = {
			always = no
		}

		ai_will_do = {
			factor = 1

			modifier = {
				factor = 0
				NOT = {
					faction_power =
					{
						faction = faction_promagic_revolters
						power = 0.75
					}
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					faction_power =
					{
						faction = faction_promagic_revolters
						power = 1.0
					}
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					faction_power =
					{
						faction = faction_promagic_revolters
						power = 1.5
					}
				}
			}

			modifier = {
				factor = 0
				liege = {
					any_war = {
						OR = {
							AND = {
								defender = { character = PREV }
								NOT = { using_cb = depose_liege }
								NOT = { using_cb = overthrow_ruler }
								NOT = { using_cb = overthrow_ruler_no_calls }
							}
							AND = {
								attacker = { character = PREV }
								OR = {
									using_cb = invasion
									using_cb = religious
									using_cb = tribal_invasion
									using_cb = muslim_invasion
									using_cb = viking_invasion
									using_cb = claim_all
									using_cb = claim
									using_cb = other_claim
								}
							}
						}
					}
				}
			}
		}
	}
}
