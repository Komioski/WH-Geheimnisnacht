#namespace = kislevmagic
##This event chain determines who gets to become ice mages/ice witches. For now, it is based on the inherited intelligence traits##
#Landed characters only so far, as studying magic is expensive and we don't want all smart kislevites to become mages##
#KISLEVITES NOW GET TAUGHT BY WANDERING WITCHES USING THE MAGIC APPRENTICE SYSTEM
#character_event = {
#	id = kislevmagic.0
#	title = MAGIC
#	desc = kislevmagic0 #Your natural abilities seem to run towards magic. Training will be expensive, but perhaps for 100 gold you could get started on building a magical lab and hiring someone to teach you.#
#	picture = "GFX_evt_miscast"
#	min_age = 16
#
#	trigger = {
#	is_landed = yes
#	culture_group = kislevite_group
#	OR = {
#		trait = magic_potential_1
#		trait = magic_potential_2
#		trait = magic_potential_3
#		trait = magic_potential_4
#		}
#	NOT = { trait = lore_ice }
#	NOT = { has_character_flag = refused_ice }
#	}
#
#	mean_time_to_happen = {
#	months = 6
#	}
#
#	option = {
#	name = highelfmagic6A #Yes, I will build a lab and study magic!
#	trigger = {
#	NOT = { trait = craven }
#	NOT = { trait = content }
#	}
#	wealth = -100
#	add_trait = lore_ice
#	add_character_modifier = { name = magic_power_1 duration = -1 }
#	top_liege = {
#	if = {
#	limit = { culture_group = kislevite_group }
#	}
#	character_event = { id = kislevmagic.2 days = 7 }
#	}
#
#	father  = {
#	character_event = { id = kislevmagic.1 }
#	}
#	mother  = {
#	character_event = { id = kislevmagic.1 }
#	}
#	}
#
#	option = {
#	name = highelfmagic6B #No, I do not wish to study magic
#	trigger = {
#	trait = craven
#	trait = content
#	}
#	set_character_flag = refused_ice_magic
#	}
#}

	#parents are informed#
#character_event = {
#	id = kislevmagic.1
#	title = MAGIC
#	desc = kislevmagic1 #Your child shows talent for magic, and has decided to build a lab at home and study under a tutor. This is a great honor for your house, to have an Ice Mage or Witch amongst you.#
#	picture = "GFX_evt_miscast"
#
#	is_triggered_only = yes
#
#	option = {
#	name = highelfmagic7A #A great honor indeed.#
#	prestige = 200
#	}
#}

	#the top liege, if kislevite culture group is informed someone is studying magic independently#
#character_event = {
#	id = kislevmagic.2
#	title = MAGIC
#	desc = kislevmagic2 #You hear that one of your vassals has taking up the study of ice magic. This is a great thing, and can only strengthen your realm.#
#	picture = "GFX_evt_miscast"
#
#	is_triggered_only = yes
#
#	option = {
#	name = kislevmagic2A #Yes, magic can help protect us against our enemies.#
#	}
#}

namespace = wardrobe

#####################
# Into the Wardrobe #
#####################
# Komioski			#
# September 15 2017	#
#####################
#  Version 1.0		#
#####################
# MAIN LOOP
# wardrobe.0	Explore the castle
# wardrobe.1	Into the wardrobe
# wardrobe.2	Unfamiliar surroundings
# wardrobe.3	Strange ruins/Dark Presence
# wardrobe.4	Finding the gemstone
# wardrobe.5	No ones going to believe this!
######################
# Explore Outcomes
######################
# wardrobe.11	Its Getting Late...
# wardrobe.12	Where did this come from?
######################
# Fork in the path Outcomes
######################
# wardrobe.21	Take the left fork
# wardrobe.22	Take the right fork
######################
# Dark Presence Outcomes
######################
# wardrobe.31	Thank God! I made it!
# wardrobe.32	Help! Im hurt!
# wardrobe.33	Whew, that was close!
######################
# Finding the gemstone outcomes
######################
# wardrobe.41	Pick it up
######################
# SPECIAL CONTEXT FLAGS
#########################
# flag_discovered_wardrobe		This character has found a hidden realm.
#########################

character_event = {
	#Basic event information
	id = wardrobe.0
	desc = EVTDESCwardrobe.0
	border = GFX_event_normal_frame_intrigue
	picture=GFX_evt_explore_forest
	is_triggered_only = yes
	#Fast event triggers
	only_playable = yes
	culture_group = kislevite_group
	max_age = 16
	prisoner = no

	trigger = {
		NOR = {
			trait = ice_witch
			trait = hag_witch
			trait = lore_ice
			trait = lore_hag
			has_character_flag = discovered_wardrobe
		}
	}

	weight_multiplier = {
		days = 1
		modifier = {
			factor = 10
			trait = curious
		}
		modifier = {
			factor = 2
			intrigue = 4
		}
	}

	option = {
		name = EVTOPTwardrobe_0
		character_event = { id = wardrobe.1 }
	}
}

character_event = {
	#Basic event information
	id = wardrobe.1
	desc = EVTDESCwardrobe.1
	border = GFX_event_normal_frame_intrigue
	picture=GFX_evt_explore_forest

	#Fast event triggers
	is_triggered_only = yes

	trigger = {
	}

	immediate = {
		set_character_flag = discovered_wardrobe
	}
	option = {
		name = EVTOPTwardrobe_1A
		character_event = { id = wardrobe.11 }
	}
	option = {
		name = EVTOPTwardrobe_1B
		character_event = { id = wardrobe.12 }
	}
}

character_event = {
	#Basic event information
	id = wardrobe.11
	desc = EVTDESCwardrobe.11
	border = GFX_event_normal_frame_intrigue
	picture=GFX_evt_explore_forest

	#Fast event triggers
	is_triggered_only = yes

	trigger = {
	}
	option = {
		name = EVTOPTwardrobe_11
	}
}

character_event = {
	#Basic event information
	id = wardrobe.12
	desc = EVTDESCwardrobe.12
	border = GFX_event_normal_frame_intrigue
	picture=GFX_evt_explore_forest

	#Fast event triggers
	is_triggered_only = yes

	trigger = {
	}
	option = {
		name = EVTOPTwardrobe_12
		character_event = { id = wardrobe.2 }
	}
}

character_event = {
	#Basic event information
	id = wardrobe.2
	desc = EVTDESCwardrobe.2
	border = GFX_event_normal_frame_intrigue
	picture=GFX_evt_explore_forest

	#Fast event triggers
	is_triggered_only = yes

	trigger = {
	}
	option = {
		name = EVTOPTwardrobe_2A
		character_event = { id = wardrobe.21 }
	}
	option = {
		name = EVTOPTwardrobe_2B
		character_event = { id = wardrobe.3 }
	}
}

character_event = {
	#Basic event information
	id = wardrobe.21
	desc = EVTDESCwardrobe.21
	border = GFX_event_normal_frame_intrigue
	picture=GFX_evt_explore_forest

	#Fast event triggers
	is_triggered_only = yes

	trigger = {
	}
	option = {
		name = EVTOPTwardrobe_21
		character_event = { id = wardrobe.5 }
	}
}


character_event = {
	#Basic event information
	id = wardrobe.3
	desc = EVTDESCwardrobe.3
	border = GFX_event_normal_frame_intrigue
	picture=GFX_evt_explore_forest

	#Fast event triggers
	is_triggered_only = yes

	trigger = {
	}
	option = {
		name = EVTOPTwardrobe_3A
		random_list = {
		85 = {character_event = { id = wardrobe.31 tooltip = "EVTTOOLTIPwardrobe.31" } }
		15 = {long_character_event = { id = wardrobe.32 tooltip = "EVTTOOLTIPwardrobe.32" } }
		}
	}
	option = {
		name = EVTOPTwardrobe_3B
		random_list = {
		65 = { character_event = { id = wardrobe.33 tooltip = "EVTTOOLTIPwardrobe.33" } }
		35 = { long_character_event = { id = wardrobe.32 tooltip = "EVTTOOLTIPwardrobe.32" } }
		}
	}
}

character_event = {
	#Basic event information
	id = wardrobe.31
	desc = EVTDESCwardrobe.31
	border = GFX_event_normal_frame_intrigue
	picture=GFX_evt_explore_forest

	#Fast event triggers
	is_triggered_only = yes

	trigger = {
	}
	option = {
		name = EVTOPTwardrobe_31
		character_event = { id = wardrobe.5 }
	}
}

long_character_event = {
	#Basic event information
	id = wardrobe.32
	desc = EVTDESCwardrobe.32
	border = GFX_event_long_frame_intrigue
	picture=GFX_evt_explore_forest

	#Fast event triggers
	is_triggered_only = yes

	trigger = {
	}
	option = {
		name = EVTOPTwardrobe_32
		add_trait = wounded
	}
}

character_event = {
	#Basic event information
	id = wardrobe.33
	desc = EVTDESCwardrobe.33
	border = GFX_event_normal_frame_intrigue
	picture=GFX_evt_explore_forest

	#Fast event triggers
	is_triggered_only = yes

	trigger = {
	}
	option = {
		name = EVTOPTwardrobe_33
		character_event = { id = wardrobe.4 }
	}
}

character_event = {
	#Basic event information
	id = wardrobe.4
	desc = EVTDESCwardrobe.4
	border = GFX_event_normal_frame_intrigue
	picture=GFX_evt_explore_forest

	#Fast event triggers
	is_triggered_only = yes

	trigger = {
	}
	option = {
		name = EVTOPTwardrobe_4A
		character_event = { id = wardrobe.41 tooltip = "EVTTOOLTIPwardrobe.4A" }
		hidden_tooltip = {
			add_trait = magic_potential_3
			add_character_modifier = { name = magic_power_2 duration = -1 }
			if = {
				limit = { is_female = yes }
				add_trait = ice_witch
				}
			else_if = {
				limit = { is_female = no }
				add_trait = warlock
			}
		}
	}
	option = {
		name = EVTOPTwardrobe_4B
		character_event = { id = wardrobe.5 }
	}
}

character_event = {
	#Basic event information
	id = wardrobe.41
	desc = EVTDESCwardrobe.41
	border = GFX_event_normal_frame_intrigue
	picture=GFX_evt_explore_forest

	#Fast event triggers
	is_triggered_only = yes

	trigger = {
	}
	option = {
		name = EVTOPTwardrobe_41
		character_event = { id = wardrobe.5 }
	}
}
character_event = {
	#Basic event information
	id = wardrobe.5
	desc = EVTDESCwardrobe.5
	border = GFX_event_normal_frame_intrigue
	picture=GFX_evt_explore_forest

	#Fast event triggers
	is_triggered_only = yes

	trigger = {
	}
	option = {
		name = EVTOPTwardrobe_5
	}
}
#######################startmission_tombola{
namespace=iwitch
####
#iwitch.1-20 Missions
####
###MISSIONS###
##WL Mission Tombola
character_event = {
	id = iwitch.1
	hide_window = yes

	is_triggered_only = yes
	is_in_society = yes
	only_capable = yes

	trigger = {
		any_society_member = {
			#NOT = { character = ROOT }
			is_society_grandmaster = yes
			same_society_as = ROOT
			NOT={ has_character_flag = own_mission_tombola }
		}
		society_member_of = ice_witch_sisterhood
		has_any_quest = no
		NOT = { has_character_modifier = quest_cooldown_timer }
		NOT = { is_inaccessible_trigger = yes }
	}

	immediate = {
		random_society_member = {
			limit = {
				NOT = { character = ROOT }
				society_rank == 4
				same_society_as = ROOT
			}
			save_event_target_as = lodge_hero #Character for handing out missions...
		}
		if = {
			limit = { is_landed = yes }
			capital_scope = { save_event_target_as = home_capital } #For some distance checks...
		}

		### AVAILABLE MISSIONS: ###
		# Raid and loot barony. ....................... HF.25501
		# Lose Weak Focus.............................. iwitch.20
		# Duel <someone>. First blood. ................ HF.10500
		# Hunt Male ............... iwitch.2
		# Wage war against someone! ................... HF.10512
		# Recruit child into society!       ........... iwitch.7

		random_list = {
			20 = {
				trigger = {
					has_dlc = "Way of Life"
					is_landed = yes
					NOR = {
						has_focus = focus_theology
						has_focus = focus_scholarship
						has_focus = focus_rulership
						has_focus = focus_intrigue
					}
				}
				event_target:lodge_hero = {
					character_event = { id = iwitch.20 } #Lose Weak Focus.
				}
			}
			25 = { #Hunt for Male
				modifier={
					factor=2
					ai=yes
					society_rank == 2
				}
				trigger = {
					society_rank = 2
					age = 16
					OR = {
						AND = {
							top_liege={
								culture_group=kislevite_group
								religion_group=old_world_group
								any_realm_character = {
									is_inaccessible_or_incapable_trigger = no
									NOT = { any_spouse = { character = ROOT } }
									NOT = { trait = hollowed }
									trait=creature_human
									OR = {
										has_character_modifier = magic_power_1
										has_character_modifier = magic_power_2
										has_character_modifier = magic_power_3
										has_character_modifier = magic_power_4
										AND={
											trait = magic_potential_4
											learning=10
										}
										AND={
											trait = magic_potential_3
											learning=12
										}
										AND={
											trait = magic_potential_2
											learning=15
										}
										trait = mage_apprentice
									}
									is_female = no
									is_adult = yes
								}
							}
						}
						AND = {
							any_neighbor_independent_ruler = {
								culture_group=kislevite_group
								religion_group=old_world_group
								any_realm_character = {
									is_inaccessible_or_incapable_trigger = no
									NOT = { any_spouse = { character = ROOT } }
									NOT = { trait = hollowed }
									trait=creature_human
									OR = {
										has_character_modifier = magic_power_1
										has_character_modifier = magic_power_2
										has_character_modifier = magic_power_3
										has_character_modifier = magic_power_4
										AND={
											trait = magic_potential_4
											learning=10
										}
										AND={
											trait = magic_potential_3
											learning=12
										}
										AND={
											trait = magic_potential_2
											learning=15
										}
										trait = mage_apprentice
									}
									is_female = no
									is_adult = yes
									ROOT = { capital_scope = { distance = { where = PREV distance < 1000 } } }
								}
				            }
						}
					}
				}
				event_target:lodge_hero = {
					character_event = { id = iwitch.2 } #Hunt Male. To the death!
				}
			}
			60 = { #Recruit an Child
				modifier={
					factor=5
					ice_witch_sisterhood={
						num_of_society_members < 25
					}
				}
				modifier={
					factor=5
					has_landed_title=d_frosthome_lodge
				}
				modifier={
					factor=0.5
					ice_witch_sisterhood={
						num_of_society_members = 30
					}
				}
				modifier={
					factor=0
					ice_witch_sisterhood={
						num_of_society_members = 45
					}
				}
				modifier={
					factor=2.5
					has_landed_title=e_kislev
				}
				modifier={
					factor=10
					any_child={
						is_female=yes
						is_in_society = no
						OR={
							trait = magic_potential_4
							trait = magic_potential_3
						}
						NOT={trait=ice_witch}
					}
				}
				modifier={
					factor=25
					ai=yes
					any_player={
						culture_group=kislevite_group
						religion=kislev_gods
						is_female=yes
						not={society_member_of=ice_witch_sisterhood}
						NOT={has_character_flag=refused_magical_recruitment}
						NOT={has_character_flag=priority_mage_recruit}
						is_in_society = no
						OR={
							trait = magic_potential_4
							trait = magic_potential_3
							trait = magic_potential_2
							trait = magic_potential_1
							has_bloodline_flag = magic_bloodline_female_kislev
							AND={
								has_character_flag = magic_potential_flag_1
								#learning=10
							}
							AND={
								has_character_flag = magic_potential_flag_2
								#learning=12
							}
							has_character_flag = magic_potential_flag_3
							has_character_flag = magic_potential_flag_4
						}
					}
				}
				trigger = {
			        #is_playable = yes
	    			is_adult = yes
				    #is_landed=yes
					OR = {
						any_player={
							culture_group=kislevite_group
							religion=kislev_gods
							is_female=yes
							not={society_member_of=ice_witch_sisterhood}
							is_in_society = no
							OR={
								trait = magic_potential_4
								trait = magic_potential_3
								trait = magic_potential_2
								trait = magic_potential_1
								has_bloodline_flag = magic_bloodline_female_kislev
								OR={
									NOT = { has_magic_power_trigger = yes }
									trait=lore_ice
								}
								AND={
									has_character_flag = magic_potential_flag_1
									#learning=10
								}
								AND={
									has_character_flag = magic_potential_flag_2
									#learning=12
								}
								has_character_flag = magic_potential_flag_3
								has_character_flag = magic_potential_flag_4
							}
						}
						any_realm_lord={
							culture_group=kislevite_group
							religion=kislev_gods
							is_female=yes
							not={society_member_of=ice_witch_sisterhood}
							is_in_society = no
							OR={
								trait = magic_potential_4
								trait = magic_potential_3
								has_character_flag = magic_potential_flag_3
								has_character_flag = magic_potential_flag_4
								trait = magic_potential_2
								has_bloodline_flag = magic_bloodline_female_kislev
								AND={
									has_character_flag = magic_potential_2
									learning=10
								}
								AND={
									has_character_flag = magic_potential_flag_2
									learning=12
								}

								OR={
									NOT = { has_magic_power_trigger = yes }
									trait=lore_ice
								}
							}
						}
						top_liege={
							culture_group=kislevite_group
							religion_group=old_world_group
							any_realm_character={
								any_child = {
									is_child_of = PREV
									is_in_society = no
									is_alive = yes
									age = 6
									is_female=yes
									NOT={trait=ice_witch}
									prisoner = no
									OR={
										NOT = { has_magic_power_trigger = yes }
										trait=lore_ice
										has_bloodline_flag = magic_bloodline_female_kislev
									}
									OR={
										trait = magic_potential_4
										trait = magic_potential_3
										trait = magic_potential_2
										trait = magic_potential_1
										AND={
											has_character_flag = magic_potential_flag_1
											learning=10
										}
										AND={
											has_character_flag = magic_potential_flag_2
											learning=12
										}
										has_character_flag = magic_potential_flag_3
										has_character_flag = magic_potential_flag_4
									}

								}
							}
						}
						any_neighbor_independent_ruler = {
							culture_group=kislevite_group
							religion_group=old_world_group
							any_realm_character = {
								any_child = {
									is_child_of = PREV
									is_in_society = no
									is_alive = yes
									age = 6
									is_female=yes
									NOT={trait=ice_witch}
									prisoner = no
									OR={
										NOT = { has_magic_power_trigger = yes }
										trait=lore_ice
									}
									OR={
										trait = magic_potential_4
										trait = magic_potential_3
										trait = magic_potential_2
										trait = magic_potential_1
										has_bloodline_flag = magic_bloodline_female_kislev
										AND={
											has_character_flag = magic_potential_flag_1
											learning=10
										}
										AND={
											has_character_flag = magic_potential_flag_2
											learning=12
										}
										has_character_flag = magic_potential_flag_3
										has_character_flag = magic_potential_flag_4
									}
								}
							}
						}
					}
				}
				event_target:lodge_hero = {
					character_event = { id = iwitch.7 } #Recruit child into warrior lodge!
				}
			}
			75 = { # AI bypasses missions at times
				trigger = {
					ai = yes
				}
				modifier={
					factor=0
					handmaidens_of_the_lady={
						num_of_society_members < 15
					}
				}
				random_list = {
					70 = {
						modifier = {
							factor = 0.9
							society_influence >= 30
						}
						modifier = {
							factor = 0.9
							society_influence >= 40
						}
						modifier = {
							factor = 0.8
							society_influence >= 50
						}
						modifier = {
							factor = 0.7
							society_influence >= 70
						}
						modifier = {
							factor = 0.6
							society_influence >= 80
						}
						modifier = {
							factor = 0.5
							society_influence >= 90
						}
						add_mission_succeed_influence_effect = yes
					}
					30 = {
						add_mission_fail_influence_effect = yes
					}
				}
				#random = {
				#	chance = 10
				#	character_event = { id = HF.25070 } #Small chance for tattoos to Rank 3 and 4s.
				#}
			}
		}
	}
}
#MISSION:
#Ping event for the mission Duel & Slay <someone>
character_event = {
	id = iwitch.2
	hide_window = yes

	is_triggered_only = yes

	immediate = { FROM = { society_quest_event = { id = iwitch.3 days = 7 random = 7 } } }
}

#Matriarch wants you to Hunt down male witch
society_quest_event = {
	id = iwitch.3
	is_triggered_only = yes
	is_in_society = yes
	only_capable = yes

	trigger = {
		FROM = { is_alive = yes }
		society_member_of = ice_witch_sisterhood
		same_society_as = FROM
		has_any_quest = no
		NOT = { has_character_modifier = quest_cooldown_timer }
		NOT = { is_inaccessible_trigger = yes }
		is_landed = yes
	}

	desc = {
		text = EVTDESCMAGEVSMAGEHUNT1 #default
		trigger = { always = yes }
	}

	immediate = {
		if = { # best case (a realm character) who fits the bill...
			limit = {
				top_liege={
					culture_group=kislevite_group
					religion_group=old_world_group
					any_realm_character = {
						is_inaccessible_or_incapable_trigger = no
						NOT = { any_spouse = { character = ROOT } }
						NOT = { trait = hollowed }
						trait=creature_human
						OR = {
							has_character_modifier = magic_power_1
							has_character_modifier = magic_power_2
							has_character_modifier = magic_power_3
							has_character_modifier = magic_power_4
							AND={
								trait = magic_potential_4
								learning=10
							}
							AND={
								trait = magic_potential_3
								learning=15
							}
							trait = mage_apprentice
						}
						is_female = no
						#is_adult = yes
					}
				}
			}
			top_liege={
				any_realm_character = {
					limit = {
						is_inaccessible_or_incapable_trigger = no
						NOT = { any_spouse = { character = ROOT } }
						NOT = { trait = hollowed }
						trait=creature_human
						OR = {
							has_character_modifier = magic_power_1
							has_character_modifier = magic_power_2
							has_character_modifier = magic_power_3
							has_character_modifier = magic_power_4
							AND={
								trait = magic_potential_4
								learning=10
							}
							AND={
								trait = magic_potential_3
								learning=12
							}
							AND={
								trait = magic_potential_2
								learning=15
							}
							trait = mage_apprentice
						}
						is_female = no
						#is_adult = yes
					}
					score_value = { #Prioritizes selecting some kind of character you wouldn't get along with...
						value = 10
						potential_rival_score = yes
					}
					score_value = { #Extra weight for characters you've encountered before...
						value = 10
						disliked_target_selection_score = yes
					}
					save_event_target_as = male_target
					break = yes
				}
			}
		}
		if = { #2nd case (a *neighbor's* realm character) who fits the bill...
			limit = {
				any_neighbor_independent_ruler = {
					culture_group=kislevite_group
					religion_group=old_world_group
					any_realm_character = {
						is_inaccessible_or_incapable_trigger = no
						NOT = { any_spouse = { character = ROOT } }
						NOT = { trait = hollowed }
						trait=creature_human
						OR = {
							has_character_modifier = magic_power_1
							has_character_modifier = magic_power_2
							has_character_modifier = magic_power_3
							has_character_modifier = magic_power_4
							AND={
								trait = magic_potential_4
								learning=10
							}
							AND={
								trait = magic_potential_3
								learning=12
							}
							AND={
								trait = magic_potential_2
								learning=15
							}
							trait = mage_apprentice
						}
						is_female = no
						is_adult = yes
						ROOT = { capital_scope = { distance = { where = PREV distance < 1000 } } }
					}
	            }
			}
			random_neighbor_independent_ruler = {
				limit = {
					culture_group=kislevite_group
					religion_group=old_world_group
					any_realm_character = {
						is_inaccessible_or_incapable_trigger = no
						NOT = { any_spouse = { character = ROOT } }
						NOT = { trait = hollowed }
						trait=creature_human
						OR = {
							has_character_modifier = magic_power_1
							has_character_modifier = magic_power_2
							has_character_modifier = magic_power_3
							has_character_modifier = magic_power_4
							AND={
								trait = magic_potential_4
								learning=10
							}
							AND={
								trait = magic_potential_3
								learning=12
							}
							AND={
								trait = magic_potential_2
								learning=15
							}
							trait = mage_apprentice
						}
						is_female = no
						is_adult = yes
						ROOT = { capital_scope = { distance = { where = PREV distance < 1000 } } }
					}
				}
				any_realm_character = {
					limit = {
						is_inaccessible_or_incapable_trigger = no
						NOT = { any_spouse = { character = ROOT } }
						NOT = { trait = hollowed }
						trait=creature_human
						OR = {
							has_character_modifier = magic_power_1
							has_character_modifier = magic_power_2
							has_character_modifier = magic_power_3
							has_character_modifier = magic_power_4
							AND={
								trait = magic_potential_4
								learning=10
							}
							AND={
								trait = magic_potential_3
								learning=12
							}
							AND={
								trait = magic_potential_2
								learning=15
							}
							trait = mage_apprentice
						}
						is_female = no
						is_adult = yes
						ROOT = { capital_scope = { distance = { where = PREV distance < 1000 } } }
	                }
	                score_value = { #Prioritizes selecting some kind of character you wouldn't get along with...
	                	value = 10
	                	potential_rival_score = yes
		            }
		            score_value = { #Extra weight for characters you've encountered before...
		                value = 10
		                disliked_target_selection_score = yes
		            }
					save_event_target_as = male_target
					break = yes
				}
            }
		}
	}

	quest_target = event_target:male_target

	option = {
		name = ACCEPT
		set_character_flag = deadly_duel@event_target:male_target
		event_target:male_target = {
			show_scope_change = no
			set_quest_target = {
				id = quest_ice_witch_hunt
				holder = ROOT
			}
		}
	}
	option  = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}
}
character_event = {
	id = iwitch.4
	desc=EVTDESCmagicpotential12
	#hide_window = yes
	picture = "GFX_evt_kislev_ice_witch"

	is_triggered_only = yes

	immediate = {
		save_event_target_as=witch_hunter
		FROM = { save_event_target_as=the_accused
		character_event = { id = magicpotential.12 days = 7 random = 7 }}
	}
	option={name=EVTOPTAmagicpotential12}
}
#from magicpotential.12006. if local lord decides to take care of the Witch/Male Scholar
character_event = {
	id = iwitch.5
	desc = EVTDESCMAGEVSMAGEHUNT5
	picture = GFX_evt_kislev_ice_witch

	is_triggered_only = yes

	trigger = {
		society_member_of = ice_witch_sisterhood
		has_quest = quest_ice_witch_hunt
		#FROM = { is_quest_target_of = ROOT }
	}

	option = {
		name = EVTOPTAHF25503
		clr_quest = quest_ice_witch_hunt
		piety=100
		add_society_currency_medium_effect = yes
		add_legend_progress_trivial_effect = yes
	}
}
character_event = {
	id = iwitch.6
	desc = EVTDESCMAGEVSMAGEHUNT6
	picture = GFX_evt_kislev_ice_witch
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	trigger = {
		society_member_of = ice_witch_sisterhood
		has_quest = quest_ice_witch_hunt
		#FROM = { is_quest_target_of = ROOT }
	}

	option = {
		name = OK
		clr_quest = quest_ice_witch_hunt
		piety=-100
		add_mission_fail_influence_effect = yes
	}
}

#MISSION:
#Ping event for the mission Recruit Your Child
character_event = {
	id = iwitch.7
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		FROM = { society_quest_event = { id = iwitch.8 days = 7 random = 7 } }
	}
}

#Matriarch character wants you to Recruit a child
society_quest_event = {
	id = iwitch.8
	is_triggered_only = yes
	is_in_society = yes
	only_capable = yes

	trigger = {
		is_landed = yes
	    is_adult = yes
		FROM = { is_alive = yes }
		society_member_of = ice_witch_sisterhood
		same_society_as = FROM
		has_any_quest = no
		NOT = { has_character_modifier = quest_cooldown_timer }
		NOT = { is_inaccessible_trigger = yes }
	}

	desc = EVTDESCIWITCH_8 #default

	immediate = {
		if={limit={
				any_player={
					culture_group=kislevite_group
					religion=kislev_gods
					is_female=yes
					not={society_member_of=ice_witch_sisterhood}
					NOT={has_character_flag=refused_magical_recruitment}
					NOT={has_character_flag=priority_mage_recruit}
					is_in_society = no
					OR={
						NOT = { has_magic_power_trigger = yes }
						trait=lore_ice
					}
					OR={
						trait = magic_potential_4
						trait = magic_potential_3
						trait = magic_potential_2
						trait = magic_potential_1
						AND={
							has_character_flag = magic_potential_flag_1
							#learning=10
						}
						AND={
							has_character_flag = magic_potential_flag_2
							#learning=12
						}
						has_character_flag = magic_potential_flag_3
						has_character_flag = magic_potential_flag_4
					}
				}
			}
			random_player={
				limit={
					culture_group=kislevite_group
					religion=kislev_gods
					is_female=yes
					not={society_member_of=ice_witch_sisterhood}
					NOT={has_character_flag=refused_magical_recruitment}
					NOT={has_character_flag=priority_mage_recruit}
					is_in_society = no
					OR={
						NOT = { has_magic_power_trigger = yes }
						trait=lore_ice
					}
					OR={
						trait = magic_potential_4
						trait = magic_potential_3
						trait = magic_potential_2
						trait = magic_potential_1
						AND={
							has_character_flag = magic_potential_flag_1
							learning=10
						}
						AND={
							has_character_flag = magic_potential_flag_2
							learning=12
						}
						has_character_flag = magic_potential_flag_3
						has_character_flag = magic_potential_flag_4
					}
				}
				save_event_target_as = recruit_to_be
				break = yes
			}
		}
		if={
			limit={
				any_child={
					culture_group=kislevite_group
					religion=kislev_gods
					is_female=yes
					age=8
					not={society_member_of=ice_witch_sisterhood}
					is_in_society = no
					OR={
						trait = magic_potential_4
						trait = magic_potential_3
						has_character_flag = magic_potential_flag_3
						has_character_flag = magic_potential_flag_4
						AND={
							has_character_flag = magic_potential_2
							#learning=10
						}
						AND={
							has_character_flag = magic_potential_flag_2
							#learning=14
						}
						AND={
							has_character_flag = magic_potential_1
							#learning=12
						}
						AND={
							has_character_flag = magic_potential_flag_1
							#learning=18
						}
						OR={
							NOT = { has_magic_power_trigger = yes }
							trait=lore_ice
						}
					}
				}
			}
			random_child={
				limit={
					culture_group=kislevite_group
					religion=kislev_gods
					is_female=yes
					age=8
					not={society_member_of=ice_witch_sisterhood}
					is_in_society = no
					OR={
						trait = magic_potential_4
						trait = magic_potential_3
						has_character_flag = magic_potential_flag_3
						has_character_flag = magic_potential_flag_4
						AND={
							has_character_flag = magic_potential_2
							#learning=10
						}
						AND={
							has_character_flag = magic_potential_flag_2
							#learning=14
						}
						AND={
							has_character_flag = magic_potential_1
							#learning=12
						}
						AND={
							has_character_flag = magic_potential_flag_1
							#learning=16
						}
						OR={
							NOT = { has_magic_power_trigger = yes }
							trait=lore_ice
						}
					}
				}
				score_value = { #Higher Chance to take high magic potential and younger candidates
					value = 10
					ice_witch_recruit_score = yes
				}
				save_event_target_as = recruit_to_be
				break = yes
			}
		}
		if={
			limit={
				any_realm_lord={
					culture_group=kislevite_group
					religion=kislev_gods
					is_female=yes
					age=8
					not={society_member_of=ice_witch_sisterhood}
					is_in_society = no
					OR={
						trait = magic_potential_4
						trait = magic_potential_3
						has_character_flag = magic_potential_flag_3
						has_character_flag = magic_potential_flag_4
						trait = magic_potential_2
						AND={
							has_character_flag = magic_potential_2
							learning=10
						}
						AND={
							has_character_flag = magic_potential_flag_2
							learning=12
						}
						OR={
							NOT = { has_magic_power_trigger = yes }
							trait=lore_ice
						}
					}
				}
			}
			random_realm_lord={
				limit={
					culture_group=kislevite_group
					religion=kislev_gods
					is_female=yes
					age=8
					not={society_member_of=ice_witch_sisterhood}
					is_in_society = no
					OR={
						trait = magic_potential_4
						trait = magic_potential_3
						has_character_flag = magic_potential_flag_3
						has_character_flag = magic_potential_flag_4
						AND={
							has_character_flag = magic_potential_2
							learning=10
						}
						AND={
							has_character_flag = magic_potential_flag_2
							learning=12
						}
						OR={
							NOT = { has_magic_power_trigger = yes }
							trait=lore_ice
						}
					}
				}
				score_value = { #Higher Chance to take high magic potential and younger candidates
					value = 10
					ice_witch_recruit_score = yes
				}
				save_event_target_as = recruit_to_be
				break = yes
			}
		}
		if = { #1st best case (a realm character) who fits the bill...
			limit = {
				top_liege={
					culture_group=kislevite_group
					religion_group=old_world_group
					any_realm_character={
						any_child = {
							is_child_of = PREV
							is_in_society = no
							is_alive = yes
							age = 6
							NOT={age=13}
							is_female=yes
							NOT={trait=ice_witch}
							prisoner = no
							OR={
								NOT = { has_magic_power_trigger = yes }
								trait=lore_ice
							}
							OR={
								trait = magic_potential_4
								trait = magic_potential_3
								trait = magic_potential_2
								trait = magic_potential_1
								AND={
									has_character_flag = magic_potential_flag_1
									learning=10
								}
								AND={
									has_character_flag = magic_potential_flag_2
									learning=12
								}
								has_character_flag = magic_potential_flag_3
								has_character_flag = magic_potential_flag_4
							}
						}
					}
				}
			}
			top_liege={
				any_realm_character={
					limit={
						any_child = {
							is_child_of = PREV
							is_in_society = no
							is_alive = yes
							age = 6
							NOT={age=13}
							is_female=yes
							NOT={trait=ice_witch}
							prisoner = no
							OR={
								NOT = { has_magic_power_trigger = yes }
								trait=lore_ice
							}
							OR={
								trait = magic_potential_4
								trait = magic_potential_3
								trait = magic_potential_2
								trait = magic_potential_1
								AND={
									has_character_flag = magic_potential_flag_1
									learning=10
								}
								AND={
									has_character_flag = magic_potential_flag_2
									learning=12
								}
								has_character_flag = magic_potential_flag_3
								has_character_flag = magic_potential_flag_4
							}
						}
					}
					random_child = {
						limit={
							is_in_society = no
							is_alive = yes
							age = 6
							NOT={age=13}
							is_female=yes
							NOT={trait=ice_witch}
							prisoner = no
							OR={
								NOT = { has_magic_power_trigger = yes }
								trait=lore_ice
							}
							OR={
								trait = magic_potential_4
								trait = magic_potential_3
								trait = magic_potential_2
								trait = magic_potential_1
								AND={
									has_character_flag = magic_potential_flag_1
									#learning=10
								}
								AND={
									has_character_flag = magic_potential_flag_2
									#learning=12
								}
								has_character_flag = magic_potential_flag_3
								has_character_flag = magic_potential_flag_4
							}
						}
						score_value = { #Higher Chance to take high magic potential and younger candidates
							value = 10
							ice_witch_recruit_score = yes
						}
						save_event_target_as = recruit_to_be
						break = yes
					}
				}
			}
		}
		if = { #2nd best case (a realm character) who fits the bill...
			limit = {
				top_liege={
					culture_group=kislevite_group
					religion_group=old_world_group
					any_realm_character={
						any_child = {
							is_child_of = PREV
							is_in_society = no
							is_alive = yes
							age = 6
							is_female=yes
							NOT={trait=ice_witch}
							prisoner = no
							OR={
								NOT = { has_magic_power_trigger = yes }
								trait=lore_ice
							}
							OR={
								trait = magic_potential_4
								trait = magic_potential_3
								trait = magic_potential_2
								trait = magic_potential_1
								AND={
									has_character_flag = magic_potential_flag_1
									learning=10
								}
								AND={
									has_character_flag = magic_potential_flag_2
									learning=12
								}
								has_character_flag = magic_potential_flag_3
								has_character_flag = magic_potential_flag_4
							}
						}
					}
				}
			}
			top_liege={
				any_realm_character={
					limit={
						any_child = {
							is_child_of = PREV
							is_in_society = no
							is_alive = yes
							age = 6
							is_female=yes
							NOT={trait=ice_witch}
							prisoner = no
							OR={
								NOT = { has_magic_power_trigger = yes }
								trait=lore_ice
							}
							OR={
								trait = magic_potential_4
								trait = magic_potential_3
								trait = magic_potential_2
								trait = magic_potential_1
								AND={
									has_character_flag = magic_potential_flag_1
									learning=10
								}
								AND={
									has_character_flag = magic_potential_flag_2
									learning=12
								}
								has_character_flag = magic_potential_flag_3
								has_character_flag = magic_potential_flag_4
							}
						}
					}
					random_child = {
						limit={
							is_in_society = no
							is_alive = yes
							age = 6
							is_female=yes
							NOT={trait=ice_witch}
							prisoner = no
							OR={
								NOT = { has_magic_power_trigger = yes }
								trait=lore_ice
							}
							OR={
								trait = magic_potential_4
								trait = magic_potential_3
								trait = magic_potential_2
								trait = magic_potential_1
								AND={
									has_character_flag = magic_potential_flag_1
									#learning=10
								}
								AND={
									has_character_flag = magic_potential_flag_2
									#learning=12
								}
								has_character_flag = magic_potential_flag_3
								has_character_flag = magic_potential_flag_4
							}
						}
						score_value = { #Higher Chance to take high magic potential and younger candidates
							value = 10
							ice_witch_recruit_score = yes
						}
						save_event_target_as = recruit_to_be
						break = yes
					}
				}
			}
		}
		if = { #2nd best case (a realm character) who fits the bill...
			limit = {
				any_neighbor_independent_ruler = {
					culture_group=kislevite_group
					religion_group=old_world_group
					any_realm_character = {
						any_child = {
							is_child_of = PREV
							is_in_society = no
							is_alive = yes
							age = 6
							is_female=yes
							NOT={trait=ice_witch}
							prisoner = no
							OR={
								NOT = { has_magic_power_trigger = yes }
								trait=lore_ice
							}
							OR={
								trait = magic_potential_4
								trait = magic_potential_3
								trait = magic_potential_2
								trait = magic_potential_1
								AND={
									has_character_flag = magic_potential_flag_1
									learning=10
								}
								AND={
									has_character_flag = magic_potential_flag_2
									learning=12
								}
								has_character_flag = magic_potential_flag_3
								has_character_flag = magic_potential_flag_4
							}
						}
					}
				}
			}
			random_neighbor_independent_ruler={
				limit = {
					culture_group=kislevite_group
					religion_group=old_world_group
					any_realm_character = {
						any_child = {
							is_child_of = PREV
							is_in_society = no
							is_alive = yes
							age = 6
							is_female=yes
							NOT={trait=ice_witch}
							prisoner = no
							OR={
								NOT = { has_magic_power_trigger = yes }
								trait=lore_ice
							}
							OR={
								trait = magic_potential_4
								trait = magic_potential_3
								trait = magic_potential_2
								trait = magic_potential_1
								AND={
									has_character_flag = magic_potential_flag_1
									learning=10
								}
								AND={
									has_character_flag = magic_potential_flag_2
									learning=12
								}
								has_character_flag = magic_potential_flag_3
								has_character_flag = magic_potential_flag_4
							}
						}
					}
				}
				any_realm_character={
					limit = {
						any_child = {
							is_child_of = PREV
							is_in_society = no
							is_alive = yes
							age = 6
							is_female=yes
							NOT={trait=ice_witch}
							prisoner = no
							OR={
								NOT = { has_magic_power_trigger = yes }
								trait=lore_ice
							}
							OR={
								trait = magic_potential_4
								trait = magic_potential_3
								trait = magic_potential_2
								trait = magic_potential_1
								AND={
									has_character_flag = magic_potential_flag_1
									#learning=10
								}
								AND={
									has_character_flag = magic_potential_flag_2
									#learning=12
								}
								has_character_flag = magic_potential_flag_3
								has_character_flag = magic_potential_flag_4
							}
						}
					}
					random_child={
						limit = {
							is_in_society = no
							is_alive = yes
							age = 6
							is_female=yes
							NOT={trait=ice_witch}
							prisoner = no
							OR={
								NOT = { has_magic_power_trigger = yes }
								trait=lore_ice
							}
							OR={
								trait = magic_potential_4
								trait = magic_potential_3
								trait = magic_potential_2
								trait = magic_potential_1
								AND={
									has_character_flag = magic_potential_flag_1
									#learning=10
								}
								AND={
									has_character_flag = magic_potential_flag_2
									#learning=12
								}
								has_character_flag = magic_potential_flag_3
								has_character_flag = magic_potential_flag_4
							}
						}
						score_value = { #Higher Chance to take high magic potential and younger candidates
							value = 10
							ice_witch_recruit_score = yes
						}
						save_event_target_as = recruit_to_be
						break = yes
					}
				}
			}
		}
	}

	quest_target = event_target:recruit_to_be

	option = {
		name = ACCEPT
		event_target:recruit_to_be = {
			show_scope_change = no
			set_quest_target = {
				id = quest_iwitch_recruit
				holder = ROOT
			}
			set_character_flag=priority_mage_recruit
		}
		save_event_target_as=recruiter
		ROOT={character_event={ id=iwitch.9 days=6 random=9 }}
	}
	option  = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}
}
#Approach the New Recruit
character_event = {
	id = iwitch.9
	portrait = event_target:recruit_to_be
	desc = EVTDESCIWITCH_9
	picture = "GFX_evt_kislev_ice_witch"

	is_triggered_only = yes

	option = {
		name = EVTOPTAIWITCH_9
		event_target:recruit_to_be = {
			character_event={id=iwitch.10 days=15 random=7}
		}
	}
}
character_event = {
	id = iwitch.10
	portrait = event_target:recruit_to_be
	desc = EVTDESCIWITCH_10
	picture = "GFX_evt_kislev_ice_witch"

	is_triggered_only = yes

	option = {
		trigger={age=18}
		name = Refuse
		set_character_flag=refused_magical_recruitment
		prestige=-250
		ai_chance={
			factor=5
			modifier={
				factor=0.5
				diplomacy=12
			}
			modifier={
				factor=0.5
				learning=12
			}
			modifier={
				factor=0.5
				diplomacy=15
			}
			modifier={
				factor=0.5
				learning=15
			}
			modifier={
				factor=0
				trait=ambitious
			}
			modifier={
				factor=0
				trait=craven
			}
		}
		from={character_event={id=iwitch.17}}
	}
	option = {
		name = ACCEPT
		if={
			limit={
				event_target:recruiter={
					OR={
						liege={has_landed_title=d_frosthome_lodge}
						has_landed_title=d_frosthome_lodge
					}
				}
				is_landed=no
			}
			move_character=event_target:recruiter
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = no_court_invites
		}
		add_trait=studying_magic
		join_society=ice_witch_sisterhood
		ai_chance={factor=25}
		if={limit={trait=lore_ice}
			character_event={ id=iwitch.11 years=1 } #Faster Induction
		}
		else={
			random_list={
				20={
					trigger = {learning=15}
					character_event={ id=iwitch.11 days=696 } #Should be barely 2 events
					modifier={
						factor = 2
						learning = 20
					}
					modifier = {
						factor = 5
						trait = genius
					}
				}
				20={
					character_event={ id=iwitch.11 years=3 }
					modifier={
						factor=2
						learning=12
					}
					modifier={
						factor=2
						learning=15
					}
					modifier={
						factor = 2
						trait = genius
					}
				}
				15={character_event={ id=iwitch.11 years=4 }}
				15={
					trigger={NOT={learning=8}}
					modifier={
						factor=6
						NOT={learning=6}
					}
					character_event={ id=iwitch.11 years=5 }
				}
			}
		}
		from={character_event={ id=iwitch.16 }}
	}
}
character_event = {
	id = iwitch.11
	portrait = event_target:recruit_to_be
	desc = EVTDESCIWITCH_11
	picture = "GFX_evt_kislev_ice_witch"

	is_triggered_only = yes
	trigger={
		society_member_of=ice_witch_sisterhood
		NOT={trait=ice_witch}
	}
	option = {
		name = OK
		if={limit={trait=studying_magic}
			remove_trait=studying_magic
		}
		if={limit={religion=kislev_gods}
		piety=100
		}
		if={limit={trait=lore_ice}
			add_trait=ice_witch
		}
		else={
			prestige=250
			add_trait=ice_witch
			add_trait=lore_ice
			magic_power_teach_effect=yes
			enable_magic_xp_effect=yes
		}
		if={limit={society_rank==1}
			society_rank_up={
				society=ice_witch_sisterhood
				rank=1
			}
		}
		ai_chance={factor=25}
		event_target:recruiter={
			character_event={id=iwitch.18}
		}
	}
}
#Training, decide how.
character_event = {
	id = iwitch.12
	desc = EVTDESCIWITCH12
	picture = "GFX_evt_kislev_ice_witch"
	trigger={ event_target:recruit_to_be = { not={trait=ice_witch}}}

	is_triggered_only = yes

	trigger={ event_target:recruit_to_be = {
			not={trait=ice_witch}
			is_alive = yes
		}
	}
	fail_trigger_effect = {
		event_target:recruit_to_be = {
			if={limit={is_alive = yes}
			remove_trait=studying_magic
			}
		}
		event_target:recruiter = {
			if={limit={is_alive = yes}
			clr_quest=quest_iwitch_recruit
			}
		}
	}
	option = { name = EVTOPTAsorcererapprentice19 #Teach caution
		hidden_tooltip = { event_target:recruit_to_be = {character_event = { id = iwitch.13 } } }
	}
	option = { name = EVTOPTBIWITCH12 #Teach to experiment
		hidden_tooltip = { event_target:recruit_to_be = { character_event = { id = iwitch.14 } } }
	}
	option = { name = EVTOPTCsorcererapprentice19 #Teach focus
		hidden_tooltip = { event_target:recruit_to_be = {character_event = { id = iwitch.15 } }}
	}
}

#Ward - The Master teaches caution
character_event = {
	id = iwitch.13
	desc = EVTDESCsorcererapprentice19001
	picture = "GFX_evt_kislev_ice_witch"

	is_triggered_only = yes

	trigger={
		not={trait=ice_witch}
		event_target:recruiter = {
			is_alive = yes
		}
	}
	fail_trigger_effect = {
		event_target:recruit_to_be = {
			if={limit={is_alive = yes}
			remove_trait=studying_magic
			}
		}
		event_target:recruiter = {
			if={limit={is_alive = yes}
			clr_quest=quest_iwitch_recruit
			}
		}
	}
	option = {
		name = EVTOPTAsorcererapprentice19001
		random = {
			chance = 5
			if = {
				limit = {
					OR={
						OR={
							AND={
								NOT={learning=14}
								is_adult=no
							}
							AND={
								NOT={learning=16}
								is_adult=yes
							}
						}
						trait=wroth
					}
				}
				antideath_effect = yes
				break = yes
			}
			death = { death_reason = death_accident }
		}
		hidden_tooltip = {
			event_target:recruiter = { character_event = { id = iwitch.12 days = 250 random = 150 } }
			random_list = {
				50 = {
					change_learning = 1
					change_diplomacy = 1
				}
				50 = {
					magic_learning_reduce_bad_outcome = yes
					modifier = {
						factor = 1.45
						FROM = { NOT = { has_character_modifier = magic_power_1 } }
						FROM = { NOT = { has_character_modifier = magic_power_2 } }
						FROM = { NOT = { has_character_modifier = magic_power_3 } }
						FROM = { NOT = { has_character_modifier = magic_power_4 } }
					}
				}
			}
		}
	}
}


#Ward - The Master teaches to experiment
character_event = {
	id = iwitch.14
	desc = EVTDESCsorcererapprentice19002
	picture = "GFX_evt_kislev_ice_witch_casting"

	is_triggered_only = yes
	trigger={
		not={trait=ice_witch}
		event_target:recruiter = {
			is_alive = yes
		}
	}
	fail_trigger_effect = {
		event_target:recruit_to_be = {
			if={limit={is_alive = yes}
			remove_trait=studying_magic
			}
		}
		event_target:recruiter = {
			if={limit={is_alive = yes}
			clr_quest=quest_iwitch_recruit
			}
		}
	}
	option = {
		name = EVTOPTAsorcererapprentice19002
		random = {
			chance = 5
			if = {
				limit = {
					OR={
						AND={
							OR={
								AND={
									NOT={learning=10}
									is_adult=no
								}
								AND={
									NOT={learning=12}
									is_adult=yes
								}
							}
							NOT={trait=patient}
						}
						trait=content
						trait=craven
					}
				}
				antideath_effect = yes
				break = yes
			}
			death = { death_reason = death_accident }
		}
		hidden_tooltip = {
			event_target:recruiter = { character_event = { id = iwitch.12 days = 250 random = 150 } }
			random_list = {
				20 = {
					change_learning = 1
					change_martial = 1
				}
				20 = {
					change_learning = 1
					change_intrigue = 1
				}
				20 = {
					change_learning = 1
					change_stewardship = 1
				}
				40 = {
					magic_learning_reduce_bad_outcome = yes
					modifier = {
						factor = 1.45
						FROM = { NOT = { has_character_modifier = magic_power_1 } }
						FROM = { NOT = { has_character_modifier = magic_power_2 } }
						FROM = { NOT = { has_character_modifier = magic_power_3 } }
						FROM = { NOT = { has_character_modifier = magic_power_4 } }
					}
				}
			}
		}
	}
}

#Ward - The Master teaches to focus
character_event = {
	id = iwitch.15
	desc = EVTDESCsorcererapprentice19003
	picture = "GFX_evt_kislev_ice_witch_casting"

	is_triggered_only = yes

	trigger={
		not={trait=ice_witch}
		event_target:recruiter = {
			is_alive = yes
		}
	}
	fail_trigger_effect = {
		event_target:recruit_to_be = {
			if={limit={is_alive = yes}
			remove_trait=studying_magic
			}
		}
		event_target:recruiter = {
			if={limit={is_alive = yes}
			clr_quest=quest_iwitch_recruit
			}
		}
	}
	option = {
		name = EVTOPTAsorcererapprentice19003
		random = {
			chance = 5
			if = {
				limit = {
					OR={
						AND={
							OR={
								AND={
									NOT={learning=10}
									is_adult=no
								}
								AND={
									NOT={learning=12}
									is_adult=yes
								}
							}
							NOT={trait=temperate}
						}
						trait=ambitious
						trait=stubborn
						trait=wroth
					}
				}
				antideath_effect = yes
				break = yes
			}
			death = { death_reason = death_accident }
		}
		hidden_tooltip = {
			event_target:recruiter = { character_event = { id = iwitch.12 days = 250 random = 150 } }
			random_list = {
				50 = { change_learning = 1 }
				50 = {
					magic_learning_reduce_bad_outcome = yes
					modifier = {
						factor = 1.45
						FROM = { NOT = { has_character_modifier = magic_power_1 } }
						FROM = { NOT = { has_character_modifier = magic_power_2 } }
						FROM = { NOT = { has_character_modifier = magic_power_3 } }
						FROM = { NOT = { has_character_modifier = magic_power_4 } }
					}
				}
			}
		}
	}
}
#Ping
character_event = {
	id = iwitch.16
	desc = EVTDESCIWITCH_16
	picture = "GFX_evt_kislev_ice_witch_casting"

	is_triggered_only = yes

	option = {
		name = EVTOPTIWITCH_16
		character_event={ id=iwitch.12 }
	}
}
character_event = {
	id = iwitch.17
	desc = EVTDESCIWITCH_17
	picture = "GFX_evt_mysterious_forest"

	is_triggered_only = yes

	option = {
		name = EVTOPTAintm0002 #Damn you
		clr_quest = quest_iwitch_recruit
		add_mission_fail_influence_effect=yes
	}
}
character_event = {
	id = iwitch.18
	desc = EVTDESCIWITCH_18
	picture = "GFX_evt_kislev_ice_witch_casting"

	is_triggered_only = yes

	option = {
		name = EVTOPTIWITCH_16
		clr_quest = quest_iwitch_recruit
		add_society_currency_medium_effect=yes
		random_list={
			50={
				add_friend=event_target:recruit_to_be
			}
			50={}
		}
	}
}
###Lose Weak Focus###
#MISSION:
#Ping event for the mission Lose Weak Focus
character_event = {
	id = iwitch.20
	hide_window = yes

	is_triggered_only = yes

	immediate = { FROM = { society_quest_event = { id = iwitch.21 days = 7 random = 7 } } }
}

#Assign event
society_quest_event = {
	id = iwitch.21
	desc = {
		trigger = {
			ROOT = {
				has_character_flag = flag_renounce_focus_for_war
			}
		}
		text = EVTDESCAHF25505
	}
	desc = {
		trigger = {
			ROOT = {
				has_character_flag = flag_renounce_focus_for_hunting
			}
		}
		text = EVTDESCBHF25505
	}
	desc = {
		trigger = {
			ROOT = {
				has_character_flag = flag_renounce_focus_for_rulership
			}
		}
		text = EVTDESCCHF25505
	}
	desc = {
		trigger = {
			ROOT = {
				has_character_flag = flag_renounce_focus_for_carousing
			}
		}
		text = EVTDESCDHF25505
	}

	is_triggered_only = yes
	is_in_society = yes
	only_capable = yes

	trigger = {
		is_member_of_any_warrior_lodge_trigger = yes
		same_society_as = FROM
		has_any_quest = no
		NOT = { has_character_modifier = quest_cooldown_timer }
		NOT = { is_inaccessible_trigger = yes }
		has_dlc = "Way of Life"
		is_landed = yes
		NOR = {
			has_focus = focus_war
			has_focus = focus_hunting
			has_focus = focus_carousing
			has_focus = focus_rulership
		}
	}

	immediate = {
		random_list = {
			25 = { set_character_flag = flag_renounce_focus_for_war }
			25 = { set_character_flag = flag_renounce_focus_for_hunting }
			25 = { set_character_flag = flag_renounce_focus_for_rulership }
			25 = { set_character_flag = flag_renounce_focus_for_carousing }
		}
	}

	quest_target = ROOT

	option = {
		name = ACCEPT
		ROOT = {
			show_scope_change = no
			if = {
				limit = { has_character_flag = flag_renounce_focus_for_war }
				set_quest_target = {
					id = quest_warband_weak_focus_to_war
					holder = ROOT
				}
			}
			if = {
				limit = { has_character_flag = flag_renounce_focus_for_hunting }
				set_quest_target = {
					id = quest_warband_weak_focus_to_hunting
					holder = ROOT
				}
			}
			if = {
				limit = { has_character_flag = flag_renounce_focus_for_rulership }
				set_quest_target = {
					id = quest_warband_weak_focus_to_rulership
					holder = ROOT
				}
			}
			if = {
				limit = { has_character_flag = flag_renounce_focus_for_carousing }
				set_quest_target = {
					id = quest_warband_weak_focus_to_carousing
					holder = ROOT
				}
			}
		}
	}
	option  = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}
	after = {
		hidden_effect = { #For the one who instantly selected the focus, bypassing the mission-trigger
			trigger_switch = {
				on_trigger = has_character_flag
				flag_renounce_focus_for_war = {
					if = {
						limit = { has_focus = focus_war }
						character_event = { id = iwitch.22 days = 1 }
					}
				}
				flag_renounce_focus_for_hunting = {
					if = {
						limit = { has_focus = focus_hunting }
						character_event = { id = iwitch.23 days = 1 }
					}
				}
				flag_renounce_focus_for_rulership = {
					if = {
						limit = { has_focus = focus_rulership }
						character_event = { id = iwitch.24 days = 1 }
					}
				}
				flag_renounce_focus_for_carousing = {
					if = {
						limit = { has_focus = focus_carousing }
						character_event = { id = iwitch.25 days = 1 }
					}
				}
			}
		}

		clr_character_flag = flag_renounce_focus_for_war
		clr_character_flag = flag_renounce_focus_for_hunting
		clr_character_flag = flag_renounce_focus_for_rulership
		clr_character_flag = flag_renounce_focus_for_carousing
	}
}
#on_focus_selected: Changing to War focus.
character_event = {
	id = iwitch.22
	desc = EVTDESCAHF25506
	picture = GFX_evt_vikings_arriving_oldgods
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	trigger = {
		is_member_of_any_warrior_lodge_trigger = yes
		has_quest = quest_warband_weak_focus_to_war
		has_focus = focus_war
	}

	option = {
		name = EVTOPTAHF25506
		clr_quest = quest_warband_weak_focus_to_war
		add_society_currency_minor_effect = yes
		add_legend_progress_trivial_effect = yes
	}
}
#on_focus_selected: Changing to Hunting focus.
character_event = {
	id = iwitch.23
	desc = EVTDESCAHF25507
	picture = GFX_evt_mysterious_forest
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	trigger = {
		is_member_of_any_warrior_lodge_trigger = yes
		has_quest = quest_warband_weak_focus_to_hunting
		has_focus = focus_hunting
	}

	option = {
		name = EVTOPTAHF25507
		clr_quest = quest_warband_weak_focus_to_hunting
		add_society_currency_minor_effect = yes
		add_legend_progress_trivial_effect = yes
	}
}
#on_focus_selected: Changing to Rulership focus.
character_event = {
	id = iwitch.24
	desc = EVTDESCAHF25508
	picture = GFX_evt_tengri_throneroom_oldgods
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	trigger = {
		is_member_of_any_warrior_lodge_trigger = yes
		has_quest = quest_warband_weak_focus_to_rulership
		has_focus = focus_rulership
	}

	option = {
		name = EVTOPTAHF25508
		clr_quest = quest_warband_weak_focus_to_rulership
		add_society_currency_minor_effect = yes
		add_legend_progress_trivial_effect = yes
	}
}
#on_focus_selected: Changing to Carousing focus.
character_event = {
	id = iwitch.25
	desc = EVTDESCAHF25509
	picture = GFX_evt_camaraderie
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	trigger = {
		is_member_of_any_warrior_lodge_trigger = yes
		has_quest = quest_warband_weak_focus_to_carousing
		has_focus = focus_carousing
	}

	option = {
		name = EVTOPTAHF25509
		clr_quest = quest_warband_weak_focus_to_carousing
		add_society_currency_minor_effect = yes
		add_legend_progress_trivial_effect = yes
	}
}
character_event = {
	id = iwitch.26
	hide_window = yes
	religion_group = old_world_group
	is_triggered_only = yes
	only_women=yes
	trigger = {
		FROM = { title = d_frosthome_lodge }
		FROMFROM={trait=ice_witch}
	}
	immediate={
		ROOT={
			if={
				limit={
					NOR={
						society_member_of=ice_witch_sisterhood
						trait=ice_witch
					}
				}
				add_trait=ice_witch
				add_trait=lore_ice
				magic_power_teach_effect=yes
				enable_magic_xp_effect=yes
				add_trait=ice_witch
				add_trait=lore_ice
				change_diplomacy=2
				change_learning=2
				join_society=ice_witch_sisterhood
				society_rank_up={
					society=ice_witch_sisterhood
					rank=2
				}
			}
		}
	}
	option = {
		name = OK
	}
}

### Maintenance: Rank up event (AI only)
character_event = {
    id = iwitch.50
    hide_window = yes
    is_triggered_only = yes
    has_dlc = "Holy Fury"
    ai = yes

	is_in_society = yes

    trigger = {
		society_member_of = ice_witch_sisterhood
		is_inaccessible_or_incapable_trigger = no
		society_can_rank_up = yes
		has_society_currency_minor_trigger = yes
    }

    immediate = {
        society = {
            save_event_target_as = my_warrior_lodge
        }
        random_list = {
            50 = {}
            50 = {
                trigger = {
                    society_rank < 3
                }
                society_rank_up = 1
                detract_society_currency_medium_effect = yes # at a worst, they are put at 0 currency
            }
            500 = {
                trigger = {
                    society_rank == 3
                    NOT = {
                        is_society_rank_full = { # Checks if named society's rank is full
                            society = event_target:my_warrior_lodge
                            rank = 4
                        }
                    }
                }
                society_rank_up = 1
                detract_society_currency_medium_effect = yes # at a worst, they are put at 0 currency
            }
        }
    }
}
#end_mission_tombola}
