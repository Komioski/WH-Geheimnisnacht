### Event chain for Chinese Kow Tow ###

namespace = JD_BRAY
###Pilgrimage
character_event = {	#I begin my journey...
	id = JD_BRAY.1
	desc = EVTDESC_JD_BRAY_32000
	has_dlc = "Jade Dragon"

	title = EVTTITLE_BRAY_PILGRIMAGE

	picture = GFX_evt_beastman_chief
    border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_JD_BRAY_32000
		add_trait = travelling

		hidden_tooltip = {
			character_event = { id = JD_BRAY.2 }
		}
	}
}

character_event = { #Hidden set-up event!
	id = JD_BRAY.2
	has_dlc = "Jade Dragon"
	hide_window = yes


	trigger = {
		trait = travelling
	}

	is_triggered_only = yes

	immediate = {
		# Take distance into account for delay
		# 1513 = Jiuquan on the Eastern border
		capital_scope = {
			if = { # Near the far east
				limit = {
					distance = {
						where = 222
						value < 500
					}
				}
				ROOT = {
					set_variable = {
						which = cathay_kow_tow_travel_events
						value = 2
					}
				}
			}
			else_if = { # Still on the eastern side of the map
				limit = {
					distance = {
						where = 222
						value < 900
					}
				}
				ROOT = {
					set_variable = {
						which = cathay_kow_tow_travel_events
						value = 3
					}
				}
			}
		}
		character_event = {
			id = JD_BRAY.3 # random travel event tombola
			days = 90
			random = 30
		}
	}
}

character_event = { # Travel Tombola
	id = JD_BRAY.3
	has_dlc = "Jade Dragon"
	hide_window = yes

	trigger = {
		trait = travelling
	}

	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				NOT = {
					check_variable = {
						which = cathay_kow_tow_travel_events
						value = 1
					}
				}
			}
			### No more travel events - Move on to entering Cathay
			character_event = { id = JD_BRAY.9 days = 50 random = 30 }
			break = yes
		}

		# Fire a random travel event
		random_list = {
			50 = { # Unusually heavy rain, think of late parents.
				trigger = {
					NOT = { has_character_flag = kow_tow_heavy_rain }
				}
				character_event = {
					id = JD_BRAY.4
				}
				break = yes
			}
			50 = { # Jabberslythe Hunt
				trigger = {
					NOT = { has_character_flag = hunted_jabberslythe }
				}
				character_event = {
					id = JD_BRAY.25
				}
				break = yes
			}
			50 = {
				character_event = { id = JD_BRAY.19 }  # Homesick (I really miss <person>)
				trigger = {
					NOT = { has_character_flag = missed_loved_one }
					any_courtier_or_vassal = {
						OR = {
							is_lover = ROOT
							any_spouse = { character = ROOT }
							AND = {
								OR = {
									is_mother = ROOT
									is_father = ROOT
								}
								NOR = {
									is_lover = ROOT
									any_spouse = { character = ROOT }
								}
							}
							AND = {
								is_child_of = ROOT
								NOR = {
									is_lover = ROOT
									any_spouse = { character = ROOT }
								}
							}
							AND = {
								is_friend = ROOT
								NOR = {
									is_lover = ROOT
									any_spouse = { character = ROOT }
									is_mother = ROOT
									is_father = ROOT
									is_child_of = ROOT
								}
							}
						}
					}
				}
				break = yes
			}
			50 = {
				character_event = { id = JD_BRAY.23 }  # Meet traveling merchant
				trigger = {
					NOT = { has_character_flag = met_traveling_merchant }
					NOT = {
						any_artifact = {
							count = 6
							has_artifact_flag = beastman
						}
					}
				}
				break = yes
			}
			50 = { # Messenger invites you to the Lords keep, travel time > 1 # Messenger invites you to feast in Nearby Warherd's Camp
				trigger = {
					NOT = { has_character_flag = kow_tow_invited_by_local_lord }
					OR = {
						AND = {
							NOT = {
								check_variable = {
									which = cathay_kow_tow_travel_events
									value = 1
								}
							}
							capital_scope = {
								distance = {
									where = 222
									value >= 900
								}
							}
						}
						AND = {
							NOT = {
								check_variable = {
									which = cathay_kow_tow_travel_events
									value = 2
								}
							}
							capital_scope = {
								distance = {
									where = 222
									value >= 1500
								}
							}
						}
					}
					any_playable_ruler = {
						ai = yes
						government = beastman_government
						higher_tier_than = DUKE
						capital_scope = {
							OR={
							region = world_old_world
							region = world_norsca
							region = world_troll_country
							}
						}
						NOT = {
							num_of_friends = 3
						}
						NOT = { block_general_event_trigger = yes }
					}
				}
				character_event = {
					id = JD_BRAY.5
				}
				break = yes
			}
		}
		### No more possible travel events - Continue to Cathay anyway with extra delay
		character_event = { id = JD_BRAY.9 days = 150 random = 60 }
	}
}

character_event = {  # Unusually heavy rain, think of late parents.
	id = JD_BRAY.4
	has_dlc = "Jade Dragon"

	title = EVTTITLE_BRAY_PILGRIMAGE

	desc = EVTDESC_JD_32100
	picture = GFX_evt_carriage_default
    border = GFX_event_normal_frame_diplomacy


	trigger = {
		trait = travelling
	}

	hide_from = yes

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			set_character_flag = kow_tow_heavy_rain
			random_list = {
				50 = {
					trigger = {
						father_even_if_dead = {
							NOT = { is_alive = yes }
							death_in_cathay_trigger = no
						}
					}
					father_even_if_dead = {
						save_event_target_as = target_relative
					}
				}
				50 = {
					trigger = {
						mother_even_if_dead = {
							NOT = { is_alive = yes }
							death_in_cathay_trigger = no
						}
					}
					mother_even_if_dead = {
						save_event_target_as = target_relative
					}
				}
				50 = {
					trigger = {
						any_sibling_even_if_dead = {
							NOT = { is_alive = yes }
							death_in_cathay_trigger = no
						}
					}
					random_sibling_even_if_dead = {
						limit = {
							NOT = { is_alive = yes }
							death_in_cathay_trigger = no
						}
						save_event_target_as = target_relative
					}
				}
			}
		}
	}

	option = {
		# <Name> was such a X person
		name = {
			text = EVTOPTA_JD_32100_young
			trigger = {
				event_target:target_relative = {
					NOT = { is_adult = yes }
				}
			}
		}
		name = {
			text = EVTOPTA_JD_32100_pious
			trigger = {
				event_target:target_relative = {
					is_pious_trigger = yes
				}
			}
		}
		name = {
			text = EVTOPTA_JD_32100_genius
			trigger = {
				event_target:target_relative = {
					trait = genius
				}
			}
		}
		name = {
			text = EVTOPTA_JD_32100_mystic
			trigger = {
				event_target:target_relative = {
					trait = mystic
				}
			}
		}
		name = {
			text = EVTOPTA_JD_32100_brave
			trigger = {
				event_target:target_relative = {
					OR = {
						trait = brave
						AND = {
							NOT = { trait = craven }
							OR = {
								trait = holy_warrior
								trait = unyielding_leader
								trait = inspiring_leader
								trait = experimenter
							}
						}
					}
				}
			}
		}
		name = {
			text = EVTOPTA_JD_32100_charming
			trigger = {
				event_target:target_relative = {
					is_attractive_trigger = yes
				}
			}
		}
		name = {
			text = EVTOPTA_JD_32100_just
			trigger = {
				event_target:target_relative = {
					trait = just
				}
			}
		}
		name = {
			text = EVTOPTA_JD_32100_kind
			trigger = {
				event_target:target_relative = {
					has_benevolent_trait_trigger = yes
				}
			}
		}
		name = {
			text = EVTOPTA_JD_32100_cruel
			trigger = {
				event_target:target_relative = {
					OR = {
						trait = cruel
						trait = impaler
						trait = greedy
						trait = wroth
						trait = deceitful
						trait = lunatic_1
						trait = lunatic_2
						trait = lunatic_3
						trait = possessed
					}
				}
			}
		}
		name = {
			text = EVTOPTA_JD_32100_learned
			trigger = {
				event_target:target_relative = {
					is_learned_trigger = yes
				}
			}
		}
		name = {
			text = EVTOPTA_JD_32100_good ### Fallback
			trigger = {
				always = yes
			}
		}
		event_target:target_relative = {
			show_portrait = yes
		}
		#show_portrait = event_target:target_relative
		###
		custom_tooltip = {
			text = EVTTOOLTIPA_JD_32100
		}
		add_character_modifier = {
			name = honoring_the_dead
			years = 5
		}
	}

	option = {
		name = EVTOPTB_JD_32100 # I need to focus on the journey

		add_character_modifier = {
			name = carrying_on
			years = 2
		}
	}

	after = {
		return_to_travel_brayherd_tombola_effect = yes
	}
}

character_event = { # Messenger invites you to the Lords keep, travel time > 2
	id = JD_BRAY.5
	has_dlc = "Jade Dragon"

	title = EVTTITLE_BRAY_PILGRIMAGE

	desc = EVTDESC_JD_BRAY_5
	picture = GFX_evt_beastman_chief
    border = GFX_event_normal_frame_diplomacy


	trigger = {
		trait = travelling
	}

	is_triggered_only = yes

	portrait = event_target:target_host

	immediate = {
		set_character_flag = kow_tow_invited_by_local_lord
		random_playable_ruler = {
			limit = {
				ai = yes
				government = beastman_government
				OR = {
					tier = KING
					tier = EMPEROR
				}
				capital_scope = {
					OR={
						region = world_old_world
						region = world_norsca
						region = world_troll_country
					}
				}
				NOT = {
					num_of_friends = 3
				}
				NOT = { block_general_event_trigger = yes }
			}
			save_event_target_as = target_host
		}

		# Bias towards rivals
		random_playable_ruler = {
			limit = {
				ai = yes
				government = beastman_government
				OR = {
					tier = KING
					tier = EMPEROR
				}
				capital_scope = {
					OR={
						region = world_old_world
						region = world_norsca
						region = world_troll_country
					}
				}
				NOT = { block_general_event_trigger = yes }
				is_rival = ROOT
			}
			save_event_target_as = target_host
		}
	}

	option = { # An opportunity to get even
		name = EVTOPTA_JD_BRAY_5
		tooltip_info = schemer

		trigger = {
			trait = schemer
			event_target:target_host = {
				is_rival = ROOT
			}
		}
		custom_tooltip = {
			text = EVTTTOOLTIPA_JD_BRAY_5
		}

		character_event = {
			id = JD_BRAY.8
			days = 7
			random = 4
		}
	}

	option = { # I'll accept the invitation
		name = {
			text = EVTOPTB_JD_BRAY_5
			trigger = {
				NOT = {
					event_target:target_host = {
						is_rival = ROOT
					}
				}
			}
		}
		name = {
			text = EVTOPTB_JD_BRAY_5_RIVAL
			trigger = {
				event_target:target_host = {
					is_rival = ROOT
				}
			}
		}

		custom_tooltip = {
			text = EVTTTOOLTIPB_JD_BRAY_5
		}
		character_event = {
			id = JD_BRAY.6
			days = 7
			random = 4
		}
	}

	option = { # My tent does fine
		name = EVTOPTC_JD_BRAY_5

		random_list = {
			25 = {
				add_trait = content
			}
			25 = {
				add_trait = shy
			}
			25 = {
				add_trait = paranoid
			}
			25 = {
				# Nothing happens
			}
		}

		hidden_effect = { # End of path
			return_to_travel_brayherd_tombola_effect = yes
		}
	}
}

character_event = { #Follow up from accepting the invitation
	id = JD_BRAY.6
	has_dlc = "Jade Dragon"

	title = EVTTITLE_BRAY_PILGRIMAGE

	desc = { # Normal outcome
		text = EVTDESCA_JD_BRAY_6
		trigger = {
			NOR = {
				has_character_flag = possible_friendship
				has_character_flag = possible_murder
			}
		}
	}
	desc = { # Friendship outcome
		text = EVTDESCB_JD_BRAY_6
		trigger = {
			has_character_flag = possible_friendship
		}
	}
	desc = { # Murder attempt outcome
		text = EVTDESCC_JD_BRAY_6
		trigger = {
			has_character_flag = possible_murder
		}
	}
	picture = GFX_evt_beastman_chief
    border = GFX_event_normal_frame_diplomacy

	portrait = event_target:target_host

	is_triggered_only = yes


	trigger = {
		trait = travelling
	}

	immediate = {
		hidden_effect = {
			random_list = {
				50 = { # Friendship outcome
					trigger = {
						NOT = {
							event_target:target_host = {
								OR = {
									is_rival = ROOT
									is_friend = ROOT
								}
							}
						}
					}
					set_character_flag = possible_friendship
				}
				25 = { # Murder attempt outcome
					trigger = {
						event_target:target_host = {
							is_rival = ROOT
						}
					}
					modifier = {
						factor = 8
						event_target:target_host = {
							trait = deceitful
						}
					}
					set_character_flag = possible_murder
				}
				50 = {} # Normal outcome
			}
		}
	}

	option = {
		name = EVTOPTA_JD_BRAY_6 # Normal outcome

		trigger = {
			NOR = {
				has_character_flag = possible_friendship
				has_character_flag = possible_murder
			}
		}

		add_character_modifier = {
			modifier = good_nights_sleep
			months = 12
		}
		if = {
			limit = {
				is_rival = event_target:target_host
			}
			remove_rival = event_target:target_host
		}
	}

	option = {
		name = EVTOPTB_JD_BRAY_6 # Friendship outcome

		trigger = {
			has_character_flag = possible_friendship
		}

		add_character_modifier = {
			modifier = good_nights_sleep
			months = 5
		}
		add_friend = event_target:target_host
	}

	option = {
		name = EVTOPTC_JD_BRAY_6 # Friendship deny

		trigger = {
			has_character_flag = possible_friendship
		}

		add_character_modifier = {
			modifier = good_nights_sleep
			months = 5
		}
	}

	option = {
		name = EVTOPTD_JD_BRAY_6

		trigger = {
			has_character_flag = possible_murder
		}

		random_list = {
			50 = {
				if = {
					limit = {
						is_invincible_trigger = yes
					}
					antideath_effect = yes
					break = yes
				}
				death = {
					death_reason = death_murder_poison
					killer = event_target:target_host
				}
			}
			50 = {
				custom_tooltip = {
					text = EVTTOOLTIPD_JD_BRAY_6
				}
				character_event = { id = JD_BRAY.7 }
			}
		}
	}

	after = {
		clr_character_flag = possible_murder
		clr_character_flag = possible_friendship
		return_to_travel_brayherd_tombola_effect = yes
	}
}

character_event = { #Follow up from option D
	id = JD_BRAY.7
	has_dlc = "Jade Dragon"

	title = EVTTITLE_BRAY_PILGRIMAGE

	desc = EVTDESC_JD_BRAY_7
	picture = GFX_evt_drunk
    border = GFX_event_normal_frame_diplomacy

	portrait = event_target:target_host

	is_triggered_only = yes


	trigger = {
		trait = travelling
	}

	option = {
		name = EVTOPTA_JD_BRAY_7
		if = {
			limit = {
				has_dlc = "Reapers"
			}
			give_food_poisoning_effect = yes
			custom_tooltip = { text = EVTTTOOLTIPA_JD_BRAY_7 }
		}
		else = {
			add_character_modifier = {
				modifier = poisoned
				months = 6
			}
		}
	}
}

narrative_event = { #Follow up from option A
	id = JD_BRAY.8
	has_dlc = "Jade Dragon"

	title = EVTTITLE_JD_32113
	desc = {
		text = EVTDESCA_JD_32113
		trigger = {
			has_character_flag = successful_murder
		}
	}
	desc = {
		text = EVTDESCB_JD_32113
		trigger = {
			has_character_flag = successful_murder_but_caught
		}
	}
	desc = {
		text = EVTDESCC_JD_32113
		trigger = {
			NOR = {
				has_character_flag = successful_murder
				has_character_flag = successful_murder_but_caught
			}
		}
	}
	#picture = GFX_evt_feast
    border = GFX_event_narrative_frame_intrigue

	portrait = event_target:target_host


	trigger = {
		trait = travelling
	}

	is_triggered_only = yes

	immediate = {
		random_list = {
			15 = { # Target dies while you slip away in the shadows
				modifier = {
					factor = 3
					intrigue = 18
				}
				modifier = {
					factor = 2
					trait = elusive_shadow
				}

				set_character_flag = successful_murder
			}
			30 = { # Target dies, guards kill you
				set_character_flag = successful_murder_but_caught
			}
			30 = { # Target survives, guards kill you
				modifier = {
					factor = 0.6
					intrigue = 16
				}
				modifier = {
					factor = 0.5
					event_target:target_host = {
						trait = trusting
					}
				}
				modifier = {
					factor = 3
					event_target:target_host = {
						intrigue = 14
					}
				}
				modifier = {
					factor = 1.5
					event_target:target_host = {
						trait = paranoid
					}
				}
			}
		}
	}

	option = {
		name = EVTOPTA_JD_32113
		trigger = {
			has_character_flag = successful_murder
		}
		event_target:target_host = {
			if = {
				limit = {
					is_invincible_trigger = yes
				}
				antideath_effect = yes
				break = yes
			}
			death = {
				death_reason = death_murder_poison
				killer = ROOT
			}
		}
		change_intrigue = 1

		return_to_travel_brayherd_tombola_effect = yes
	}
	option = {
		name = EVTOPTB_JD_32113
		trigger = {
			has_character_flag = successful_murder_but_caught
		}

		event_target:target_host = {
			if = {
				limit = {
					is_invincible_trigger = yes
				}
				antideath_effect = yes
				break = yes
			}
			death = {
				death_reason = death_murder_poison
				killer = ROOT
			}
		}
		if = {
			limit = {
				is_invincible_trigger = yes
			}
			antideath_effect = yes
			break = yes
		}
		death = {
			death_reason = death_murder
			killer = event_target:target_host
		}
	}
	option = {
		name = EVTOPTC_JD_32113
		trigger = {
			NOR = {
				has_character_flag = successful_murder
				has_character_flag = successful_murder_but_caught
			}
		}
		if = {
			limit = {
				is_invincible_trigger = yes
			}
			antideath_effect = yes
			break = yes
		}
		death = {
			death_reason = death_murder
			killer = event_target:target_host
		}
	}

	after = {
		clr_character_flag = successful_murder
		clr_character_flag = successful_murder_but_caught
	}
}

character_event = { # Enter Cathay, choose path
	id = JD_BRAY.9
	has_dlc = "Jade Dragon"

	title = EVTTITLE_BRAY_PILGRIMAGE
	desc = EVTDESC_JD_BRAY_32200

	picture = GFX_evt_beastmen_mist
    border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes


	trigger = {
		trait = travelling
	}

	immediate = {

	}

	option = { # Kow Tow before the Emperor
		name = EVTOPTA_JD_BRAY_32200
		# Actually Kow Tow
		# custom_tooltip = {
			#text = EVTTOOLTIPA_JD_BRAY_32200
			#set_character_flag = kow_tow_actually
		#}
	}

	after = {
		hidden_tooltip = {
			set_variable = {
				which = cathay_kow_tow_travel_events
				value = 2
			}
			character_event = {
				id = JD_BRAY.10
				days = 40
				random = 25
			}
		}
	}
}

character_event = { # Within Heart of The Dark Tombola
	id = JD_BRAY.10
	has_dlc = "Jade Dragon"
	hide_window = yes

	is_triggered_only = yes


	trigger = {
		trait = travelling
	}

	immediate = {
		if = {
			limit = {
				NOT = {
					check_variable = {
						which = cathay_kow_tow_travel_events
						value = 1
					}
				}
			}
			### No more travel events - Move on to Cathay conclusion
			character_event = { id = JD_BRAY.13 days = 50 random = 30 }
			break = yes
		}

		# Fire a random travel event
		random_list = {
			50 = { # Visit The Great Herdstone
				trigger = {
					NOT = { has_character_flag = kow_tow_visited_temple }
				}
				character_event = {
					id = JD_BRAY.12
				}
				break = yes
			}
			50 = { # Arena Duel
				trigger = {
					NOT = { has_character_flag = fought_in_heart_of_dark }
				}
				modifier = {
					factor = 2
					trait = duelist
				}
				character_event = {
					id = JD_BRAY.11
				}
				break = yes
			}
			50 = {  # Visit the markets
				trigger = { NOT = { has_character_flag = visited_market } }
				character_event = { id = JD_BRAY.22 }
			}
		}
	}
}

# You spot a group of people playing GO in the park
character_event = {
	id = JD_BRAY.11
	has_dlc = "Jade Dragon"

	title = EVTTITLE_BRAY_PILGRIMAGE
	desc = EVTDESC_JD_BRAY_32211

	picture = GFX_evt_beastmen_charge
    border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes


	trigger = {
		trait = travelling
	}

	immediate = {
		set_character_flag = fought_in_heart_of_dark
	}

	option = { # Let me show you how it's done
		name = EVTOPTA_JD_BRAY_32211
		trigger = {
			trait = duelist
		}
		tooltip_info = duelist

		wealth = 50
		if = {
			limit = {
				NOT = { trait = proud }
			}
			add_trait = proud
		}
		random_list = {
			50 = {
				add_character_modifier  = {
					name = hardened_resolve
					months = 24
				}
			}
			50 = {
				add_character_modifier  = {
					name = sore_muscles
					months = 5
				}
			}
		}
		custom_tooltip = {
			text = EVTTOOLTIP_JD_BRAY_GOOD_INFLUENCE_ON_EMPEROR_EVALUATION
			hidden_effect = {
				change_variable = {
					which = kow_tow_emperor_impression_evaluation
					value = 2
				}
			}
		}
	}

	option = { # Let me try that
		name = EVTOPTB_JD_BRAY_32211
		trigger = {
			NOT = {
				trait = duelist
			}
		}

		random_list = {
			25 = {
				wealth = 25
				add_character_modifier  = {
					name = hardened_resolve
					months = 12
				}
			}
			25 = {
				wealth = -10
				add_character_modifier  = {
					name = sore_muscles
					months = 3
				}
			}
			25 = {
				wealth = -10
				add_character_modifier  = {
					name = cracked_ribs
					months = 3
				}
			}
			25 = {
				add_trait=wounded
			}
		}
		custom_tooltip = {
			text = EVTTOOLTIP_JD_BRAY_GOOD_INFLUENCE_ON_EMPEROR_EVALUATION
			hidden_effect = {
				change_variable = {
					which = kow_tow_emperor_impression_evaluation
					value = 2
				}
			}
		}
	}

	option = {
		name = EVTOPTC_JD_BRAY_32211 # I'll just Watch the Fights instead

		random_list = {
			50 = {
				#Nothing
			}
			20 = {
				add_trait = humble
				wealth = -5
			}
			20 = {
				add_trait = greedy
				wealth = 5
			}
			10 = {
				add_trait = gambler
				wealth = 10
			}
		}
	}

	after = {
		return_to_heart_tombola_effect = yes
	}
}

# You visit a local temple
character_event = {
	id = JD_BRAY.12
	has_dlc = "Jade Dragon"

	title = EVTTITLE_BRAY_PILGRIMAGE
	desc = EVTDESC_JD_BRAY_32216

	picture = GFX_evt_china_diplomatic_incident #Brayshaman
    border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes


	trigger = {
		trait = travelling
	}

	immediate = {
		set_character_flag = kow_tow_visited_temple
	}

	option = { # Join in the ceremony
		name = EVTOPTB_JD_BRAY_32216

		if = {
			limit = {
				NOT={trait = cynical}
			}
			random = {
				chance = 20
				add_trait = cynical
			}
            random_list = {
				10 = {
					add_trait = lore_nurgle
					religion = nurgle
				}
				10 = {
					add_trait = lore_slaanesh
					religion = slaanesh
				}
				10 = {
					add_trait = lore_tzeentch
					religion = tzeentch
				}
				10 = {
					religion = khorne
				}
				60 = {
				}
			}
		}
		random = {
			chance = 30
			add_trait = content
		}
		custom_tooltip = {
			text = EVTTOOLTIP_JD_BRAY_GOOD_INFLUENCE_ON_EMPEROR_EVALUATION
			hidden_effect = {
				change_variable = {
					which = kow_tow_emperor_impression_evaluation
					value = 3
				}
			}
		}
	}

	option = { # Loudly criticize their heathen ways
		name = EVTOPTC_JD_BRAY_32216
		trigger = {
			religion = chaos
		}
		random = {
			chance = 20
			add_trait = zealous
		}
		piety = 30
		custom_tooltip = {
			text = EVTTOOLTIP_JD_BRAY_BAD_INFLUENCE_ON_EMPEROR_EVALUATION
			hidden_effect = {
				subtract_variable = {
					which = kow_tow_emperor_impression_evaluation
					value = 5
				}
			}
		}
	}

	option = { # Study the symbolism used in their texts.
		name = EVTOPTD_JD_BRAY_32216
		random = {
			chance = 20
			change_learning = 1
		}
	}

	after = {
		return_to_heart_tombola_effect = yes
	}
}

character_event = { # audience w/ the Emperor
	id = JD_BRAY.13
	has_dlc = "Jade Dragon"

	title = EVTTITLE_BRAY_PILGRIMAGE
	desc = EVTDESCA_JD_BRAY_32290
	picture = GFX_evt_beastmen_herdstone #Herdstone

    border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes


	trigger = {
		trait = travelling
	}

	immediate = {
		export_to_variable = {
			which = kow_tow_temp_calc
			value = diplomacy
		}
		divide_variable = {
			which = kow_tow_temp_calc
			value = 2
		}
		change_variable = {
			which = kow_tow_emperor_impression_evaluation
			which = kow_tow_temp_calc
		}
		set_variable = { # Clearing it for save game memory optimization
			which = kow_tow_temp_calc
			value = 0
		}
		if = {
			limit = {
				real_tier = KING
			}
			change_variable = {
				which = kow_tow_emperor_impression_evaluation
				value = 5
			}
		}
		else_if = {
			limit = {
				real_tier = EMPEROR
			}
			change_variable = {
				which = kow_tow_emperor_impression_evaluation
				value = 7
			}
		}

		if = {
			limit = {
				disliked_by_offmap = {
					type = brayherd_warp
				}
			}
			subtract_variable = {
				which = kow_tow_emperor_impression_evaluation
				value = 5
			}
		}
		else_if = {
			limit = {
				liked_by_offmap = {
					type = brayherd_warp
				}
			}
			change_variable = {
				which = kow_tow_emperor_impression_evaluation
				value = 5
			}
		}

		random_list = {
			45 = { # Bad outcome
				set_character_flag = kow_tow_bad_outcome
				trigger = {
					NOT = {
						check_variable = {
							which = kow_tow_emperor_impression_evaluation
							value = 23
						}
					}
				}
				modifier = {
					factor = 0.85
					check_variable = {
						which = kow_tow_emperor_impression_evaluation
						value = 12
					}
				}
				modifier = {
					factor = 0.85
					check_variable = {
						which = kow_tow_emperor_impression_evaluation
						value = 13
					}
				}
				modifier = {
					factor = 0.85
					check_variable = {
						which = kow_tow_emperor_impression_evaluation
						value = 14
					}
				}
				modifier = {
					factor = 0.85
					check_variable = {
						which = kow_tow_emperor_impression_evaluation
						value = 15
					}
				}
				modifier = {
					factor = 0.85
					check_variable = {
						which = kow_tow_emperor_impression_evaluation
						value = 17
					}
				}
				modifier = {
					factor = 0.85
					check_variable = {
						which = kow_tow_emperor_impression_evaluation
						value = 19
					}
				}
				modifier = {
					factor = 0.85
					check_variable = {
						which = kow_tow_emperor_impression_evaluation
						value = 21
					}
				}
			}
			45 = { # Okay outcome
				set_character_flag = kow_tow_okay_outcome
			}
			10 = { # Great outcome
				set_character_flag = kow_tow_great_outcome
				trigger = {
					check_variable = {
						which = kow_tow_emperor_impression_evaluation
						value = 10
					}
				}
				modifier = {
					factor = 1.1
					check_variable = {
						which = kow_tow_emperor_impression_evaluation
						value = 12
					}
				}
				modifier = {
					factor = 1.1
					check_variable = {
						which = kow_tow_emperor_impression_evaluation
						value = 12
					}
				}
				modifier = {
					factor = 1.1
					check_variable = {
						which = kow_tow_emperor_impression_evaluation
						value = 13
					}
				}
				modifier = {
					factor = 1.1
					check_variable = {
						which = kow_tow_emperor_impression_evaluation
						value = 14
					}
				}
				modifier = {
					factor = 1.1
					check_variable = {
						which = kow_tow_emperor_impression_evaluation
						value = 15
					}
				}
				modifier = {
					factor = 1.1
					check_variable = {
						which = kow_tow_emperor_impression_evaluation
						value = 17
					}
				}
				modifier = {
					factor = 1.1
					check_variable = {
						which = kow_tow_emperor_impression_evaluation
						value = 19
					}
				}
				modifier = {
					factor = 1.1
					check_variable = {
						which = kow_tow_emperor_impression_evaluation
						value = 21
					}
				}
				modifier = {
					factor = 1.1
					check_variable = {
						which = kow_tow_emperor_impression_evaluation
						value = 23
					}
				}
				modifier = {
					factor = 1.1
					check_variable = {
						which = kow_tow_emperor_impression_evaluation
						value = 25
					}
				}
				modifier = {
					factor = 1.1
					check_variable = {
						which = kow_tow_emperor_impression_evaluation
						value = 27
					}
				}
				modifier = {
					factor = 1.1
					check_variable = {
						which = kow_tow_emperor_impression_evaluation
						value = 29
					}
				}
			}
		}
	}

	option = {
		name = EVTOPTA_JD_BRAY_32290 # Perform kow-tow before the Emperor
		trigger = {
			has_character_flag = kow_tow_bad_outcome
		}
		remove_trait = travelling
		#add_trait = kow_tow_completed_tier_1
		set_character_flag=did_pilgrimage
		add_offmap_currency = {
			offmap = brayherd_warp
			value = 100
		}
		trigger_switch = {
			on_trigger = real_tier
			EMPEROR = { prestige = -1000 }
			KING = { prestige = -500 }
			fallback = { prestige = -100 }
		}
	}

	option = {
		name = EVTOPTB_JD_BRAY_32290 # Refuse the humiliation
		trigger = {
			has_character_flag = kow_tow_bad_outcome
		}
		remove_trait = travelling
		set_character_flag=did_pilgrimage
	}

	option = {
		name = EVTOPTC_JD_BRAY_32290 # Perform kow-tow before the Emperor
		trigger = {
			has_character_flag = kow_tow_okay_outcome
		}
		remove_trait = travelling
		set_character_flag=did_pilgrimage
		add_offmap_currency = {
			offmap = brayherd_warp
			value = 150
		}
			trigger_switch = {
				on_trigger = real_tier
				KING = {
					prestige = -400
					piety = 250
					martial = 1
					health=0.5
				}
				EMPEROR = {
					prestige = -750
					piety = 250
					martial = 1
					health=0.5
				}
			}
	}

	option = {
		name = EVTOPTD_JD_BRAY_32290 # Perform kow-tow before the Emperor
		trigger = {
			has_character_flag = kow_tow_great_outcome
		}
		#add_trait = kow_tow_completed_tier_3
		remove_trait = travelling
		set_character_flag=did_pilgrimage
		add_offmap_currency = {
			offmap = brayherd_warp
			value = 300
		}
		trigger_switch = {
			on_trigger = real_tier
			KING = {
				prestige = -500
				piety = 300
				martial=2
				health=1
			}
			EMPEROR = {
				prestige = -750
				piety = 300
				martial=2
				health=1
			}
		}
	}

	after = {
		clr_character_flag = do_not_disturb
		clr_character_flag = kow_tow_bad_outcome
		clr_character_flag = kow_tow_okay_outcome
		clr_character_flag = killed_rival_bestigor
		clr_character_flag = befriended_rival_bestigor
		clr_character_flag = kow_tow_great_outcome
		clr_character_flag = missed_loved_one
		#clr_character_flag = met_mercenaries
		clr_character_flag = met_traveling_merchant
		clr_character_flag = visited_market
		clr_character_flag = kow_tow_invited_by_local_lord
		clr_character_flag = kow_tow_heavy_rain
		clr_character_flag = fought_in_heart_of_dark
		clr_character_flag = hunted_jabberslythe
		clr_character_flag = kow_tow_hide_abort_notification
		clr_character_flag = kow_tow_visited_temple
	}
}

#You feel homesick...
character_event = {
    id = JD_BRAY.19 #I really miss X.
	has_dlc = "Jade Dragon"

	title = EVTTITLE_BRAY_PILGRIMAGE
    desc = EVTDESC_JD_15010
    picture = GFX_evt_carriage_default
    border = GFX_event_normal_frame_diplomacy
    is_triggered_only = yes

	trigger = {
		trait = travelling
	}

    immediate = {
    	set_character_flag = missed_loved_one
        random_courtier_or_vassal = { #Select someone you sort of care about at least...!
    		limit = {
    			OR = {
					is_lover = ROOT
					any_spouse = { character = ROOT }
					AND = {
						OR = {
							is_mother = ROOT
							is_father = ROOT
						}
						NOR = {
							is_lover = ROOT
							any_spouse = { character = ROOT }
						}
					}
					AND = {
						is_child_of = ROOT
						NOR = {
							is_lover = ROOT
							any_spouse = { character = ROOT }
						}
					}
					AND = {
						is_friend = ROOT
						NOR = {
							is_lover = ROOT
							any_spouse = { character = ROOT }
							is_mother = ROOT
							is_father = ROOT
							is_child_of = ROOT
						}
					}
				}
    		}
    		save_event_target_as = person_missed
    	}
    }

    option = { #I will write a letter to my lover...
        name = EVTOPTA_JD_15010
        custom_tooltip = { text = will_receive_a_letter }
        event_target:person_missed = { set_character_flag = is_lover } #for follow up event

		scaled_wealth = { value = -0.1 min = -5 }

        tooltip = {
	        reverse_opinion = {
				who = event_target:person_missed
				modifier = opinion_love_letters
				years = 15
			}
		}

		trigger = {
			event_target:person_missed = {
				is_lover = ROOT
			}
		}
    }
    option = { #I will write a letter to my friend...
        name = EVTOPTB_JD_15010
		custom_tooltip = { text = will_receive_a_letter }
		event_target:person_missed = { set_character_flag = is_friend } #for follow up event

		scaled_wealth = { value = -0.1 min = -5 }

		tooltip = {
	        reverse_opinion = {
				who = event_target:person_missed
				modifier = opinion_pen_pal
				years = 15
			}
		}

		trigger = {
			event_target:person_missed = {
				is_friend = ROOT
				NOR = {
					is_lover = ROOT
					any_spouse = { character = ROOT }
					is_mother = ROOT
					is_father = ROOT
					is_child_of = ROOT
				}
			}
		}
    }
    option = { #I will write a letter to my spouse...!
        name = EVTOPTC_JD_15010
        custom_tooltip = { text = will_receive_a_letter }
        event_target:person_missed = { set_character_flag = is_spouse } #for follow up event

        scaled_wealth = { value = -0.1 min = -5 }

        tooltip = {
	        reverse_opinion = {
				who = event_target:person_missed
				modifier = opinion_love_letters
				years = 15
			}
		}

		trigger = {
			event_target:person_missed = {
				any_spouse = { character = ROOT }
				NOT = { is_lover = ROOT }
			}
		}
    }
    option = { #I will write a letter to my parent...
        name = EVTOPTD_JD_15010
        custom_tooltip = { text = will_receive_a_letter }
        event_target:person_missed = { set_character_flag = is_parent } #for follow up event

        scaled_wealth = { value = -0.1 min = -5 }

        tooltip = {
        	reverse_opinion = {
				who = event_target:person_missed
				modifier = opinion_delighted_parent
				years = 15
			}
		}
		trigger = {
			event_target:person_missed = {
				OR = {
					is_mother = ROOT
					is_father = ROOT
				}
				NOR = {
					is_lover = ROOT
					any_spouse = { character = ROOT }
				}
			}
		}
    }
    option = { #I will write a letter to my child...
        name = EVTOPTE_JD_15010
        custom_tooltip = { text = will_receive_a_letter }
        event_target:person_missed = { set_character_flag = is_child } #for follow up event

        scaled_wealth = { value = -0.1 min = -5 }

        tooltip = {
	        reverse_opinion = {
				who = event_target:person_missed
				modifier = opinion_pen_pal
				years = 15
			}
        }

		trigger = {
			OR = {
				is_mother = event_target:person_missed
				is_father = event_target:person_missed
			}
			event_target:person_missed = {
				NOR = {
					is_lover = ROOT
					any_spouse = { character = ROOT }
				}
			}
		}
    }
    option = { #No! Time is of the essence...!
        name = EVTOPTF_JD_15010
        hidden_effect = { set_character_flag = do_nothing }
    }

    after = {
    	if = { limit = { NOT = { has_character_flag = do_nothing } }
    		event_target:person_missed = { character_event = { id = JD_BRAY.20 } }
    	}
    	else = {
    		clr_character_flag = do_nothing
    	}
    	return_to_travel_brayherd_tombola_effect = yes
    }
}

character_event = { # Selected target receives letter from you...!
    id = JD_BRAY.20
	has_dlc = "Jade Dragon"

	title = EVTTITLE_BRAY_PILGRIMAGE
    picture = GFX_evt_recieve_letter
    border = GFX_event_normal_frame_diplomacy
    is_triggered_only = yes

    desc = {
    	text = EVTDESC_JD_15011_A
    	trigger = {
    		NOT = { is_child_of = FROM }
    	}
    }
    desc = {
    	text = EVTDESC_JD_15011_B
    	trigger = {
    		is_child_of = FROM
    	}
    }

    option = {
        name = {
        	text = EVTOPTA_JD_15011_A
        	trigger = { NOT = { is_child_of = FROM } }
        }
        name = {
        	text = EVTOPTA_JD_15011_B
        	trigger = { is_child_of = FROM }
        }

        if = {
        	limit = {
        		OR = {
        			has_character_flag = is_child
        			has_character_flag = is_friend
        		}

        	}
	        opinion = {
				who = FROM
				modifier = opinion_pen_pal
				years = 15
			}
        }
        if = {
			limit = {
				OR = {
					has_character_flag = is_lover
					has_character_flag = is_spouse
				}
			}
	        opinion = {
				who = FROM
				modifier = opinion_love_letters
				years = 15
			}
        }
        if = {
			limit = { has_character_flag = is_parent }
	        opinion = {
				who = FROM
				modifier = opinion_delighted_parent
				years = 15
			}
        }
    }
}

character_event = { #Visit the market
    id = JD_BRAY.22
	has_dlc = "Jade Dragon"

	title = EVTTITLE_BRAY_PILGRIMAGE
    desc = EVTDESC_JD_BRAY_22
    picture = GFX_evt_beastmen_brayshaman #Brayshaman
    border = GFX_event_normal_frame_diplomacy
    is_triggered_only = yes

	trigger = {
		trait = travelling
	}

    hide_from = yes
    immediate = {
    	set_character_flag = visited_market
    	hidden_effect = {
	    	brayherd_warp = {
				governor = {
					create_random_steward  = {
						age = 45
						random_traits = yes
						female = 50
						dynasty = none
						attributes = {
							stewardship = 3
						}
						health = 10
					}
					new_character = {
						# Set Racial Trait
						character_event = {
						  id = aiclean.31
						}
						save_event_target_as = chaos_trader
						give_nickname = nick_the_trader
	    				add_beastman_artifact_effect = yes
					}
				}
			}
    	}
    }

    option = { #What is that scent...? Mmhm!
        name = EVTOPTA_JD_BRAY_22
        custom_tooltip = { text = EVTOPTA_JD_BRAY_22_TT } #you partake in the local cuisine!

        random = {
        	chance = 50
        	add_trait_gluttonous_effect = yes
        }
        custom_tooltip = {
			text = EVTTOOLTIP_JD_GOOD_INFLUENCE_ON_EMPEROR_EVALUATION
			hidden_effect = {
				change_variable = {
					which = kow_tow_emperor_impression_evaluation
					value = 3
				}
			}
		}
    }
    option = { #Let's trade, you there!
        name = EVTOPTB_JD_BRAY_22
        custom_tooltip = { text = EVTOPTB_JD_BRAY_22_TT }

		scaled_wealth = { value = -0.6 min = -200 }

        hidden_effect = {
	        event_target:chaos_trader = {
	        	event_target:beastman_artifact = {
		        	transfer_artifact = {
						from = PREV
						to = PREVPREV
					}
	        	}
				if = {
					limit = {
						is_invincible_trigger = yes
					}
					antideath_effect = yes
					break = yes
				}
	        	death = { death_reason =  death_missing }
	        }
        }

        custom_tooltip = {
			text = EVTTOOLTIP_JD_GOOD_INFLUENCE_ON_EMPEROR_EVALUATION
			hidden_effect = {
				change_variable = {
					which = kow_tow_emperor_impression_evaluation
					value = 3
				}
			}
		}
		trigger = { #only if you don't already have a ton of cathayan artifacts
			NOT = {
				any_artifact = {
					count = 13
					#has_artifact_flag = cathayan
				}
			}
		}
    }

    option = { #Steal a Chinese artifact in the market!
        name = EVTOPTC_JD_BRAY_22
        custom_tooltip = { text = EVTOPTC_JD_BRAY_22_TT }
        tooltip_info = intrigue

		custom_tooltip = {
			text = EVTTOOLTIP_JD_BAD_INFLUENCE_ON_EMPEROR_EVALUATION
			hidden_effect = {
				subtract_variable = {
					which = kow_tow_emperor_impression_evaluation
					value = 3
				}
			}
		}

        hidden_effect = {
	        event_target:chaos_trader = {
	        	event_target:beastman_artifact = {
		        	transfer_artifact = {
						from = PREV
						to = PREVPREV
					}
	        	}
	        }
        }
        trigger = {
        	OR = {
        		trait = elusive_shadow
        		intrigue = 15
        	}
        }
    }

    option = { #I just wanna go home.
        name = EVTOPTD_JD_BRAY_22
    }

    after = {
    	return_to_heart_tombola_effect = yes
    	hidden_effect = {
	        event_target:chaos_trader = { #removes the trader from the game, along with their artifact (if you didn't trade)...
	        	any_artifact = { destroy_artifact = yes }
				if = {
					limit = {
						is_invincible_trigger = yes
					}
					antideath_effect = yes
					break = yes
				}
	        	death = { death_reason =  death_missing }
	        }
        }
    }
}

character_event = { #Encounter a merchant..!
    id = JD_BRAY.23
	has_dlc = "Jade Dragon"

	title = EVTTITLE_BRAY_PILGRIMAGE
    desc = EVTDESC_JD_15017
    picture = GFX_evt_voodoo_shaman
    border = GFX_event_normal_frame_diplomacy
    is_triggered_only = yes
   	portrait = event_target:chaos_trader

	trigger = {
		trait = travelling
	}

    immediate = {
    	set_character_flag = met_traveling_merchant
		hidden_effect = {
	    	brayherd_warp = {
				governor = {
					create_random_intriguer  = {
						age = 25
						random_traits = yes
						female = 50
						dynasty = none
						attributes = {
							intrigue = 4
						}
					}
					new_character = {
						# Set Racial Trait
						character_event = {
						  id = aiclean.31
						}
						upgrade_education_effect = yes
						save_event_target_as = chaos_trader
						hidden_effect = {
							random_list = {
								10 = {
									trigger = { ROOT = { NOT = { has_artifact = beastmen_artifact_beast_banner } } }
									add_artifact = beastmen_artifact_beast_banner
								}
								10 = {
									trigger = { ROOT = { NOT = { has_artifact = beastmen_artifact_dark_heart } } }
									add_artifact = beastmen_artifact_dark_heart
								}
								10 = {
									trigger = { ROOT = { NOT = { has_artifact = beastmen_artifact_shard_herd_stone } } }
									add_artifact = beastmen_artifact_shard_herd_stone
								}
								10 = {
									trigger = { ROOT = { NOT = { has_artifact = beastmen_artifact_dark_rain_chalice } } }
									add_artifact = beastmen_artifact_dark_rain_chalice
								}
								10 = {
									trigger = { ROOT = { NOT = { has_artifact = beastmen_artifact_ramhorn_helm } } }
									add_artifact = beastmen_artifact_ramhorn_helm
								}
								10 = {
									trigger = { ROOT = { NOT = { has_artifact = beastmen_artifact_fur_sharrgu } } }
									add_artifact = beastmen_artifact_fur_sharrgu
								}
								10 = {
									trigger = { ROOT = { NOT = { has_artifact = beastmen_artifact_great_fang } } }
									add_artifact = beastmen_artifact_great_fang
								}
								10 = {
									trigger = { ROOT = { NOT = { has_artifact = beastmen_artifact_stonecrusher_mace } } }
									add_artifact = beastmen_artifact_stonecrusher_mace
								}
								10 = {
									trigger = { ROOT = { NOT = { has_artifact = beastmen_artifact_black_maul } } }
									add_artifact = beastmen_artifact_black_maul
								}
								10 = {
									trigger = { ROOT = { NOT = { has_artifact = beastmen_artifact_chaos_armour } } }
									add_artifact = beastmen_artifact_chaos_armour
								}
							}
							new_artifact = {
								save_event_target_as = beastman_artifact
							}
						}
					}
				}
			}
    	}
    }

    option = {
        name = EVTOPTA_JD_15017 #I'd love to take it off your hands!
        custom_tooltip = { text = EVTOPTA_JD_15017_TT }

		scaled_wealth = { value = -0.4 min = -150 }

        hidden_effect = {
	        event_target:chaos_trader = {
	        	event_target:beastman_artifact = {
		        	transfer_artifact = {
						from = PREV
						to = PREVPREV
					}
	        	}
				if = {
					limit = {
						is_invincible_trigger = yes
					}
					antideath_effect = yes
					break = yes
				}
	        	death = { death_reason =  death_missing }
	        }
        }
    }
    option = { #I could use a smooth-talker like you...
        name = EVTOPTB_JD_15017
        custom_tooltip = { text = EVTOPTB_JD_15017_TT }
        hidden_effect = {
	        event_target:chaos_trader = {
	        	show_scope_change = no
	        	move_character = ROOT
	        }
        }

        tooltip_info = kind
        trigger = { trait = kind }
    }
    option = {
        name = EVTOPTC_JD_15017 #Guards! Cut this man/woman down.
        custom_tooltip = { text = EVTOPTC_JD_15017_TT } #You steal the artifact.

        event_target:chaos_trader = {
        	show_scope_change = no
			if = {
				limit = {
					is_invincible_trigger = yes
				}
				antideath_effect = yes
				break = yes
			}
        	death = { death_reason = death_murder }
        }
        custom_tooltip = { text = EVTOPTA_JD_15017_TT } #it's transfered to you.
		hidden_effect = { #Steal the artifact
	        event_target:chaos_trader = {
	        	event_target:beastman_artifact = {
		        	transfer_artifact = {
						from = PREV
						to = PREVPREV
					}
	        	}
	        }
        }

        tooltip_info = deceitful
        trigger = { trait = deceitful }
    }
    option = {
        name = EVTOPTD_JD_15017 #I have no use of whatever that is.
        custom_tooltip = { text = EVTOPTD_JD_15017_TT }
        hidden_effect = {
	        event_target:chaos_trader = { #removes the trader from the game, along with their artifact (if you didn't trade)...
	        	any_artifact = { destroy_artifact = yes }
				if = {
					limit = {
						is_invincible_trigger = yes
					}
					antideath_effect = yes
					break = yes
				}
	        	death = { death_reason =  death_missing }
	        }
        }
    }
    after = {
    	return_to_travel_brayherd_tombola_effect = yes
    }
}
###Bray Shaman
character_event = {
    id = JD_BRAY.20021
	has_dlc = "Jade Dragon"
    hide_window = yes
    is_triggered_only = yes
    immediate = {
        FROMFROM = {
			create_character = {
				age = 35
				dynasty = actually_culture
				religion = ROOT
				culture = ROOT
				female = no
				health = 6
				random_traits = no
				trait=creature_beastman
				trait=bray_shaman
				attributes = {
					martial = 2
					diplomacy = 5
					stewardship = 3
					intrigue = 3
					learning = 6
				}
			}
            new_character = {
				magic_power_random_effect=yes
				enable_magic_xp_effect=yes
				calc_magic_pool_effect=yes
                #Education & other basic stuff
                save_event_target_as = warp_brayshaman
				set_character_flag = ai_flag_refuse_concubinage
				set_character_flag = ai_flag_refuse_marriage
				set_character_flag = originated_from_brayherd_court
                reverse_opinion = {
                    who = PREV
                    modifier = opinion_loyal_servant
                    years = 100
                }
				set_character_flag = cathayan_courtier_original_court_@PREV
                set_character_flag = no_court_invites
                set_character_flag = is_cathayan_physician
                random_list = {
                    30 = { add_trait = scholarly_theologian }
                    20 = { add_trait = mastermind_theologian }
                    30 = { add_trait = grey_eminence }
                    20 = { add_trait = charismatic_negotiator }
                }
                random_list = {
                    10 = { add_trait = mystic } #Nothing
                    40 = { new_character={ character_event = { id = JD_BRAY.24 } }}
                    30 = { add_trait = shrewd }
                    15 = { add_trait = quick }
                    5 = { add_trait = genius }
                }
                random_list = {
                    25 = {
					add_trait = lore_nurgle
					religion = nurgle
					}
                    25 = {
					add_trait = lore_slaanesh
					religion = slaanesh
					}
                    30 = {
					add_trait = lore_tzeentch
					religion = tzeentch
					}
                    10 = {
					add_trait = lore_dark_magic
					religion = chaos
					}
                    10 = { add_trait = physician }
                }
                random_list = {
                    20 = { } #Nothing Lore of Wilds?
                    25 = {add_trait = lore_death}
                    25 = {add_trait = lore_shadows}
                    25 = {add_trait = lore_beasts}
                    5 = { add_trait = physician }
                }
                random_list = {
                    80 = { } #Nothing
                    2 = { add_trait = clubfooted }
                    2 = { add_trait = harelip }
                    2 = { add_trait = hunchback }
                    4 = { add_trait = lisp }
                    4 = { add_trait = stutter }
                    2 = { add_trait = ugly }
                    2 = { add_trait = dwarf }
                    2 = { add_trait = weak }
                }
                random_list = {
                    50 = { } #Nothing
                    25 = { add_trait = patient }
                    25 = { add_trait = diligent }
                }
                opinion = {
                    who = PREV
                    modifier = opinion_servant
                    months = 1200
                }

                #Add archetype
                random_list = {
                    20 = { #Combat medic
                        set_character_flag = archetype_decisive
                        random_list = {
                            50 = { add_trait = duelist }
                            50 = { add_trait = scholar }
                        }
                        add_scarred_tiered_effect = yes
                        add_trait = robust
                        random_list = {
                            60 = { } #Nothing
                            20 = {
                                trigger = { has_dlc = Reapers }
                                add_trait = one_legged
                            }
                            20 = {
                                trigger = { has_dlc = Reapers }
                                add_trait = one_eyed
                            }
                        }
                        add_trait = brave
                        random_list = {
                            30 = { } #Nothing
                            50 = { add_trait = cynical }
                            10 = {
                                add_trait = cynical
                                add_trait = depressed
                            }
                            10 = {
                                add_trait = cynical
                                add_trait = depressed
                                add_trait = drunkard
                            }
                        }
                        random_list = {
                            50 = { } #Nothing
                            20 = { add_trait = kind }
                            30 = { add_trait = honest }
                        }
                        remove_trait = dwarf
                        remove_trait = weak
                    }
                    #Dr Jerk
                    15 = {
                        set_character_flag = archetype_decisive
                        add_trait = scholar
                        add_trait = wroth
                        remove_trait = patient
                        random_list = {
                            30 = { add_trait = proud }
                            30 = { add_trait = envious }
                            40 = { } #Nothing
                        }
                        add_trait = honest
                        add_trait = cynical
                        random = {
                            chance = 30
                            add_trait = drunkard
                        }
                        random_list = {
                            60 = { }
                            20 = {
                                add_trait = clubfooted
                                set_name = Wu #House
                            }
                            20 = {
                                trigger = { has_dlc = Reapers }
                                add_trait = one_legged
                                set_name = Wu #House
                            }
                        }
                    }
                    10 = { #Mad genius
                        set_character_flag = archetype_sociable
                        random_list = {
                            50 = { add_trait = impaler }
                            50 = { add_trait = mystic }
                        }
                        random_list = {
                            33 = { add_trait = drunkard }
                            33 = {
								add_trait = lunatic_1
								set_variable = { which = "lunatic_counter" value = 5 }
							}
                            33 = { add_trait = possessed }
                        }
                        add_trait = genius
                        remove_trait = quick
                        remove_trait = shrewd
                        add_trait = paranoid
                        random_list = {
                            25 = { add_trait = gluttonous }
                            25 = { add_trait = wroth }
                            25 = { add_trait = proud }
                            25 = { add_trait = greedy }
                        }
                    }
                    20 = { #Herbalist
                        set_character_flag = archetype_supportive
                        add_trait = gardener
                        add_trait = diligent
                        add_trait = humble
                        random_list = {
                            33 = { add_trait = content }
                            33 = { add_trait = shy }
                            33 = { add_trait = poet }
                        }
                        random = {
                            chance = 50
                            add_trait = robust
                        }
                        remove_trait = weak
                    }
                    20 = { #Health nut
                        set_character_flag = archetype_conservative
                        add_trait = mystic
                        add_trait = celibate
                        add_trait = chaste
                        add_trait = temperate
                        random_list = {
                            50 = { add_trait = craven }
                            25 = { add_trait = shy }
                            25 = { add_trait = content }
                        }
                        set_focus = focus_scholarship
                    }
                    20 = { #Compassionate doctor
                        set_character_flag = archetype_supportive
                        random_list = {
                            50 = { add_trait = socializer }
                            50 = { add_trait = scholar }
                        }
                        add_trait = kind
                        add_trait = patient
                        random_list = {
                            25 = { add_trait = content }
                            25 = { add_trait = humble }
                            25 = { add_trait = trusting }
                            25 = { add_trait = charitable }
                        }
                        set_focus = focus_family
                    }
                    15 = { #McDreamy
                        set_character_flag = archetype_sociable
                        if = {
                            limit = { is_female = no }
                            add_trait = seducer
                        }
                        random_list = {
                            50 = { } #Nothing
                            25 = { add_trait = poet }
                            25 = { add_trait = falconer }
                        }
                        random_list = {
                            30 = { add_trait = fair }
                            50 = { add_trait = strong }
                        }
                        add_trait = lustful
                        random_list = {
                            35 = { add_trait = ambitious }
                            35 = { add_trait = gregarious }
                            30 = { } #Nothing
                        }
                        set_focus = focus_seduction
                        remove_trait = clubfooted
                        remove_trait = harelip
                        remove_trait =  hunchback
                        remove_trait = lisp
                        remove_trait = stutter
                        remove_trait = ugly
                        remove_trait = dwarf
                        remove_trait = giant
                        remove_trait = weak
                    }
                }
				if = {
					limit = {
						brayherd_warp = {
							has_status = warp_united
						}
					}
					change_learning = 5
				}
            }
            letter_event = { id = JD_BRAY.20022 }
        }
    }
}

#Governor presents doctor
letter_event = {
    id = JD_BRAY.20022
	has_dlc = "Jade Dragon"
    desc = EVTDESC_JD_20022
    border = GFX_event_letter_frame_diplomacy

    hide_new = yes

    is_triggered_only = yes

    option = {
        name = EVTOPTA_JD_20022
        custom_tooltip = { text = EVTOPTA_JD_20022_TT }
        event_target:warp_brayshaman = {
            show_scope_change = no
            give_minor_title = title_court_physician
        }
    }
}

character_event = { #artifacts
    id = JD_BRAY.21
	has_dlc = "Jade Dragon"
    hide_window = yes
    is_triggered_only = yes
    immediate = {
		random_list = {
			10 = {
				trigger = { ROOT = { NOT = { has_artifact = beastmen_artifact_beast_banner } } }
				add_artifact = beastmen_artifact_beast_banner
			}
			10 = {
				trigger = { ROOT = { NOT = { has_artifact = beastmen_artifact_dark_heart } } }
				add_artifact = beastmen_artifact_dark_heart
			}
			10 = {
				trigger = { ROOT = { NOT = { has_artifact = beastmen_artifact_shard_herd_stone } } }
				add_artifact = beastmen_artifact_shard_herd_stone
			}
			10 = {
				trigger = { ROOT = { NOT = { has_artifact = beastmen_artifact_dark_rain_chalice } } }
				add_artifact = beastmen_artifact_dark_rain_chalice
			}
			10 = {
				trigger = { ROOT = { NOT = { has_artifact = beastmen_artifact_ramhorn_helm } } }
				add_artifact = beastmen_artifact_ramhorn_helm
			}
			10 = {
				trigger = { ROOT = { NOT = { has_artifact = beastmen_artifact_fur_sharrgu } } }
				add_artifact = beastmen_artifact_fur_sharrgu
			}
			10 = {
				trigger = { ROOT = { NOT = { has_artifact = beastmen_artifact_great_fang } } }
				add_artifact = beastmen_artifact_great_fang
			}
			10 = {
				trigger = { ROOT = { NOT = { has_artifact = beastmen_artifact_stonecrusher_mace } } }
				add_artifact = beastmen_artifact_stonecrusher_mace
			}
			10 = {
				trigger = { ROOT = { NOT = { has_artifact = beastmen_artifact_black_maul } } }
				add_artifact = beastmen_artifact_black_maul
			}
			5 = {
				trigger = { ROOT = { NOT = { has_artifact = beastmen_artifact_chaos_armour } } }
				add_artifact = beastmen_artifact_chaos_armour
			}
		}
	}
}
###Gifts of Chaos
character_event = { #artifacts
    id = JD_BRAY.24
	has_dlc = "Jade Dragon"
    hide_window = yes
    is_triggered_only = yes
    immediate = {
		random_list = {
			10 = {
				trigger = {
						NOR = {
							trait = mut_gnarled_hide
							trait = mut_slugskin
							trait = mut_shadow_hide
						}
				}
				add_trait = mut_gnarled_hide
				change_variable = { which = "mutation_counter" value = 1}
			}
			10 = {
				trigger = {
						NOR = {
							trait = mut_gnarled_hide
							trait = mut_slugskin
							trait = mut_shadow_hide
						}
				}
				add_trait = mut_shadow_hide
				change_variable = { which = "mutation_counter" value = 1}
			}
			10 = {
				trigger = {
						NOR = {
							trait = mut_gnarled_hide
							trait = mut_slugskin
							trait = mut_shadow_hide
						}
				}
				add_trait = mut_slugskin
				change_variable = { which = "mutation_counter" value = 1}
			}
			10 = {
				trigger = {NOT = {trait = mut_rune_of_beast}}
				change_variable = { which = "mutation_counter" value = 1}
				add_trait = mut_rune_of_beast
			}
			10 = {
				trigger = {NOT = {trait = mut_gouge_tusks}}
				change_variable = { which = "mutation_counter" value = 1}
				add_trait = mut_gouge_tusks
			}
			10 = {
				trigger = {NOT = {trait = mut_uncanny_senses}}
				change_variable = { which = "mutation_counter" value = 1}
				add_trait = mut_uncanny_senses
			}
			10 = {
				trigger = {NOT = {trait = mut_many_limbed_fiend}}
				add_trait = mut_many_limbed_fiend
				change_variable = { which = "mutation_counter" value = 1}
			}
			#Horn Upgrades
			10 = {
				trigger = {trait = horns_none}
				change_variable = { which = "mutation_counter" value = 1}
				remove_trait = horns_none
				add_trait = horns_small
			}
			10 = {
				trigger = {trait = horns_small}
				change_variable = { which = "mutation_counter" value = 1}
				remove_trait = horns_small
				add_trait = horns_average
			}
			10 = {
				trigger = {trait = horns_average}
				change_variable = { which = "mutation_counter" value = 1}
				remove_trait = horns_average
				add_trait = horns_big
			}
			5 = {
				trigger = {trait = horns_big}
				change_variable = { which = "mutation_counter" value = 1}
				remove_trait = horns_big
				add_trait = mut_crown_of_horns
			}
			20 = {
			change_variable = { which = "mutation_counter" value = 1}
			}
			10 = {
			change_variable = { which = "mutation_counter" value = 1}
			}
		}
	}
}
#Hunting
character_event = {
	id = JD_BRAY.25
	has_dlc = "Jade Dragon"

	title = EVTTITLE_JD_BRAY_JABBER
	desc = EVTDESC_JD_BRAY_26

	picture = GFX_evt_beastmen_charge
    border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes


	trigger = {
		trait = travelling
	}

	immediate = {
		set_character_flag = hunted_jabberslythe
	}

	option = {
		name = EVTOPTA_JD_BRAY_26
		hidden_tooltip = { character_event = { id = JD_BRAY.26 days = 10 random = 40 } } # Investigate
	}
	option = {
		name = EVTOPTB_JD_BRAY_26
		trigger = { NOT = { trait = hunter } }
		return_to_travel_brayherd_tombola_effect = yes
	}
}
character_event = {
	id = JD_BRAY.26
	has_dlc = "Jade Dragon"
	hide_window=yes

	is_triggered_only = yes


	trigger = {
		trait = travelling
	}
	immediate = {
		random_list = {
			30 = {
				character_event = { id = JD_BRAY.29 }  # Actually finds and kills animal
			}
			30 = {
				set_character_flag = failed_jabberslyth_hunt
				character_event = { id = JD_BRAY.28 }  # Meets other hunter obsessed with same animal, he joins your court, random character
			}
			30 = {
				set_character_flag = failed_jabberslyth_hunt
				character_event = { id = JD_BRAY.30 }  # Gets lost in the wilderness, bad experience
			}
		}
	}
}
# Meets other hunter obsessed with same animal, he joins your court, random character
character_event = {
	id = JD_BRAY.28
	picture = GFX_evt_beastman_chief
	border = GFX_event_normal_frame_war

	title = EVTTITLE_JD_BRAY_JABBER
	is_triggered_only = yes

	desc = EVTDESC_JD_BRAY_28

	option = {
		name = EVTOPTA_WoL_5040  # Invite him to your court
		create_character = {
			random_traits = yes
			dynasty = NONE
			religion = ROOT
			culture = ROOT
			female = no
			age = 36
			trait = hunter
			trait = brave
			attributes = {
				martial = 8
			}
		}
		hidden_tooltip = { character_event = { id = JD_BRAY.29 days = 5 } } #The Confrontation
		set_character_flag=befriended_rival_bestigor
	}
	option = {
		name = EVTOPTB_WoL_5040  # Leave him be
		random_list={
			50={hidden_tooltip = { character_event = { id = JD_BRAY.30 days = 5 } }}
			50={hidden_tooltip = { character_event = { id = JD_BRAY.29 days = 5 } }}
		}
	}
	option = {
		name = EVTOPTC_WoL_5040  # He's a rival, kill him!
		if = {
			limit = { NOT = { trait = cruel } }
			add_trait = cruel
		}
		if = {
			limit = { trait = paranoid }
			add_trait = envious
		}
		if = {
			limit = { NOT = { trait = paranoid } }
			add_trait = paranoid
		}
		set_character_flag=killed_rival_bestigor
		hidden_tooltip = { character_event = { id = JD_BRAY.29 days = 5 } } #The Confrontation
	}
}
# Actually finds and kills animal
character_event = {
	id = JD_BRAY.29
	picture = GFX_evt_mysterious_forest
	border = GFX_event_normal_frame_war

	title = EVTTITLE_JD_BRAY_JABBER
	is_triggered_only = yes

	desc = EVTDESC_JD_BRAY_29
	option = {
		name = EVTOPTA_WoL_5030 # Kill and get hunter trait
		prestige = 200
		random_list={
			30={
				modifier = {
					has_character_flag = befriended_rival_bestigor
					factor = 1.5
				}
				if = {
					add_trait = hunter
				}
				if = {
					limit = { has_nickname = no }
					give_nickname = nick_the_hunter
				}
				add_character_modifier = {
					modifier = master_hunter
					duration = -1
				}
				martial=1
			}
			20={
                add_trait = wounded
				if = {
					add_trait = hunter
				}
			}
			20={
				#It Flees
			}
			20={
				modifier = {
					has_character_flag = killed_rival_bestigor
					factor = 1.5
				}
                add_maimed_trait_effect = yes
			}
			10={
				modifier = {
					has_character_flag = killed_rival_bestigor
					factor = 1.5
				}
				if = {
					limit = { is_invincible_trigger = yes }
					antideath_effect = yes
					break = yes
				}
				death = { death_reason = death_execution_hunt }
			}
		}
	}
	option = {
		name = EVTOPTB_JD_BRAY_29 # Flee for your Life
		prestige = -200
		add_trait=craven
	}
	after={
		return_to_travel_brayherd_tombola_effect=yes
	}
}
# Gets lost in the wilderness, bad experience
character_event = {
	id = JD_BRAY.30
	desc = EVTDESC_WoL_5045
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WoL_5045
		if = {
			limit = { is_ill = yes }
		if = {
			limit = {
				NOT = {
					has_dlc = "Reapers"
				}
			}
			add_trait = pneumonic
			nurgle_blessing_check_effect = yes
		}
		if = {
			limit = {
				has_dlc = "Reapers"
			}
		add_trait = infection
		hidden_tooltip = {
			character_event = { id = RIP.11001 days = 365 random = 1095 }
		}
		}
		}
		if = {
			limit = {
				trait = stressed
			}
			random = {
				chance = 20
				add_trait = depressed
				hidden_tooltip = {
					character_event = {
						id = 38288 #Notify Depressed
					}
				}
			}
		}
		if = {
			limit = {
				NOT = { trait = stressed }
			}
			random = {
				chance = 20
				add_trait = stressed
				hidden_tooltip = {
					character_event = {
						id = 38282 #Notify Stressed
					}
				}
			}
		}
		if = {
			limit = {
				NOT = { trait = patient }
				NOT = { trait = wroth }
			}
			random = {
				chance = 20
				add_trait = wroth
				hidden_tooltip = {
					character_event = {
						id = 38254 #Notify Wroth
					}
				}
			}
		}
		return_to_travel_brayherd_tombola_effect=yes
	}
}
#Breyherd Bestigor/Doombull/Chaos Bestigor?
character_event = {
    id = JD_BRAY.20039
	has_dlc = "Jade Dragon"
    hide_window = yes
    is_triggered_only = yes
    immediate = {
        FROMFROM = {
			create_character = {
			age = 30
			dynasty = actually_culture
				religion = ROOT
				culture = ROOT
				female = no
				health = 7
				random_traits = no
				trait=creature_beastman
				attributes = {
					martial = 6
					diplomacy = 2
					stewardship = 3
					intrigue = 4
					learning = 2
				}
			}
            new_character = {
                #Education & other basic stuff
                save_event_target_as = cathayan_strategist
                add_character_modifier = {
                    name = jd_strategist
                    duration = -1
                }
				set_character_flag = ai_flag_refuse_concubinage
				set_character_flag = ai_flag_refuse_marriage
				set_character_flag = originated_from_cathayan_court
                reverse_opinion = {
                    who = PREV
                    modifier = opinion_loyal_servant
                    years = 100
                }
				set_character_flag = cathayan_courtier_original_court_@PREV
                set_character_flag = no_court_invites
                set_character_flag = is_cathayan_strategist
                random_list = {
                    80 = { add_trait = skilled_tactician }
                    20 = { add_trait = brilliant_strategist }
                }
                random_list = {
                    20 = { add_trait = brave }
                    20 = { add_trait = strong }
                    20 = { add_trait = shrewd }
                    40 = { add_trait = robust }
                }
                random_list = {
                    50 = { add_trait = horns_average }
                    50 = { add_trait = horns_big }
                }
                random = {
                    chance = 15
					add_trait = duelist
				}
                random_list = {
                    71 = { } #Nothing
                    20 = { add_scarred_tiered_effect = yes }
                    5 = {
                        trigger = { has_dlc = Reapers }
                        add_trait = one_eyed
                        change_martial = 1
                    }
                    2 = {
                        trigger = { has_dlc = Reapers }
                        add_trait = one_handed
                        change_martial = 1
                    }
                    2 = { add_trait = ugly }
                }
                opinion = {
                    who = PREV
                    modifier = opinion_servant
                    months = 1200
                }
				random_list = {
					10 = { add_trait = mut_many_limbed_fiend }
					30 = { add_trait = mut_slugskin }
					30 = { add_trait = mut_shadow_hide }
					30 = { add_trait = scales }
				}
				random_list = {
					33 = { add_trait = diligent }
					33 = { add_trait = brave }
					33 = { add_trait = cruel }
				}
				random_list = {
					25 = { add_trait = holy_warrior }
					25 = { add_trait = berserker }
					25 = { add_trait = tough }
					25 = { add_trait = strong }
				}
				random_list = {
					25 = { change_martial = 2 }
					25 = { change_martial = 3 }
					25 = { change_martial = 4 }
					25 = { change_martial = 5 }
				}
			}
            letter_event = { id = JD_BRAY.20040 }
        }
    }
}
###Imperial marriage
#Randomizing the spouse
letter_event = {
    id = JD_BRAY.20045
	has_dlc = "Jade Dragon"
	desc= EVTDESC_JD_BRAY_20045
    border = GFX_event_letter_frame_diplomacy
    is_triggered_only = yes
	option = {
        name = EVTOPTA_JD_BRAY_20045_A
		set_character_flag=my_own_dynasty_bray
		trigger = {
			ai = no
		}
	}
	option = {
        name = EVTOPTA_JD_BRAY_20045_B
	}
    after = {
        FROMFROMFROM  = { save_event_target_as = imperial_marriage_spouse_1 }
        if = {
            limit = { ai=yes }
			set_character_flag=my_own_dynasty_bray
		}
        brayherd_warp = {
            governor = {
                ROOT = {
                    if = {
                        limit = { event_target:imperial_marriage_spouse_1 = { is_female = no } }
                        create_character = {
                            age = 16
                            religion = PREV
                            culture = PREV
                            female = yes
                            health = 6
                            random_traits = no
                            attributes = {
                                martial = 4
                                diplomacy = 5
                                stewardship = 4
                                intrigue = 4
                                learning = 5
                            }
                        }
                    }
                    new_character = {
						# Set Racial Trait
						character_event = {
						  id = aiclean.31
						}
						set_character_flag = always_show_in_marriage_selection
                        save_event_target_as = imperial_marriage_spouse_2
                        add_trait = cannot_marry #Is removed upon marriage
						set_character_flag = ai_flag_refuse_concubinage
						set_character_flag = ai_flag_refuse_marriage

						set_character_flag = cathayan_courtier_original_court_@PREV
						add_trait = child_of_consort

                        PREVPREV = { #Emperor/Empress
							random_list = {
								50={
									trigger = { has_character_flag=my_own_dynasty_bray }
									new_character = { dynasty = PREV }
									trigger_switch = {
										on_trigger = is_female
										yes = {
											if = { #If Empress has father make them siblings
												limit = {
													father_even_if_dead = {
														could_be_parent_of = event_target:imperial_marriage_spouse_2
													}
												}
												father_even_if_dead = { save_event_target_as = imperial_marriage_parent }
											}
											else_if = { #Else if Emperor has a grandfather make them siblings
												limit = {
													father_even_if_dead = {
														father_even_if_dead = {
															could_be_parent_of = event_target:imperial_marriage_spouse_2
														}
													}
												}
												father_even_if_dead = {
													father_even_if_dead = {
														save_event_target_as = imperial_marriage_parent
													}
												}
											}
											else_if = {
												limit = {
													any_dynasty_member_even_if_dead  = {
														is_or_was_offmap_power_ruler = yes
														could_be_parent_of = event_target:imperial_marriage_spouse_2
													}
												}
												random_dynasty_member_even_if_dead = {
													limit = {
														is_or_was_offmap_power_ruler = yes
														could_be_parent_of = event_target:imperial_marriage_spouse_2
													}
													save_event_target_as = imperial_marriage_parent
												}
											}
											else_if = {
												limit = {
													any_dynasty_member_even_if_dead  = {
														could_be_parent_of = event_target:imperial_marriage_spouse_2
													}
												}
												random_dynasty_member_even_if_dead = {
													limit = {
														could_be_parent_of = event_target:imperial_marriage_spouse_2
													}
													save_event_target_as = imperial_marriage_parent
												}
											}
											else_if = { #Else make a new father to make them siblings
												limit = {
													father_even_if_dead = {
														always = no
													}
												}
												create_character = {
													age = 60
													dynasty = PREV
													religion = PREV
													culture = PREV
												}
												new_character = {
													# Set Racial Trait
													character_event = {
													  id = aiclean.31
													}
													if = {
														limit = {
															is_invincible_trigger = yes
														}
														antideath_effect = yes
														break = yes
													}
													death = { death_reason = death_in_cathay_historic }
													save_event_target_as = imperial_marriage_parent
												}
												set_father = event_target:imperial_marriage_parent
											}
										}
										no = {
											if = { #If Emperor is 32+ and the imperial target is female then make it his child
												limit = {
													could_be_parent_of = event_target:imperial_marriage_spouse_2
													event_target:imperial_marriage_spouse_2 = {
														is_female = yes
													}
												}
												save_event_target_as = imperial_marriage_parent
											}
											else_if = { #Else if Emperor has a father make them siblings
												limit = {
													father_even_if_dead = {
														could_be_parent_of = event_target:imperial_marriage_spouse_2
													}
												}
												father_even_if_dead = {
													save_event_target_as = imperial_marriage_parent
												}
											}
											else_if = { #Else if Emperor has a grandfather make them siblings
												limit = {
													father_even_if_dead = {
														father_even_if_dead = {
															could_be_parent_of = event_target:imperial_marriage_spouse_2
														}
													}
												}
												father_even_if_dead = {
													father_even_if_dead = {
														save_event_target_as = imperial_marriage_parent
													}
												}
											}
											else_if = {
												limit = {
													any_dynasty_member_even_if_dead = {
														is_or_was_offmap_power_ruler = yes
														could_be_parent_of = event_target:imperial_marriage_spouse_2
													}
												}
												random_dynasty_member_even_if_dead = {
													limit = {
														is_or_was_offmap_power_ruler = yes
														could_be_parent_of = event_target:imperial_marriage_spouse_2
													}
													save_event_target_as = imperial_marriage_parent
												}
											}
											else_if = {
												limit = {
													any_dynasty_member_even_if_dead = {
														could_be_parent_of = event_target:imperial_marriage_spouse_2
													}
												}
												random_dynasty_member_even_if_dead = {
													limit = {
														could_be_parent_of = event_target:imperial_marriage_spouse_2
													}
													save_event_target_as = imperial_marriage_parent
												}
											}
											else_if = { #Else make a new father to make them siblings
												limit = {
													father_even_if_dead = {
														always = no
													}
												}
												create_character = {
													age = 60
													dynasty = PREV
													religion = PREV
													culture = PREV
												}
												new_character = {
													# Set Racial Trait
													character_event = {
													  id = aiclean.31
													}
													if = {
														limit = {
															is_invincible_trigger = yes
														}
														antideath_effect = yes
														break = yes
													}
													death = { death_reason = death_in_cathay_historic }
													save_event_target_as = imperial_marriage_parent
												}
												set_father = event_target:imperial_marriage_parent
											}
										}
									}
								}
								50={
									new_character = {set_character_flag = lowborn_exceptional_concubine}
									new_character = { dynasty = none }
								}
							}
							if = {
								limit = {
									event_target:imperial_marriage_parent = {
										is_female = no
									}
								}
								event_target:imperial_marriage_spouse_2 = { set_father = event_target:imperial_marriage_parent }
							}
							if = {
								limit = {
									event_target:imperial_marriage_parent = {
										is_female = yes
									}
								}
								event_target:imperial_marriage_spouse_2 = { set_mother = event_target:imperial_marriage_parent }
							}
                        }

                        #Positive genetic trait
                        random_list = {
                            60 = {
								trigger = {
									NOT = { brayherd_warp = { has_status = warp_united } }
								}
								#Nothing
							}
                            15 = { add_trait = fair }
                            5 = { add_trait = strong }
                            10 = { add_trait = quick }
                            5 = { add_trait = genius }
                        }

                        #Negative genetic trait
						random_list = {
							90 = { } #Nothing
							1 = { add_trait = clubfooted }
							1 = { add_trait = harelip }
							1 = { add_trait = hunchback }
							1 = { add_trait = lisp }
							2 = { add_trait = stutter }
							1 = {
								remove_trait = fair
								add_trait = ugly
							}
							1 = { add_trait = dwarf }
							1 = {
								remove_trait = genius
								remove_trait = quick
								add_trait = slow
							}
							1 = {
								remove_trait = strong
								add_trait = weak
							}
						}

                        random = {
                            chance = 5
                            add_trait = homosexual
                        }

                        #Add archetype 1 (personality: conservative, supportive, decisive, sociable)
                        random_list = {
                            #Conservative
                            25 = {
                                set_character_flag = archetype_conservative

                                random = {
                                    chance = 50
                                    add_trait = zealous
                                }
                                add_trait = temperate
                                random_list = {
                                    20 = { add_trait = greedy }
                                    20 = { add_trait = wroth }
                                    20 = { add_trait = deceitful }
                                    20 = { add_trait = stubborn }
                                    20 = { add_trait = cruel }
                                }
                                random_list = {
                                    25 = { add_trait = poet }
                                    25 = { add_trait = chaste }
                                    25 = {
                                        add_trait = patient
                                        remove_trait = wroth
                                    }
                                    25 = { add_trait = just }
                                }
                            }
                            #Supportive
                            25 = {
                                set_character_flag = archetype_supportive

                                add_trait = humble
                                add_trait = patient
                                random_list = {
                                    30 = { add_trait = slothful }
                                    70 = { add_trait = shy }
                                }
                                random_list = {
                                    25 = { add_trait = content }
                                    25 = { add_trait = charitable }
                                    25 = { add_trait = kind }
                                    25 = { add_trait = trusting }
                                }
                            }
                            #Decisive
                            25 = {
                                modifier = {
                                    is_female = yes
                                    factor = 0.5
                                }
                                set_character_flag = archetype_decisive

                                add_trait = ambitious
                                add_trait = cynical
                                random_list = {
                                    20 = { add_trait = cruel }
                                    20 = { add_trait = stubborn }
                                    20 = { add_trait = greedy }
                                    20 = { add_trait = wroth }
                                    20 = { add_trait = proud }
                                }
                                random_list = {
                                    20 = { add_trait = falconer }
                                    20 = { add_trait = diligent }
                                    20 = { add_trait = brave }
                                    20 = { add_trait = honest }
                                    20 = { add_trait = gregarious }
                                }
                            }
                            #Sociable
                            25 = {
                                modifier = {
                                    is_female = yes
                                    factor = 0.7
                                }
                                set_character_flag = archetype_sociable

                                add_trait = gregarious
                                add_trait = charitable
                                random_list = {
                                    25 = { add_trait = envious }
                                    25 = { add_trait = gluttonous }
                                    25 = { add_trait = proud }
                                    25 = { add_trait = slothful }
                                }
                                random_list = {
                                    33 = { add_trait = kind }
                                    33 = { add_trait = honest }
                                    33 = { add_trait = lustful }
                                }
                            }
                        }

                        #Set archetype 2 (lifestyle)
                        random_list = {
                            #War
                            15 = {
                                modifier = {
                                    is_female = yes
                                    factor = 0.1
                                }
                                modifier = {
                                    has_character_flag = archetype_decisive
                                    factor = 2
                                }
                                #Set education
                                random_list = {
                                    30 = { add_trait = tough_soldier }
                                    50 = { add_trait = skilled_tactician }
                                    20 = { add_trait = brilliant_strategist }
                                }
                                #Set appropriate traits
                                random_list = {
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = duelist
                                        }
                                        remove_trait = craven
                                        add_trait = brave
                                        if = {
                                            limit = { is_strong_trigger = no }
                                            add_trait = robust
                                        }
                                    }
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = hunter
                                        }
                                        add_trait = falconer
                                        if = {
                                            limit = { is_strong_trigger = no }
                                            add_trait = robust
                                        }
                                    }
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = strategist
                                        }
                                        if = {
                                            limit = { is_smart_trigger = no }
                                            add_trait = shrewd
                                        }
                                    }
                                }
                            }

                            #Diplomacy
                            30 = {
                                modifier = {
                                    has_character_flag = archetype_supportive
                                    factor = 1.5
                                }
                                modifier = {
                                    has_character_flag = archetype_sociable
                                    factor = 2
                                }
                                #Set education
                                random_list = {
                                    30 = { add_trait = underhanded_rogue }
                                    50 = { add_trait = charismatic_negotiator }
                                    20 = { add_trait = grey_eminence }
                                }
                                random = {
                                    chance = 30
                                    add_trait = arbitrary
                                }
                                #Set appropriate traits
                                random_list = {
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = hedonist
                                        }
                                        remove_trait = chaste
                                        add_trait = lustful
                                    }
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = socializer
                                        }
                                        add_trait = gregarious
                                        remove_trait = shy
                                    }
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = gamer
                                        }
                                        if = {
                                            limit = { is_smart_trigger = no }
                                            add_trait = shrewd
                                        }
                                    }
                                }
                            }

                            #Intrigue
                            10 = {
                                modifier = {
                                    has_character_flag = archetype_supportive
                                    factor = 0.5
                                }
                                modifier = {
                                    has_character_flag = archetype_decisive
                                    factor = 1.5
                                }
                                modifier = {
                                    has_character_flag = archetype_sociable
                                    factor = 1.5
                                }
                                #Set education
                                random_list = {
                                    30 = { add_trait = flamboyant_schemer }
                                    50 = { add_trait = intricate_webweaver }
                                    20 = { add_trait = elusive_shadow }
                                }
                                #Set appropriate traits
                                random_list = {
                                    33 = {
                                        trigger = { NOT = { has_character_flag = archetype_supportive } }
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = impaler
                                        }
                                        random = {
                                            chance = 50
                                            add_trait = arbitrary
                                        }
                                        remove_trait = kind
                                        add_trait = cruel
                                    }
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = schemer
                                        }
                                        add_trait = deceitful
                                        remove_trait = honest
                                    }
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                             add_trait = seductress
                                        }
                                        remove_trait = chaste
                                        add_trait = lustful
                                    }
                                }
                            }

                            #Stewardship
                            20 = {
                                modifier = {
                                    has_character_flag = archetype_conservative
                                    factor = 0.5
                                }
                                #Set education
                                random_list = {
                                    30 = { add_trait = thrifty_clerk }
                                    50 = { add_trait = fortune_builder }
                                    20 = { add_trait = midas_touched }
                                }
                                #Set appropriate traits
                                random_list = {
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = gardener
                                        }
                                        remove_trait = slothful
                                        add_trait = diligent
                                    }
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = architect
                                        }
                                        add_trait = ambitious
                                        remove_trait = content
                                    }
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = administrator
                                        }
                                        add_trait = erudite
                                    }
                                }
                            }

                            #Learning
                            25 = {
                                modifier = {
                                    has_character_flag = archetype_conservative
                                    factor = 2
                                }
                                #Set education
                                random_list = {
                                    30 = { add_trait = martial_cleric }
                                    50 = { add_trait = scholarly_theologian }
                                    20 = { add_trait = mastermind_theologian }
                                }
                                #Set appropriate traits
                                random_list = {
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = scholar
                                        }
                                        add_trait = erudite
                                    }
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = mystic
                                        }
                                        add_trait = paranoid
                                        remove_trait = trusting
                                    }
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = theologian
                                        }
                                        add_trait = erudite
                                    }
                                }
                            }
                        }

						if = {
							limit = {
								brayherd_warp = {
									has_status = warp_united
								}
							}
							change_diplomacy = 3
							change_martial = 3
							change_stewardship = 3
							change_intrigue = 3
							change_learning = 3
						}
                    }
					clr_character_flag = my_own_dynasty_bray
                }
            }
        }

        FROMFROM = { #The arranger of the marriage
            letter_event = { id = JD_BRAY.20046 }
        }
    }
}

#The spouse is on its way
letter_event = {
    id = JD_BRAY.20046
	has_dlc = "Jade Dragon"
    border = GFX_event_letter_frame_diplomacy

    desc = {
        trigger = {
			event_target:imperial_marriage_spouse_2 = { dynasty = from }
		}
        text = EVTDESC_JD_BRAY_20046_A
    }
    desc = {
        trigger = {
		event_target:imperial_marriage_spouse_2 = { NOT={ dynasty = from } }
		}
        text = EVTDESC_JD_BRAY_20046_B
    }

    is_triggered_only = yes

    option = {
        name = EVTOPTA_JD_BRAY_20046
        custom_tooltip = { text = EVTOPTA_JD_20046_TT }

        hidden_effect = {
            event_target:imperial_marriage_spouse_2 = { character_event = { id = JD_BRAY.20047 days = 14 random = 10 } }
        }
    }
}

#The cathayan spouse ping event
character_event = {
    id = JD_BRAY.20047
	has_dlc = "Jade Dragon"
    hide_window = yes
    is_triggered_only = yes
    immediate = {
		add_character_modifier = {
		name = brayherd_concubine
		duration = -1
		}
        remove_trait = cannot_marry
        event_target:imperial_marriage_spouse_1 = {
            remove_trait = cannot_marry
            narrative_event = { id = JD_BRAY.20048 }
        }
    }
}

#The marriage takes place
narrative_event = {
    id = JD_BRAY.20048
	has_dlc = "Jade Dragon"
    title = EVTTITLE_JD_BRAY_20048
    picture = GFX_evt_beastmen_herdstone
    border = GFX_event_narrative_frame_diplomacy
	desc = EVTDESC_JD_BRAY_20048_CONSERVATIVE

    is_triggered_only = yes


    option = {
        name = EVTOPTA_JD_20048

        #Marry
		add_consort = event_target:imperial_marriage_spouse_2

        #Prestige
		if={
			limit={ from={dynasty=FROMFROMFROM}}
			prestige = 200
		}
		else={
			prestige = 50
		}

        #Peace Deal
        if = {
            limit = { FROMFROM = { character = ROOT } }
            custom_tooltip = {
                text = brayherd_imperial_marriage_peace_deal_effect_tt
                add_character_modifier = {
                    inherit = yes
                    name = peace_deal_with_brayherd
                    years = 5
                }
            }
        }

        hidden_effect = { FROMFROM = { character_event = { id = JD_BRAY.20049 } } } #Letting the decision taker know
        clr_character_flag = awaiting_imperial_wedding
    }
}

#Anouncement
character_event = {
    id = JD_BRAY.20049
	has_dlc = "Jade Dragon"
    desc = EVTDESC_JD_20049
    picture = GFX_evt_beastmen_herdstone
    border = GFX_event_normal_frame_diplomacy

    is_triggered_only = yes

    trigger = {
        NOT = { character = FROM }
    }

    option = {
        name = EVTOPTA_JD_20049
        custom_tooltip = { text = EVTOPTA_JD_20049_TT }
        custom_tooltip = {
            text = cathayan_imperial_marriage_peace_deal_effect_tt
            add_character_modifier = {
                inherit = yes
                name = peace_deal_with_brayherd
                years = 25
            }
        }
        FROM = {
            show_portrait = yes
        }
        event_target:imperial_marriage_spouse_2 = {
            show_portrait = yes
        }
    }
}
